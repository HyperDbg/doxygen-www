<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg Debugger: hyperdbg/hyperkd/code/debugger/objects/Thread.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HyperDbg Debugger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_thread_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Thread.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of kernel debugger functions for threads.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;pch.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2d1b8ef9edfc052394e1b64cf6daf3d3" id="r_a2d1b8ef9edfc052394e1b64cf6daf3d3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2d1b8ef9edfc052394e1b64cf6daf3d3">ThreadHandleThreadChange</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState)</td></tr>
<tr class="memdesc:a2d1b8ef9edfc052394e1b64cf6daf3d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">handle thread changes  <br /></td></tr>
<tr class="separator:a2d1b8ef9edfc052394e1b64cf6daf3d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff010811e49c6d5face89ba31da2e0b4" id="r_aff010811e49c6d5face89ba31da2e0b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff010811e49c6d5face89ba31da2e0b4">ThreadSwitch</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ThreadId, PETHREAD EThread, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> CheckByClockInterrupt)</td></tr>
<tr class="memdesc:aff010811e49c6d5face89ba31da2e0b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">make evnvironment ready to change the thread  <br /></td></tr>
<tr class="separator:aff010811e49c6d5face89ba31da2e0b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f18246abe755d7ba1f5bdccb9c078ec" id="r_a1f18246abe755d7ba1f5bdccb9c078ec"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f18246abe755d7ba1f5bdccb9c078ec">ThreadShowList</a> (<a class="el" href="_request_structures_8h.html#a2ff4a7d527d38937426e87036e9eb4a8">PDEBUGGEE_THREAD_LIST_NEEDED_DETAILS</a> ThreadListSymbolInfo, <a class="el" href="_request_structures_8h.html#af3eeb6f563c3ce604d30ae789c1682aa">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTIONS</a> QueryAction, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *CountOfThreads, PVOID ListSaveBuffer, <a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> ListSaveBuffSize)</td></tr>
<tr class="memdesc:a1f18246abe755d7ba1f5bdccb9c078ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">shows the threads list  <br /></td></tr>
<tr class="separator:a1f18246abe755d7ba1f5bdccb9c078ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8c042931ebdc36724bdc32358515be5" id="r_ad8c042931ebdc36724bdc32358515be5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad8c042931ebdc36724bdc32358515be5">ThreadInterpretThread</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_request_structures_8h.html#a4276aa25d9666471ade93e0abba28471">PDEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET</a> TidRequest)</td></tr>
<tr class="memdesc:ad8c042931ebdc36724bdc32358515be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">change the current thread  <br /></td></tr>
<tr class="separator:ad8c042931ebdc36724bdc32358515be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c466e5cdf3b543bc8aad33c884be08b" id="r_a9c466e5cdf3b543bc8aad33c884be08b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9c466e5cdf3b543bc8aad33c884be08b">ThreadDetectChangeByDebugRegisterOnGs</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Enable)</td></tr>
<tr class="memdesc:a9c466e5cdf3b543bc8aad33c884be08b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable the thread change monitoring detection on the running core based on putting a HW breakpoint on the gs:[188].  <br /></td></tr>
<tr class="separator:a9c466e5cdf3b543bc8aad33c884be08b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad49040845ab1e8d670ffa06bc9a80165" id="r_ad49040845ab1e8d670ffa06bc9a80165"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad49040845ab1e8d670ffa06bc9a80165">ThreadDetectChangeByInterceptingClockInterrupts</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Enable)</td></tr>
<tr class="memdesc:ad49040845ab1e8d670ffa06bc9a80165"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable the thread change monitoring detection on the running core based on intercepting clock interrupts.  <br /></td></tr>
<tr class="separator:ad49040845ab1e8d670ffa06bc9a80165"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9ca061b74ef1b8e8a3d999acf00d935" id="r_ae9ca061b74ef1b8e8a3d999acf00d935"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae9ca061b74ef1b8e8a3d999acf00d935">ThreadEnableOrDisableThreadChangeMonitor</a> (<a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *DbgState, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Enable, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> IsSwitchByClockIntrrupt)</td></tr>
<tr class="memdesc:ae9ca061b74ef1b8e8a3d999acf00d935"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable the thread change monitoring detection on the running core.  <br /></td></tr>
<tr class="separator:ae9ca061b74ef1b8e8a3d999acf00d935"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcbd4c472009e7a20c3c4df7fb92b0eb" id="r_adcbd4c472009e7a20c3c4df7fb92b0eb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adcbd4c472009e7a20c3c4df7fb92b0eb">ThreadQueryCount</a> (<a class="el" href="_request_structures_8h.html#a088abddf56a4e18ca3595540dec693b4">PDEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS</a> DebuggerUsermodeProcessOrThreadQueryRequest)</td></tr>
<tr class="memdesc:adcbd4c472009e7a20c3c4df7fb92b0eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query thread details (count)  <br /></td></tr>
<tr class="separator:adcbd4c472009e7a20c3c4df7fb92b0eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e0982ba2738bd6c7ceb426e2995fd0f" id="r_a8e0982ba2738bd6c7ceb426e2995fd0f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e0982ba2738bd6c7ceb426e2995fd0f">ThreadQueryList</a> (<a class="el" href="_request_structures_8h.html#a088abddf56a4e18ca3595540dec693b4">PDEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS</a> DebuggerUsermodeProcessOrThreadQueryRequest, PVOID AddressToSaveDetail, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> BufferSize)</td></tr>
<tr class="memdesc:a8e0982ba2738bd6c7ceb426e2995fd0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query thread details (list)  <br /></td></tr>
<tr class="separator:a8e0982ba2738bd6c7ceb426e2995fd0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a754b5d3e15081f32fa9da2eef670e0fb" id="r_a754b5d3e15081f32fa9da2eef670e0fb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a754b5d3e15081f32fa9da2eef670e0fb">ThreadQueryDetails</a> (<a class="el" href="_request_structures_8h.html#a4276aa25d9666471ade93e0abba28471">PDEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET</a> GetInformationThreadRequest)</td></tr>
<tr class="memdesc:a754b5d3e15081f32fa9da2eef670e0fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query thread details.  <br /></td></tr>
<tr class="separator:a754b5d3e15081f32fa9da2eef670e0fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of kernel debugger functions for threads. </p>
<dl class="section author"><dt>Author</dt><dd>Sina Karvandi (<a href="#" onclick="location.href='mai'+'lto:'+'sin'+'a@'+'hyp'+'er'+'dbg'+'.o'+'rg'; return false;">sina@<span class="obfuscator">.nosp@m.</span>hype<span class="obfuscator">.nosp@m.</span>rdbg.<span class="obfuscator">.nosp@m.</span>org</a>)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2021-11-23</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This project is released under the GNU Public License v3. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a9c466e5cdf3b543bc8aad33c884be08b" name="a9c466e5cdf3b543bc8aad33c884be08b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c466e5cdf3b543bc8aad33c884be08b">&#9670;&#160;</a></span>ThreadDetectChangeByDebugRegisterOnGs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> ThreadDetectChangeByDebugRegisterOnGs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Enable</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable or disable the thread change monitoring detection on the running core based on putting a HW breakpoint on the gs:[188]. </p>
<p>should be called on vmx root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">Enable</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  426</span>{</div>
<div class="line"><span class="lineno">  427</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> MsrGsBase;</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>    <span class="keywordflow">if</span> (Enable)</div>
<div class="line"><span class="lineno">  430</span>    {</div>
<div class="line"><span class="lineno">  431</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  432</span>        <span class="comment">// Enable Thread Change Detection</span></div>
<div class="line"><span class="lineno">  433</span>        <span class="comment">// *** Read the address of GS:188 to g_CurrentThreadLocation ***</span></div>
<div class="line"><span class="lineno">  434</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  437</span>        <span class="comment">// We are in kernel, so we should read MSR GS_BASE</span></div>
<div class="line"><span class="lineno">  438</span>        <span class="comment">// IA32_GS_BASE             0xC0000101</span></div>
<div class="line"><span class="lineno">  439</span>        <span class="comment">// IA32_KERNEL_GS_BASE      0xC0000102</span></div>
<div class="line"><span class="lineno">  440</span>        <span class="comment">// IA32_KERNEL_GS_BASE is currently user&#39;s gs as</span></div>
<div class="line"><span class="lineno">  441</span>        <span class="comment">// we are in the kernel-mode, if we need to intercept</span></div>
<div class="line"><span class="lineno">  442</span>        <span class="comment">// from user-mode then IA32_KERNEL_GS_BASE should be used</span></div>
<div class="line"><span class="lineno">  443</span>        <span class="comment">// but it&#39;s not for our case</span></div>
<div class="line"><span class="lineno">  444</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  445</span>        MsrGsBase = __readmsr(IA32_GS_BASE);</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  448</span>        <span class="comment">// Now, we have the gs base on MSR</span></div>
<div class="line"><span class="lineno">  449</span>        <span class="comment">// while in Windows gs:188 has the address</span></div>
<div class="line"><span class="lineno">  450</span>        <span class="comment">// of where the store current _ETHREAD, so</span></div>
<div class="line"><span class="lineno">  451</span>        <span class="comment">// we have to 188 to the gs base</span></div>
<div class="line"><span class="lineno">  452</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  453</span>        MsrGsBase += 0x188;</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  456</span>        <span class="comment">// Set the global value for current thread of this processor</span></div>
<div class="line"><span class="lineno">  457</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  458</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a4a5e8eab22fff7fe0228f4fb2d61a0b0">CurrentThreadLocationOnGs</a> = MsrGsBase;</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  461</span>        <span class="comment">// Set interception state</span></div>
<div class="line"><span class="lineno">  462</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  463</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a828cb9812e870d901c9397930c02a451">DebugRegisterInterceptionState</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  466</span>        <span class="comment">// Enable load debug controls and save debug controls because we don&#39;t</span></div>
<div class="line"><span class="lineno">  467</span>        <span class="comment">// want dr7 and dr0 remove their configuration on vm-exits and also</span></div>
<div class="line"><span class="lineno">  468</span>        <span class="comment">// we&#39;ll be able to change the dr7 of the guest on VMCS</span></div>
<div class="line"><span class="lineno">  469</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  470</span>        <a class="code hl_function" href="_export_8c.html#a70e24082858bcad5973f6d4aa2070e32">VmFuncSetLoadDebugControls</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno">  471</span>        <a class="code hl_function" href="_export_8c.html#a1bb1308b9f10b9b5367452fc6f0dccba">VmFuncSetSaveDebugControls</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  474</span>        <span class="comment">// Intercept #DBs by changing exception bitmap (one core)</span></div>
<div class="line"><span class="lineno">  475</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  476</span>        <a class="code hl_function" href="_export_8c.html#a837024687fafd5d17e1020eb6157923f">VmFuncSetExceptionBitmap</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_enumvalue" href="include_2_s_d_k_2_headers_2_events_8h.html#af9640e4f7e36f7a6bf7c56e30a860349a56a4f1677785327990a937d52760d5a1">EXCEPTION_VECTOR_DEBUG_BREAKPOINT</a>);</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  479</span>        <span class="comment">// Note, this function is running as a DPC routines, means that</span></div>
<div class="line"><span class="lineno">  480</span>        <span class="comment">// we&#39;re currently on DISPATCH_LEVEL so after modifying debug</span></div>
<div class="line"><span class="lineno">  481</span>        <span class="comment">// registers and after disabling mov to dr (using vmcall),</span></div>
<div class="line"><span class="lineno">  482</span>        <span class="comment">// nothing is able to change debug registers so it&#39;s safe</span></div>
<div class="line"><span class="lineno">  483</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  486</span>        <span class="comment">// Set debug register to fire an exception in the case of</span></div>
<div class="line"><span class="lineno">  487</span>        <span class="comment">// read/write on the gs:188 as we intercept it on</span></div>
<div class="line"><span class="lineno">  488</span>        <span class="comment">// hypervisor side by exception bitmap on #DBs</span></div>
<div class="line"><span class="lineno">  489</span>        <span class="comment">// However, this call is somehow useless because I also set it</span></div>
<div class="line"><span class="lineno">  490</span>        <span class="comment">// on Mov 2 Debug regs handler (vm-exit), but we set from here</span></div>
<div class="line"><span class="lineno">  491</span>        <span class="comment">// to make sure that the vm-exit handler set this break on access</span></div>
<div class="line"><span class="lineno">  492</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  493</span>        <a class="code hl_function" href="_debug_registers_8c.html#aaaab32c0c14718eb2283f9b3069043a8">SetDebugRegisters</a>(</div>
<div class="line"><span class="lineno">  494</span>            <a class="code hl_define" href="hyperkd_2header_2debugger_2core_2_debugger_8h.html#a7f78d5db12abf3eb68376c3efbc479b1">DEBUGGER_DEBUG_REGISTER_FOR_THREAD_MANAGEMENT</a>,</div>
<div class="line"><span class="lineno">  495</span>            <a class="code hl_enumvalue" href="_data_types_8h.html#acbbc04b3f929bcff66333b5968b3a796a9406c001c7f5902738ac9e4177844db3">BREAK_ON_WRITE_ONLY</a>,</div>
<div class="line"><span class="lineno">  496</span>            <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>,</div>
<div class="line"><span class="lineno">  497</span>            DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a4a5e8eab22fff7fe0228f4fb2d61a0b0">CurrentThreadLocationOnGs</a>);</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  500</span>        <span class="comment">// Enables mov to debug registers exitings in primary cpu-based controls</span></div>
<div class="line"><span class="lineno">  501</span>        <span class="comment">// it is because I realized that some other routines in Windows like</span></div>
<div class="line"><span class="lineno">  502</span>        <span class="comment">// KiSaveProcessorControlState and KiRestoreProcessorControlState and</span></div>
<div class="line"><span class="lineno">  503</span>        <span class="comment">// other functions directly change the debug registers, probably</span></div>
<div class="line"><span class="lineno">  504</span>        <span class="comment">// because we should not modify debug registers directly, by the way, we</span></div>
<div class="line"><span class="lineno">  505</span>        <span class="comment">// are hypervisor and we can easily ignore mov to debug register (0 in</span></div>
<div class="line"><span class="lineno">  506</span>        <span class="comment">// this case), however we should somehow hide this process in the future</span></div>
<div class="line"><span class="lineno">  507</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  508</span>        <a class="code hl_function" href="_export_8c.html#a49b87e679d87d6a073687e519b6c1f5a">VmFuncSetMovDebugRegsExiting</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno">  509</span>    }</div>
<div class="line"><span class="lineno">  510</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  511</span>    {</div>
<div class="line"><span class="lineno">  512</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  513</span>        <span class="comment">// Disable Thread Change Detection</span></div>
<div class="line"><span class="lineno">  514</span>        <span class="comment">// *** Remove side changes ***</span></div>
<div class="line"><span class="lineno">  515</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  518</span>        <span class="comment">// We should not ignore debug registers change anymore</span></div>
<div class="line"><span class="lineno">  519</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  520</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a828cb9812e870d901c9397930c02a451">DebugRegisterInterceptionState</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  523</span>        <span class="comment">// Disable mov to debug regs vm-exit</span></div>
<div class="line"><span class="lineno">  524</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  525</span>        <a class="code hl_function" href="_export_8c.html#a49b87e679d87d6a073687e519b6c1f5a">VmFuncSetMovDebugRegsExiting</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  528</span>        <span class="comment">// Disable load debug controls and save debug controls because</span></div>
<div class="line"><span class="lineno">  529</span>        <span class="comment">// no longer needed</span></div>
<div class="line"><span class="lineno">  530</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  531</span>        <a class="code hl_function" href="_export_8c.html#a70e24082858bcad5973f6d4aa2070e32">VmFuncSetLoadDebugControls</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  532</span>        <a class="code hl_function" href="_export_8c.html#a1bb1308b9f10b9b5367452fc6f0dccba">VmFuncSetSaveDebugControls</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  535</span>        <span class="comment">// Disable intercepting #DBs</span></div>
<div class="line"><span class="lineno">  536</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  537</span>        <a class="code hl_function" href="_export_8c.html#acabb4a88d5b23a655b48c81114c6779e">VmFuncUnsetExceptionBitmap</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_enumvalue" href="include_2_s_d_k_2_headers_2_events_8h.html#af9640e4f7e36f7a6bf7c56e30a860349a56a4f1677785327990a937d52760d5a1">EXCEPTION_VECTOR_DEBUG_BREAKPOINT</a>);</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  540</span>        <span class="comment">// No longer need to store such gs:188 value</span></div>
<div class="line"><span class="lineno">  541</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  542</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a4a5e8eab22fff7fe0228f4fb2d61a0b0">CurrentThreadLocationOnGs</a> = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)NULL;</div>
<div class="line"><span class="lineno">  543</span>    }</div>
<div class="line"><span class="lineno">  544</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:55</div></div>
<div class="ttc" id="a_basic_types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:54</div></div>
<div class="ttc" id="a_basic_types_8h_html_aae17ebb9ef7279d026817fb22f8aebe9"><div class="ttname"><a href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></div><div class="ttdeci">unsigned __int64 UINT64</div><div class="ttdef"><b>Definition</b> BasicTypes.h:21</div></div>
<div class="ttc" id="a_data_types_8h_html_acbbc04b3f929bcff66333b5968b3a796a9406c001c7f5902738ac9e4177844db3"><div class="ttname"><a href="_data_types_8h.html#acbbc04b3f929bcff66333b5968b3a796a9406c001c7f5902738ac9e4177844db3">BREAK_ON_WRITE_ONLY</a></div><div class="ttdeci">@ BREAK_ON_WRITE_ONLY</div><div class="ttdef"><b>Definition</b> DataTypes.h:71</div></div>
<div class="ttc" id="a_debug_registers_8c_html_aaaab32c0c14718eb2283f9b3069043a8"><div class="ttname"><a href="_debug_registers_8c.html#aaaab32c0c14718eb2283f9b3069043a8">SetDebugRegisters</a></div><div class="ttdeci">BOOLEAN SetDebugRegisters(UINT32 DebugRegNum, DEBUG_REGISTER_TYPE ActionType, BOOLEAN ApplyToVmcs, UINT64 TargetAddress)</div><div class="ttdoc">Configure hardware debug register for access, write and fetch breakpoints.</div><div class="ttdef"><b>Definition</b> DebugRegisters.c:37</div></div>
<div class="ttc" id="a_export_8c_html_a1bb1308b9f10b9b5367452fc6f0dccba"><div class="ttname"><a href="_export_8c.html#a1bb1308b9f10b9b5367452fc6f0dccba">VmFuncSetSaveDebugControls</a></div><div class="ttdeci">VOID VmFuncSetSaveDebugControls(BOOLEAN Set)</div><div class="ttdoc">Set SAVE DEBUG CONTROLS on Vm-exit controls.</div><div class="ttdef"><b>Definition</b> Export.c:134</div></div>
<div class="ttc" id="a_export_8c_html_a49b87e679d87d6a073687e519b6c1f5a"><div class="ttname"><a href="_export_8c.html#a49b87e679d87d6a073687e519b6c1f5a">VmFuncSetMovDebugRegsExiting</a></div><div class="ttdeci">VOID VmFuncSetMovDebugRegsExiting(UINT32 CoreId, BOOLEAN Set)</div><div class="ttdoc">Set or unset the Mov to Debug Registers Exiting.</div><div class="ttdef"><b>Definition</b> Export.c:306</div></div>
<div class="ttc" id="a_export_8c_html_a70e24082858bcad5973f6d4aa2070e32"><div class="ttname"><a href="_export_8c.html#a70e24082858bcad5973f6d4aa2070e32">VmFuncSetLoadDebugControls</a></div><div class="ttdeci">VOID VmFuncSetLoadDebugControls(BOOLEAN Set)</div><div class="ttdoc">Set LOAD DEBUG CONTROLS on Vm-entry controls.</div><div class="ttdef"><b>Definition</b> Export.c:122</div></div>
<div class="ttc" id="a_export_8c_html_a837024687fafd5d17e1020eb6157923f"><div class="ttname"><a href="_export_8c.html#a837024687fafd5d17e1020eb6157923f">VmFuncSetExceptionBitmap</a></div><div class="ttdeci">VOID VmFuncSetExceptionBitmap(UINT32 CoreId, UINT32 IdtIndex)</div><div class="ttdoc">Set exception bitmap in VMCS.</div><div class="ttdef"><b>Definition</b> Export.c:253</div></div>
<div class="ttc" id="a_export_8c_html_acabb4a88d5b23a655b48c81114c6779e"><div class="ttname"><a href="_export_8c.html#acabb4a88d5b23a655b48c81114c6779e">VmFuncUnsetExceptionBitmap</a></div><div class="ttdeci">VOID VmFuncUnsetExceptionBitmap(UINT32 CoreId, UINT32 IdtIndex)</div><div class="ttdoc">Unset exception bitmap in VMCS.</div><div class="ttdef"><b>Definition</b> Export.c:267</div></div>
<div class="ttc" id="ahyperkd_2header_2debugger_2core_2_debugger_8h_html_a7f78d5db12abf3eb68376c3efbc479b1"><div class="ttname"><a href="hyperkd_2header_2debugger_2core_2_debugger_8h.html#a7f78d5db12abf3eb68376c3efbc479b1">DEBUGGER_DEBUG_REGISTER_FOR_THREAD_MANAGEMENT</a></div><div class="ttdeci">#define DEBUGGER_DEBUG_REGISTER_FOR_THREAD_MANAGEMENT</div><div class="ttdoc">debug register to monitor thread changes</div><div class="ttdef"><b>Definition</b> Debugger.h:26</div></div>
<div class="ttc" id="ainclude_2_s_d_k_2_headers_2_events_8h_html_af9640e4f7e36f7a6bf7c56e30a860349a56a4f1677785327990a937d52760d5a1"><div class="ttname"><a href="include_2_s_d_k_2_headers_2_events_8h.html#af9640e4f7e36f7a6bf7c56e30a860349a56a4f1677785327990a937d52760d5a1">EXCEPTION_VECTOR_DEBUG_BREAKPOINT</a></div><div class="ttdeci">@ EXCEPTION_VECTOR_DEBUG_BREAKPOINT</div><div class="ttdef"><b>Definition</b> Events.h:25</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a4a5e8eab22fff7fe0228f4fb2d61a0b0"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a4a5e8eab22fff7fe0228f4fb2d61a0b0">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::CurrentThreadLocationOnGs</a></div><div class="ttdeci">UINT64 CurrentThreadLocationOnGs</div><div class="ttdef"><b>Definition</b> State.h:55</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a828cb9812e870d901c9397930c02a451"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a828cb9812e870d901c9397930c02a451">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::DebugRegisterInterceptionState</a></div><div class="ttdeci">BOOLEAN DebugRegisterInterceptionState</div><div class="ttdef"><b>Definition</b> State.h:56</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a090832a74d330cde891a17bdd5b236e3"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">_PROCESSOR_DEBUGGING_STATE::CoreId</a></div><div class="ttdeci">UINT32 CoreId</div><div class="ttdef"><b>Definition</b> State.h:169</div></div>
<div class="ttc" id="astruct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e_html_a8f17ce3238c1b7fcd0e8a53040cba548"><div class="ttname"><a href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">_PROCESSOR_DEBUGGING_STATE::ThreadOrProcessTracingDetails</a></div><div class="ttdeci">DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS ThreadOrProcessTracingDetails</div><div class="ttdef"><b>Definition</b> State.h:178</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad49040845ab1e8d670ffa06bc9a80165" name="ad49040845ab1e8d670ffa06bc9a80165"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad49040845ab1e8d670ffa06bc9a80165">&#9670;&#160;</a></span>ThreadDetectChangeByInterceptingClockInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> ThreadDetectChangeByInterceptingClockInterrupts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Enable</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable or disable the thread change monitoring detection on the running core based on intercepting clock interrupts. </p>
<p>should be called on vmx root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">Enable</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  558</span>{</div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordflow">if</span> (Enable)</div>
<div class="line"><span class="lineno">  560</span>    {</div>
<div class="line"><span class="lineno">  561</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  562</span>        <span class="comment">// We should get the clock interrupts</span></div>
<div class="line"><span class="lineno">  563</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  564</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#abed37561390beafa280eb6b67b357c41">InterceptClockInterruptsForThreadChange</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  567</span>        <span class="comment">// Intercept external interrupts (for monitoring clock interrupts)</span></div>
<div class="line"><span class="lineno">  568</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  569</span>        <a class="code hl_function" href="_export_8c.html#a185cc0933a841df704415cbd38b84418">VmFuncSetExternalInterruptExiting</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno">  570</span>    }</div>
<div class="line"><span class="lineno">  571</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  572</span>    {</div>
<div class="line"><span class="lineno">  573</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  574</span>        <span class="comment">// We should ignore intercepting any further clock interrupts</span></div>
<div class="line"><span class="lineno">  575</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  576</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#abed37561390beafa280eb6b67b357c41">InterceptClockInterruptsForThreadChange</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  579</span>        <span class="comment">// Undo intercepting external interrupts</span></div>
<div class="line"><span class="lineno">  580</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  581</span>        <a class="code hl_function" href="_export_8c.html#a185cc0933a841df704415cbd38b84418">VmFuncSetExternalInterruptExiting</a>(DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a090832a74d330cde891a17bdd5b236e3">CoreId</a>, <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno">  582</span>    }</div>
<div class="line"><span class="lineno">  583</span>}</div>
<div class="ttc" id="a_export_8c_html_a185cc0933a841df704415cbd38b84418"><div class="ttname"><a href="_export_8c.html#a185cc0933a841df704415cbd38b84418">VmFuncSetExternalInterruptExiting</a></div><div class="ttdeci">VOID VmFuncSetExternalInterruptExiting(UINT32 CoreId, BOOLEAN Set)</div><div class="ttdoc">Set the External Interrupt Exiting.</div><div class="ttdef"><b>Definition</b> Export.c:280</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_abed37561390beafa280eb6b67b357c41"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#abed37561390beafa280eb6b67b357c41">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::InterceptClockInterruptsForThreadChange</a></div><div class="ttdeci">BOOLEAN InterceptClockInterruptsForThreadChange</div><div class="ttdef"><b>Definition</b> State.h:57</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9ca061b74ef1b8e8a3d999acf00d935" name="ae9ca061b74ef1b8e8a3d999acf00d935"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9ca061b74ef1b8e8a3d999acf00d935">&#9670;&#160;</a></span>ThreadEnableOrDisableThreadChangeMonitor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> ThreadEnableOrDisableThreadChangeMonitor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Enable</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>IsSwitchByClockIntrrupt</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable or disable the thread change monitoring detection on the running core. </p>
<p>should be called on vmx root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">Enable</td><td></td></tr>
    <tr><td class="paramname">IsSwitchByClockIntrrupt</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  600</span>{</div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span> (Enable)</div>
<div class="line"><span class="lineno">  602</span>    {</div>
<div class="line"><span class="lineno">  603</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a70d7d091a000bcc33a21c80a88d26bcf">InitialSetThreadChangeEvent</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  604</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a25f9fbca2be7d68aaf09566dfda0148b">InitialSetByClockInterrupt</a>  = IsSwitchByClockIntrrupt;</div>
<div class="line"><span class="lineno">  605</span>    }</div>
<div class="line"><span class="lineno">  606</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  607</span>    {</div>
<div class="line"><span class="lineno">  608</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  609</span>        <span class="comment">// Avoid future sets/unsets</span></div>
<div class="line"><span class="lineno">  610</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  611</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a70d7d091a000bcc33a21c80a88d26bcf">InitialSetThreadChangeEvent</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  612</span>        DbgState-&gt;<a class="code hl_variable" href="struct___p_r_o_c_e_s_s_o_r___d_e_b_u_g_g_i_n_g___s_t_a_t_e.html#a8f17ce3238c1b7fcd0e8a53040cba548">ThreadOrProcessTracingDetails</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a25f9fbca2be7d68aaf09566dfda0148b">InitialSetByClockInterrupt</a>  = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  613</span>    }</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  616</span>    <span class="comment">// Check if it&#39;s a HW breakpoint on gs:[188] or a clock interception</span></div>
<div class="line"><span class="lineno">  617</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  618</span>    <span class="keywordflow">if</span> (!IsSwitchByClockIntrrupt)</div>
<div class="line"><span class="lineno">  619</span>    {</div>
<div class="line"><span class="lineno">  620</span>        <a class="code hl_function" href="#a9c466e5cdf3b543bc8aad33c884be08b">ThreadDetectChangeByDebugRegisterOnGs</a>(DbgState, Enable);</div>
<div class="line"><span class="lineno">  621</span>    }</div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  623</span>    {</div>
<div class="line"><span class="lineno">  624</span>        <a class="code hl_function" href="#ad49040845ab1e8d670ffa06bc9a80165">ThreadDetectChangeByInterceptingClockInterrupts</a>(DbgState, Enable);</div>
<div class="line"><span class="lineno">  625</span>    }</div>
<div class="line"><span class="lineno">  626</span>}</div>
<div class="ttc" id="a_thread_8c_html_a9c466e5cdf3b543bc8aad33c884be08b"><div class="ttname"><a href="#a9c466e5cdf3b543bc8aad33c884be08b">ThreadDetectChangeByDebugRegisterOnGs</a></div><div class="ttdeci">VOID ThreadDetectChangeByDebugRegisterOnGs(PROCESSOR_DEBUGGING_STATE *DbgState, BOOLEAN Enable)</div><div class="ttdoc">Enable or disable the thread change monitoring detection on the running core based on putting a HW br...</div><div class="ttdef"><b>Definition</b> Thread.c:424</div></div>
<div class="ttc" id="a_thread_8c_html_ad49040845ab1e8d670ffa06bc9a80165"><div class="ttname"><a href="#ad49040845ab1e8d670ffa06bc9a80165">ThreadDetectChangeByInterceptingClockInterrupts</a></div><div class="ttdeci">VOID ThreadDetectChangeByInterceptingClockInterrupts(PROCESSOR_DEBUGGING_STATE *DbgState, BOOLEAN Enable)</div><div class="ttdoc">Enable or disable the thread change monitoring detection on the running core based on intercepting cl...</div><div class="ttdef"><b>Definition</b> Thread.c:556</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a25f9fbca2be7d68aaf09566dfda0148b"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a25f9fbca2be7d68aaf09566dfda0148b">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::InitialSetByClockInterrupt</a></div><div class="ttdeci">BOOLEAN InitialSetByClockInterrupt</div><div class="ttdef"><b>Definition</b> State.h:50</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s_html_a70d7d091a000bcc33a21c80a88d26bcf"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___p_r_o_c_e_s_s___o_r___t_h_r_e_a_d___t_r_a_c_i_n_g___d_e_t_a_i_l_s.html#a70d7d091a000bcc33a21c80a88d26bcf">_DEBUGGEE_PROCESS_OR_THREAD_TRACING_DETAILS::InitialSetThreadChangeEvent</a></div><div class="ttdeci">BOOLEAN InitialSetThreadChangeEvent</div><div class="ttdef"><b>Definition</b> State.h:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2d1b8ef9edfc052394e1b64cf6daf3d3" name="a2d1b8ef9edfc052394e1b64cf6daf3d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d1b8ef9edfc052394e1b64cf6daf3d3">&#9670;&#160;</a></span>ThreadHandleThreadChange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadHandleThreadChange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>handle thread changes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   23</span>{</div>
<div class="line"><span class="lineno">   24</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   25</span>    <span class="comment">// Check if we reached to the target thread or not</span></div>
<div class="line"><span class="lineno">   26</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   27</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#abbc1326ff13106f098eedd8126ce3857">ThreadId</a> != <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> &amp;&amp; <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#abbc1326ff13106f098eedd8126ce3857">ThreadId</a> == <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(PsGetCurrentThreadId())) ||</div>
<div class="line"><span class="lineno">   28</span>        (<a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#a8634fa6da6ae3bcf19fd9447e94c82b1">Thread</a> != <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a> &amp;&amp; <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#a8634fa6da6ae3bcf19fd9447e94c82b1">Thread</a> == PsGetCurrentThread()))</div>
<div class="line"><span class="lineno">   29</span>    {</div>
<div class="line"><span class="lineno">   30</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   31</span>        <span class="comment">// Halt the debuggee, we have found the target thread</span></div>
<div class="line"><span class="lineno">   32</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   33</span>        <a class="code hl_function" href="_kd_8c.html#a732bca2051e444c16d2d9a5080978981">KdHandleBreakpointAndDebugBreakpoints</a>(DbgState, <a class="code hl_enumvalue" href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21ba34eeb7b86b2c07a811b889005a26eea6">DEBUGGEE_PAUSING_REASON_DEBUGGEE_THREAD_SWITCHED</a>, NULL);</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   36</span>        <span class="comment">// Found</span></div>
<div class="line"><span class="lineno">   37</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   38</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">   39</span>    }</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   42</span>    <span class="comment">// Not found</span></div>
<div class="line"><span class="lineno">   43</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   44</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">   45</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a32ab457827837bf5ac123dd0fd8326ae"><div class="ttname"><a href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a></div><div class="ttdeci">#define NULL_ZERO</div><div class="ttdef"><b>Definition</b> BasicTypes.h:51</div></div>
<div class="ttc" id="a_basic_types_8h_html_a8a9df53f35cb95dddbe3c564259e01ad"><div class="ttname"><a href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a></div><div class="ttdeci">#define NULL64_ZERO</div><div class="ttdef"><b>Definition</b> BasicTypes.h:52</div></div>
<div class="ttc" id="a_connection_8h_html_a6e2be89205e735ebae644cf4850ac21ba34eeb7b86b2c07a811b889005a26eea6"><div class="ttname"><a href="_connection_8h.html#a6e2be89205e735ebae644cf4850ac21ba34eeb7b86b2c07a811b889005a26eea6">DEBUGGEE_PAUSING_REASON_DEBUGGEE_THREAD_SWITCHED</a></div><div class="ttdeci">@ DEBUGGEE_PAUSING_REASON_DEBUGGEE_THREAD_SWITCHED</div><div class="ttdef"><b>Definition</b> Connection.h:33</div></div>
<div class="ttc" id="a_kd_8c_html_a732bca2051e444c16d2d9a5080978981"><div class="ttname"><a href="_kd_8c.html#a732bca2051e444c16d2d9a5080978981">KdHandleBreakpointAndDebugBreakpoints</a></div><div class="ttdeci">_Use_decl_annotations_ VOID KdHandleBreakpointAndDebugBreakpoints(PROCESSOR_DEBUGGING_STATE *DbgState, DEBUGGEE_PAUSING_REASON Reason, PDEBUGGER_TRIGGERED_EVENT_DETAILS EventDetails)</div><div class="ttdoc">Handle #DBs and #BPs for kernel debugger.</div><div class="ttdef"><b>Definition</b> Kd.c:1214</div></div>
<div class="ttc" id="a_meta_macros_8h_html_ad790279846c85a5a453f2e7a4e02abad"><div class="ttname"><a href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a></div><div class="ttdeci">#define HANDLE_TO_UINT32(_var)</div><div class="ttdef"><b>Definition</b> MetaMacros.h:39</div></div>
<div class="ttc" id="ahyperkd_2header_2globals_2_global_8h_html_ac4bd01d0cf0973fbceb4306bde6172dd"><div class="ttname"><a href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a></div><div class="ttdeci">DEBUGGEE_REQUEST_TO_CHANGE_THREAD g_ThreadSwitch</div><div class="ttdoc">Thread switch to ETHREAD or Thread ID.</div><div class="ttdef"><b>Definition</b> Global.h:73</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d_html_a8634fa6da6ae3bcf19fd9447e94c82b1"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#a8634fa6da6ae3bcf19fd9447e94c82b1">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD::Thread</a></div><div class="ttdeci">PVOID Thread</div><div class="ttdef"><b>Definition</b> Kd.h:52</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d_html_abbc1326ff13106f098eedd8126ce3857"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#abbc1326ff13106f098eedd8126ce3857">_DEBUGGEE_REQUEST_TO_CHANGE_THREAD::ThreadId</a></div><div class="ttdeci">UINT32 ThreadId</div><div class="ttdef"><b>Definition</b> Kd.h:51</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad8c042931ebdc36724bdc32358515be5" name="ad8c042931ebdc36724bdc32358515be5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8c042931ebdc36724bdc32358515be5">&#9670;&#160;</a></span>ThreadInterpretThread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadInterpretThread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#a4276aa25d9666471ade93e0abba28471">PDEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET</a></td>          <td class="paramname"><span class="paramname"><em>TidRequest</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change the current thread </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">TidRequest</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  327</span>{</div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordflow">switch</span> (TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a110a784944b26cb36258de4231daaa00">ActionType</a>)</div>
<div class="line"><span class="lineno">  329</span>    {</div>
<div class="line"><span class="lineno">  330</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14aa6d17307342d79707d70b0300a206202">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_DETAILS</a>:</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  333</span>        <span class="comment">// Debugger wants to know current tid, nt!_ETHREAD and process name, etc.</span></div>
<div class="line"><span class="lineno">  334</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  335</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a6b2fec29566ee0986de30299150b7b09">ProcessId</a> = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(PsGetCurrentProcessId());</div>
<div class="line"><span class="lineno">  336</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#aa9fc083c3821012012226feb49219c60">ThreadId</a>  = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(PsGetCurrentThreadId());</div>
<div class="line"><span class="lineno">  337</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a5ae8867649ea6cd0947cdd8aa4e423e5">Process</a>   = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentProcess();</div>
<div class="line"><span class="lineno">  338</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a36252b53911e94458085210ebc4e0611">Thread</a>    = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentThread();</div>
<div class="line"><span class="lineno">  339</span>        <a class="code hl_function" href="_memory_mapper_8c.html#ac3c23d5644111a6be18ca274f448e9ff">MemoryMapperReadMemorySafe</a>((<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)<a class="code hl_function" href="hyperhv_2code_2common_2_common_8c.html#a946bc64669622da91eb9b08bb85f4956">CommonGetProcessNameFromProcessControlBlock</a>(PsGetCurrentProcess()), &amp;TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a9ff4d4d1a19ad084750274fc5d14c9f6">ProcessName</a>, 16);</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  342</span>        <span class="comment">// Operation was successful</span></div>
<div class="line"><span class="lineno">  343</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  344</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14a826bdbc787efbf59a8b836114008d300">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PERFORM_SWITCH</a>:</div>
<div class="line"><span class="lineno">  349</span> </div>
<div class="line"><span class="lineno">  350</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  351</span>        <span class="comment">// Perform the thread switch</span></div>
<div class="line"><span class="lineno">  352</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  353</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#aff010811e49c6d5face89ba31da2e0b4">ThreadSwitch</a>(DbgState,</div>
<div class="line"><span class="lineno">  354</span>                          TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#aa9fc083c3821012012226feb49219c60">ThreadId</a>,</div>
<div class="line"><span class="lineno">  355</span>                          (PETHREAD)TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a36252b53911e94458085210ebc4e0611">Thread</a>,</div>
<div class="line"><span class="lineno">  356</span>                          TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#acc6e02c3d093d08bd96f804309561776">CheckByClockInterrupt</a>))</div>
<div class="line"><span class="lineno">  357</span>        {</div>
<div class="line"><span class="lineno">  358</span>            TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#a4d9bacfb22824ffd68eefdd189938281">DEBUGGER_ERROR_DETAILS_OR_SWITCH_THREAD_INVALID_PARAMETER</a>;</div>
<div class="line"><span class="lineno">  359</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  360</span>        }</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  363</span>        <span class="comment">// Operation was successful</span></div>
<div class="line"><span class="lineno">  364</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  365</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  368</span> </div>
<div class="line"><span class="lineno">  369</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14a516e0cdb60796ff25b0215dee4e327a0">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_LIST</a>:</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  372</span>        <span class="comment">// Show the threads list</span></div>
<div class="line"><span class="lineno">  373</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="#a1f18246abe755d7ba1f5bdccb9c078ec">ThreadShowList</a>(&amp;TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a4ae6fed5cbd0179862e181dc5e16f073">ThreadListSymDetails</a>,</div>
<div class="line"><span class="lineno">  375</span>                            <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a953106ee52315b5082e34b933b0f947a">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_SHOW_INSTANTLY</a>,</div>
<div class="line"><span class="lineno">  376</span>                            NULL,</div>
<div class="line"><span class="lineno">  377</span>                            NULL,</div>
<div class="line"><span class="lineno">  378</span>                            (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)NULL))</div>
<div class="line"><span class="lineno">  379</span>        {</div>
<div class="line"><span class="lineno">  380</span>            TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#a4d9bacfb22824ffd68eefdd189938281">DEBUGGER_ERROR_DETAILS_OR_SWITCH_THREAD_INVALID_PARAMETER</a>;</div>
<div class="line"><span class="lineno">  381</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  382</span>        }</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  385</span>        <span class="comment">// Operation was successful</span></div>
<div class="line"><span class="lineno">  386</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  387</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  394</span>        <span class="comment">// Invalid type of action</span></div>
<div class="line"><span class="lineno">  395</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  396</span>        TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#a4d9bacfb22824ffd68eefdd189938281">DEBUGGER_ERROR_DETAILS_OR_SWITCH_THREAD_INVALID_PARAMETER</a>;</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  399</span>    }</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  402</span>    <span class="comment">// Check if the above operation contains error</span></div>
<div class="line"><span class="lineno">  403</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  404</span>    <span class="keywordflow">if</span> (TidRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> == <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>)</div>
<div class="line"><span class="lineno">  405</span>    {</div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  407</span>    }</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  409</span>    {</div>
<div class="line"><span class="lineno">  410</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  411</span>    }</div>
<div class="line"><span class="lineno">  412</span>}</div>
<div class="ttc" id="a_error_codes_8h_html_a4d9bacfb22824ffd68eefdd189938281"><div class="ttname"><a href="_error_codes_8h.html#a4d9bacfb22824ffd68eefdd189938281">DEBUGGER_ERROR_DETAILS_OR_SWITCH_THREAD_INVALID_PARAMETER</a></div><div class="ttdeci">#define DEBUGGER_ERROR_DETAILS_OR_SWITCH_THREAD_INVALID_PARAMETER</div><div class="ttdoc">error, for thread switch or thread details, invalid parameter</div><div class="ttdef"><b>Definition</b> ErrorCodes.h:239</div></div>
<div class="ttc" id="a_error_codes_8h_html_aed656c58434eecb2d7e8c10e93aecff4"><div class="ttname"><a href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a></div><div class="ttdeci">#define DEBUGGER_OPERATION_WAS_SUCCESSFUL</div><div class="ttdoc">General value to indicate that the operation or request was successful.</div><div class="ttdef"><b>Definition</b> ErrorCodes.h:23</div></div>
<div class="ttc" id="a_memory_mapper_8c_html_ac3c23d5644111a6be18ca274f448e9ff"><div class="ttname"><a href="_memory_mapper_8c.html#ac3c23d5644111a6be18ca274f448e9ff">MemoryMapperReadMemorySafe</a></div><div class="ttdeci">_Use_decl_annotations_ BOOLEAN MemoryMapperReadMemorySafe(UINT64 VaAddressToRead, PVOID BufferToSaveMemory, SIZE_T SizeToRead)</div><div class="ttdoc">Read memory safely by mapping the buffer (It's a wrapper)</div><div class="ttdef"><b>Definition</b> MemoryMapper.c:1101</div></div>
<div class="ttc" id="a_request_structures_8h_html_a7a3955d43cb53d79a1f2a7e20d37da14a516e0cdb60796ff25b0215dee4e327a0"><div class="ttname"><a href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14a516e0cdb60796ff25b0215dee4e327a0">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_LIST</a></div><div class="ttdeci">@ DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_LIST</div><div class="ttdef"><b>Definition</b> RequestStructures.h:954</div></div>
<div class="ttc" id="a_request_structures_8h_html_a7a3955d43cb53d79a1f2a7e20d37da14a826bdbc787efbf59a8b836114008d300"><div class="ttname"><a href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14a826bdbc787efbf59a8b836114008d300">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PERFORM_SWITCH</a></div><div class="ttdeci">@ DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PERFORM_SWITCH</div><div class="ttdef"><b>Definition</b> RequestStructures.h:952</div></div>
<div class="ttc" id="a_request_structures_8h_html_a7a3955d43cb53d79a1f2a7e20d37da14aa6d17307342d79707d70b0300a206202"><div class="ttname"><a href="_request_structures_8h.html#a7a3955d43cb53d79a1f2a7e20d37da14aa6d17307342d79707d70b0300a206202">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_DETAILS</a></div><div class="ttdeci">@ DEBUGGEE_DETAILS_AND_SWITCH_THREAD_GET_THREAD_DETAILS</div><div class="ttdef"><b>Definition</b> RequestStructures.h:953</div></div>
<div class="ttc" id="a_request_structures_8h_html_afac007ba1abb5a5ef542e8731170c9a5a953106ee52315b5082e34b933b0f947a"><div class="ttname"><a href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a953106ee52315b5082e34b933b0f947a">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_SHOW_INSTANTLY</a></div><div class="ttdeci">@ DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_SHOW_INSTANTLY</div><div class="ttdef"><b>Definition</b> RequestStructures.h:672</div></div>
<div class="ttc" id="a_thread_8c_html_a1f18246abe755d7ba1f5bdccb9c078ec"><div class="ttname"><a href="#a1f18246abe755d7ba1f5bdccb9c078ec">ThreadShowList</a></div><div class="ttdeci">BOOLEAN ThreadShowList(PDEBUGGEE_THREAD_LIST_NEEDED_DETAILS ThreadListSymbolInfo, DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTIONS QueryAction, UINT32 *CountOfThreads, PVOID ListSaveBuffer, UINT64 ListSaveBuffSize)</div><div class="ttdoc">shows the threads list</div><div class="ttdef"><b>Definition</b> Thread.c:122</div></div>
<div class="ttc" id="a_thread_8c_html_aff010811e49c6d5face89ba31da2e0b4"><div class="ttname"><a href="#aff010811e49c6d5face89ba31da2e0b4">ThreadSwitch</a></div><div class="ttdeci">BOOLEAN ThreadSwitch(PROCESSOR_DEBUGGING_STATE *DbgState, UINT32 ThreadId, PETHREAD EThread, BOOLEAN CheckByClockInterrupt)</div><div class="ttdoc">make evnvironment ready to change the thread</div><div class="ttdef"><b>Definition</b> Thread.c:58</div></div>
<div class="ttc" id="ahyperhv_2code_2common_2_common_8c_html_a946bc64669622da91eb9b08bb85f4956"><div class="ttname"><a href="hyperhv_2code_2common_2_common_8c.html#a946bc64669622da91eb9b08bb85f4956">CommonGetProcessNameFromProcessControlBlock</a></div><div class="ttdeci">PCHAR CommonGetProcessNameFromProcessControlBlock(PEPROCESS Eprocess)</div><div class="ttdoc">Get process name by eprocess.</div><div class="ttdef"><b>Definition</b> Common.c:48</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a110a784944b26cb36258de4231daaa00"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a110a784944b26cb36258de4231daaa00">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::ActionType</a></div><div class="ttdeci">DEBUGGEE_DETAILS_AND_SWITCH_THREAD_TYPE ActionType</div><div class="ttdef"><b>Definition</b> RequestStructures.h:964</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a36252b53911e94458085210ebc4e0611"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a36252b53911e94458085210ebc4e0611">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::Thread</a></div><div class="ttdeci">UINT64 Thread</div><div class="ttdef"><b>Definition</b> RequestStructures.h:967</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a4ae6fed5cbd0179862e181dc5e16f073"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a4ae6fed5cbd0179862e181dc5e16f073">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::ThreadListSymDetails</a></div><div class="ttdeci">DEBUGGEE_THREAD_LIST_NEEDED_DETAILS ThreadListSymDetails</div><div class="ttdef"><b>Definition</b> RequestStructures.h:971</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a5ae8867649ea6cd0947cdd8aa4e423e5"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a5ae8867649ea6cd0947cdd8aa4e423e5">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::Process</a></div><div class="ttdeci">UINT64 Process</div><div class="ttdef"><b>Definition</b> RequestStructures.h:968</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a6b2fec29566ee0986de30299150b7b09"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a6b2fec29566ee0986de30299150b7b09">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::ProcessId</a></div><div class="ttdeci">UINT32 ProcessId</div><div class="ttdef"><b>Definition</b> RequestStructures.h:966</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_a9ff4d4d1a19ad084750274fc5d14c9f6"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a9ff4d4d1a19ad084750274fc5d14c9f6">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::ProcessName</a></div><div class="ttdeci">UCHAR ProcessName[16]</div><div class="ttdef"><b>Definition</b> RequestStructures.h:970</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_aa9fc083c3821012012226feb49219c60"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#aa9fc083c3821012012226feb49219c60">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::ThreadId</a></div><div class="ttdeci">UINT32 ThreadId</div><div class="ttdef"><b>Definition</b> RequestStructures.h:965</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_acc6e02c3d093d08bd96f804309561776"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#acc6e02c3d093d08bd96f804309561776">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::CheckByClockInterrupt</a></div><div class="ttdeci">BOOLEAN CheckByClockInterrupt</div><div class="ttdef"><b>Definition</b> RequestStructures.h:969</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t_html_af8c6bc7ae42ae48b4fc727cb6739ca03"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">_DEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET::Result</a></div><div class="ttdeci">UINT32 Result</div><div class="ttdef"><b>Definition</b> RequestStructures.h:972</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adcbd4c472009e7a20c3c4df7fb92b0eb" name="adcbd4c472009e7a20c3c4df7fb92b0eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcbd4c472009e7a20c3c4df7fb92b0eb">&#9670;&#160;</a></span>ThreadQueryCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadQueryCount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#a088abddf56a4e18ca3595540dec693b4">PDEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS</a></td>          <td class="paramname"><span class="paramname"><em>DebuggerUsermodeProcessOrThreadQueryRequest</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query thread details (count) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DebuggerUsermodeProcessOrThreadQueryRequest</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  637</span>{</div>
<div class="line"><span class="lineno">  638</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Result = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  641</span>    <span class="comment">// Getting the count results</span></div>
<div class="line"><span class="lineno">  642</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  643</span>    Result = <a class="code hl_function" href="#a1f18246abe755d7ba1f5bdccb9c078ec">ThreadShowList</a>(&amp;DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a4d47dd5e36285299c4cb50be65c681e5">ThreadListNeededDetails</a>,</div>
<div class="line"><span class="lineno">  644</span>                            <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</a>,</div>
<div class="line"><span class="lineno">  645</span>                            &amp;DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a0272b2e3193cf825b830a05053f8bee6">Count</a>,</div>
<div class="line"><span class="lineno">  646</span>                            NULL,</div>
<div class="line"><span class="lineno">  647</span>                            (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)NULL);</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span>    <span class="keywordflow">if</span> (Result &amp;&amp; DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a0272b2e3193cf825b830a05053f8bee6">Count</a> != 0)</div>
<div class="line"><span class="lineno">  650</span>    {</div>
<div class="line"><span class="lineno">  651</span>        DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a68f4ee9252d08afc97f7aa8bba4fe899">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  652</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  653</span>    }</div>
<div class="line"><span class="lineno">  654</span> </div>
<div class="line"><span class="lineno">  655</span>    DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a68f4ee9252d08afc97f7aa8bba4fe899">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#af49ac2304716014da5d40763e309af3e">DEBUGGER_ERROR_UNABLE_TO_QUERY_COUNT_OF_PROCESSES_OR_THREADS</a>;</div>
<div class="line"><span class="lineno">  656</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  657</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a1cb18096b299d23458d3c7b85fd86555"><div class="ttname"><a href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></div><div class="ttdeci">UCHAR BOOLEAN</div><div class="ttdef"><b>Definition</b> BasicTypes.h:39</div></div>
<div class="ttc" id="a_error_codes_8h_html_af49ac2304716014da5d40763e309af3e"><div class="ttname"><a href="_error_codes_8h.html#af49ac2304716014da5d40763e309af3e">DEBUGGER_ERROR_UNABLE_TO_QUERY_COUNT_OF_PROCESSES_OR_THREADS</a></div><div class="ttdeci">#define DEBUGGER_ERROR_UNABLE_TO_QUERY_COUNT_OF_PROCESSES_OR_THREADS</div><div class="ttdoc">error, unable to query count of processes or threads</div><div class="ttdef"><b>Definition</b> ErrorCodes.h:386</div></div>
<div class="ttc" id="a_request_structures_8h_html_afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53"><div class="ttname"><a href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</a></div><div class="ttdeci">@ DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</div><div class="ttdef"><b>Definition</b> RequestStructures.h:673</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s_html_a0272b2e3193cf825b830a05053f8bee6"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a0272b2e3193cf825b830a05053f8bee6">_DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS::Count</a></div><div class="ttdeci">UINT32 Count</div><div class="ttdef"><b>Definition</b> RequestStructures.h:747</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s_html_a4d47dd5e36285299c4cb50be65c681e5"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a4d47dd5e36285299c4cb50be65c681e5">_DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS::ThreadListNeededDetails</a></div><div class="ttdeci">DEBUGGEE_THREAD_LIST_NEEDED_DETAILS ThreadListNeededDetails</div><div class="ttdef"><b>Definition</b> RequestStructures.h:744</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s_html_a68f4ee9252d08afc97f7aa8bba4fe899"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a68f4ee9252d08afc97f7aa8bba4fe899">_DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS::Result</a></div><div class="ttdeci">UINT64 Result</div><div class="ttdef"><b>Definition</b> RequestStructures.h:748</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a754b5d3e15081f32fa9da2eef670e0fb" name="a754b5d3e15081f32fa9da2eef670e0fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a754b5d3e15081f32fa9da2eef670e0fb">&#9670;&#160;</a></span>ThreadQueryDetails()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadQueryDetails </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#a4276aa25d9666471ade93e0abba28471">PDEBUGGEE_DETAILS_AND_SWITCH_THREAD_PACKET</a></td>          <td class="paramname"><span class="paramname"><em>GetInformationThreadRequest</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query thread details. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GetInformationThreadRequest</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  696</span>{</div>
<div class="line"><span class="lineno">  697</span>    GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a6b2fec29566ee0986de30299150b7b09">ProcessId</a> = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(PsGetCurrentProcessId());</div>
<div class="line"><span class="lineno">  698</span>    GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a5ae8867649ea6cd0947cdd8aa4e423e5">Process</a>   = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentProcess();</div>
<div class="line"><span class="lineno">  699</span>    GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a36252b53911e94458085210ebc4e0611">Thread</a>    = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentThread();</div>
<div class="line"><span class="lineno">  700</span>    GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#aa9fc083c3821012012226feb49219c60">ThreadId</a>  = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(PsGetCurrentThreadId());</div>
<div class="line"><span class="lineno">  701</span> </div>
<div class="line"><span class="lineno">  702</span>    RtlCopyMemory(&amp;GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#a9ff4d4d1a19ad084750274fc5d14c9f6">ProcessName</a>,</div>
<div class="line"><span class="lineno">  703</span>                  <a class="code hl_function" href="hyperhv_2code_2common_2_common_8c.html#a946bc64669622da91eb9b08bb85f4956">CommonGetProcessNameFromProcessControlBlock</a>(PsGetCurrentProcess()),</div>
<div class="line"><span class="lineno">  704</span>                  15);</div>
<div class="line"><span class="lineno">  705</span> </div>
<div class="line"><span class="lineno">  706</span>    GetInformationThreadRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___d_e_t_a_i_l_s___a_n_d___s_w_i_t_c_h___t_h_r_e_a_d___p_a_c_k_e_t.html#af8c6bc7ae42ae48b4fc727cb6739ca03">Result</a> = <a class="code hl_define" href="_error_codes_8h.html#aed656c58434eecb2d7e8c10e93aecff4">DEBUGGER_OPERATION_WAS_SUCCESSFUL</a>;</div>
<div class="line"><span class="lineno">  707</span> </div>
<div class="line"><span class="lineno">  708</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  709</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e0982ba2738bd6c7ceb426e2995fd0f" name="a8e0982ba2738bd6c7ceb426e2995fd0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e0982ba2738bd6c7ceb426e2995fd0f">&#9670;&#160;</a></span>ThreadQueryList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadQueryList </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#a088abddf56a4e18ca3595540dec693b4">PDEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS</a></td>          <td class="paramname"><span class="paramname"><em>DebuggerUsermodeProcessOrThreadQueryRequest</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID</td>          <td class="paramname"><span class="paramname"><em>AddressToSaveDetail</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>BufferSize</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query thread details (list) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DebuggerUsermodeProcessOrThreadQueryRequest</td><td></td></tr>
    <tr><td class="paramname">AddressToSaveDetail</td><td></td></tr>
    <tr><td class="paramname">BufferSize</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  672</span>{</div>
<div class="line"><span class="lineno">  673</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Result = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  676</span>    <span class="comment">// Getting the list of threads</span></div>
<div class="line"><span class="lineno">  677</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  678</span>    Result = <a class="code hl_function" href="#a1f18246abe755d7ba1f5bdccb9c078ec">ThreadShowList</a>(&amp;DebuggerUsermodeProcessOrThreadQueryRequest-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_r___q_u_e_r_y___a_c_t_i_v_e___p_r_o_c_e_s_s_e_s___o_r___t_h_r_e_a_d_s.html#a4d47dd5e36285299c4cb50be65c681e5">ThreadListNeededDetails</a>,</div>
<div class="line"><span class="lineno">  679</span>                            <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</a>,</div>
<div class="line"><span class="lineno">  680</span>                            NULL,</div>
<div class="line"><span class="lineno">  681</span>                            AddressToSaveDetail,</div>
<div class="line"><span class="lineno">  682</span>                            BufferSize);</div>
<div class="line"><span class="lineno">  683</span> </div>
<div class="line"><span class="lineno">  684</span>    <span class="keywordflow">return</span> Result;</div>
<div class="line"><span class="lineno">  685</span>}</div>
<div class="ttc" id="a_request_structures_8h_html_afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e"><div class="ttname"><a href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</a></div><div class="ttdeci">@ DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</div><div class="ttdef"><b>Definition</b> RequestStructures.h:674</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f18246abe755d7ba1f5bdccb9c078ec" name="a1f18246abe755d7ba1f5bdccb9c078ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f18246abe755d7ba1f5bdccb9c078ec">&#9670;&#160;</a></span>ThreadShowList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadShowList </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#a2ff4a7d527d38937426e87036e9eb4a8">PDEBUGGEE_THREAD_LIST_NEEDED_DETAILS</a></td>          <td class="paramname"><span class="paramname"><em>ThreadListSymbolInfo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_request_structures_8h.html#af3eeb6f563c3ce604d30ae789c1682aa">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTIONS</a></td>          <td class="paramname"><span class="paramname"><em>QueryAction</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> *</td>          <td class="paramname"><span class="paramname"><em>CountOfThreads</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PVOID</td>          <td class="paramname"><span class="paramname"><em>ListSaveBuffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>ListSaveBuffSize</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shows the threads list </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ThreadListSymbolInfo</td><td></td></tr>
    <tr><td class="paramname">QueryAction</td><td></td></tr>
    <tr><td class="paramname">CountOfThreads</td><td></td></tr>
    <tr><td class="paramname">ListSaveBuffer</td><td></td></tr>
    <tr><td class="paramname">ListSaveBuffSize</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  127</span>{</div>
<div class="line"><span class="lineno">  128</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                              ThreadListHead;</div>
<div class="line"><span class="lineno">  129</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                              EnumerationCount   = 0;</div>
<div class="line"><span class="lineno">  130</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>                              Thread             = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)NULL;</div>
<div class="line"><span class="lineno">  131</span>    LIST_ENTRY                          ThreadLinks        = {0};</div>
<div class="line"><span class="lineno">  132</span>    CLIENT_ID                           ThreadCid          = {0};</div>
<div class="line"><span class="lineno">  133</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>                              MaximumBufferCount = 0;</div>
<div class="line"><span class="lineno">  134</span>    <a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html">PDEBUGGEE_THREAD_LIST_DETAILS_ENTRY</a> SavingEntries      = ListSaveBuffer;</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  137</span>    <span class="comment">// validate parameters</span></div>
<div class="line"><span class="lineno">  138</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordflow">if</span> (QueryAction == <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  140</span>        CountOfThreads == NULL)</div>
<div class="line"><span class="lineno">  141</span>    {</div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  143</span>    }</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordflow">if</span> (QueryAction == <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  146</span>        (ListSaveBuffer == NULL || ListSaveBuffSize == 0))</div>
<div class="line"><span class="lineno">  147</span>    {</div>
<div class="line"><span class="lineno">  148</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  149</span>    }</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  152</span>    <span class="comment">// compute size to avoid overflow</span></div>
<div class="line"><span class="lineno">  153</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  154</span>    <span class="keywordflow">if</span> (QueryAction == <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</a>)</div>
<div class="line"><span class="lineno">  155</span>    {</div>
<div class="line"><span class="lineno">  156</span>        MaximumBufferCount = (<a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>)(ListSaveBuffSize / <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html">DEBUGGEE_THREAD_LIST_DETAILS_ENTRY</a>));</div>
<div class="line"><span class="lineno">  157</span>    }</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ThreadListHeadOffset       = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#a34cd6c5fa97ee7f1ecf46a184cb7ea1e">ThreadListHeadOffset</a>;     <span class="comment">// nt!_EPROCESS.ThreadListHead</span></div>
<div class="line"><span class="lineno">  160</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ThreadListEntryOffset      = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#aa32e030eeb141ef3d04a707b514a400c">ThreadListEntryOffset</a>;    <span class="comment">// nt!_ETHREAD.ThreadListEntry</span></div>
<div class="line"><span class="lineno">  161</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CidOffset                  = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#a92dc0b206b904cf3374c5a553afb6d7e">CidOffset</a>;                <span class="comment">// nt!_ETHREAD.Cid</span></div>
<div class="line"><span class="lineno">  162</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ActiveProcessLinksOffset   = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#ae83da808851403416b7f694caddb6c08">ActiveProcessLinksOffset</a>; <span class="comment">// nt!_EPROCESS.ActiveProcessLinks</span></div>
<div class="line"><span class="lineno">  163</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> PsActiveProcessHeadAddress = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#ac8ef9b6a9e179171da786233efc498c5">PsActiveProcessHead</a>;      <span class="comment">// nt!PsActiveProcessHead</span></div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  166</span>    <span class="comment">// Validate params</span></div>
<div class="line"><span class="lineno">  167</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  168</span>    <span class="keywordflow">if</span> (ThreadListHeadOffset == <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> ||</div>
<div class="line"><span class="lineno">  169</span>        ThreadListEntryOffset == <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> ||</div>
<div class="line"><span class="lineno">  170</span>        CidOffset == <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> ||</div>
<div class="line"><span class="lineno">  171</span>        ActiveProcessLinksOffset == <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> ||</div>
<div class="line"><span class="lineno">  172</span>        PsActiveProcessHeadAddress == <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>)</div>
<div class="line"><span class="lineno">  173</span>    {</div>
<div class="line"><span class="lineno">  174</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  178</span>    <span class="comment">// Set the target process</span></div>
<div class="line"><span class="lineno">  179</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  180</span>    <span class="keywordflow">if</span> (ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a> == <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>)</div>
<div class="line"><span class="lineno">  181</span>    {</div>
<div class="line"><span class="lineno">  182</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  183</span>        <span class="comment">// Means that it&#39;s for the current process</span></div>
<div class="line"><span class="lineno">  184</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  185</span>        ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a> = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentProcess();</div>
<div class="line"><span class="lineno">  186</span>        ThreadListHead                = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)PsGetCurrentProcess() + ThreadListHeadOffset;</div>
<div class="line"><span class="lineno">  187</span>    }</div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  189</span>    {</div>
<div class="line"><span class="lineno">  190</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  191</span>        <span class="comment">// Means that the user specified a special process</span></div>
<div class="line"><span class="lineno">  192</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  193</span>        ThreadListHead = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a> + ThreadListHeadOffset;</div>
<div class="line"><span class="lineno">  194</span>    }</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  197</span>    <span class="comment">// Check if the process&#39;s thread list head is valid or not</span></div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  199</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="_address_check_8c.html#aec71cec56c29db61a23b2997ee8e2059">CheckAccessValidityAndSafety</a>(ThreadListHead, <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="_basic_types_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)))</div>
<div class="line"><span class="lineno">  200</span>    {</div>
<div class="line"><span class="lineno">  201</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  202</span>    }</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  205</span>    <span class="comment">// Check if the nt!_EPROCESS is valid or not (available in the system or not)</span></div>
<div class="line"><span class="lineno">  206</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="_process_8c.html#aab39c37cefd5d15192160f8cb9e3d66a">ProcessCheckIfEprocessIsValid</a>(ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a>,</div>
<div class="line"><span class="lineno">  208</span>                                       PsActiveProcessHeadAddress,</div>
<div class="line"><span class="lineno">  209</span>                                       ActiveProcessLinksOffset))</div>
<div class="line"><span class="lineno">  210</span>    {</div>
<div class="line"><span class="lineno">  211</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  212</span>    }</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">if</span> (QueryAction == <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a953106ee52315b5082e34b933b0f947a">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_SHOW_INSTANTLY</a>)</div>
<div class="line"><span class="lineno">  215</span>    {</div>
<div class="line"><span class="lineno">  216</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  217</span>        <span class="comment">// Show the message of show the process</span></div>
<div class="line"><span class="lineno">  218</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  219</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a0c38ca677b912fa03329447f5e235dc2">Log</a>(<span class="stringliteral">&quot;PROCESS\t%llx\tIMAGE\t%s\n&quot;</span>,</div>
<div class="line"><span class="lineno">  220</span>            ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a>,</div>
<div class="line"><span class="lineno">  221</span>            <a class="code hl_function" href="hyperhv_2code_2common_2_common_8c.html#a946bc64669622da91eb9b08bb85f4956">CommonGetProcessNameFromProcessControlBlock</a>((PEPROCESS)ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a>));</div>
<div class="line"><span class="lineno">  222</span>    }</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  225</span>    <span class="comment">// Show thread list, we read everything from the view of system process</span></div>
<div class="line"><span class="lineno">  226</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  227</span>    <a class="code hl_function" href="_memory_mapper_8c.html#ac3c23d5644111a6be18ca274f448e9ff">MemoryMapperReadMemorySafe</a>(ThreadListHead, &amp;ThreadLinks, <span class="keyword">sizeof</span>(ThreadLinks));</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  230</span>    <span class="comment">// Find the top of ETHREAD from nt!_ETHREAD.ThreadListEntry</span></div>
<div class="line"><span class="lineno">  231</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  232</span>    Thread = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)ThreadLinks.Flink - ThreadListEntryOffset;</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno">  235</span>    {</div>
<div class="line"><span class="lineno">  236</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  237</span>        <span class="comment">// Show thread list, we read everything from the view of system process</span></div>
<div class="line"><span class="lineno">  238</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  239</span>        <a class="code hl_function" href="_memory_mapper_8c.html#ac3c23d5644111a6be18ca274f448e9ff">MemoryMapperReadMemorySafe</a>(Thread + CidOffset,</div>
<div class="line"><span class="lineno">  240</span>                                   &amp;ThreadCid,</div>
<div class="line"><span class="lineno">  241</span>                                   <span class="keyword">sizeof</span>(ThreadCid));</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">switch</span> (QueryAction)</div>
<div class="line"><span class="lineno">  244</span>        {</div>
<div class="line"><span class="lineno">  245</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a953106ee52315b5082e34b933b0f947a">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_SHOW_INSTANTLY</a>:</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  248</span>            <span class="comment">// Show the list of process</span></div>
<div class="line"><span class="lineno">  249</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  250</span>            <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#a0c38ca677b912fa03329447f5e235dc2">Log</a>(<span class="stringliteral">&quot;\tTHREAD\t%llx (%llx.%llx)\n&quot;</span>, Thread, ThreadCid.UniqueProcess, ThreadCid.UniqueThread);</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</a>:</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>            EnumerationCount++;</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5a1f0f3cfcf4074ccd4175902b3a35bd0e">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_SAVE_DETAILS</a>:</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>            EnumerationCount++;</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  265</span>            <span class="comment">// Check to avoid overflow</span></div>
<div class="line"><span class="lineno">  266</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  267</span>            <span class="keywordflow">if</span> (EnumerationCount == MaximumBufferCount - 1)</div>
<div class="line"><span class="lineno">  268</span>            {</div>
<div class="line"><span class="lineno">  269</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  270</span>                <span class="comment">// buffer is full</span></div>
<div class="line"><span class="lineno">  271</span>                <span class="comment">//</span></div>
<div class="line"><span class="lineno">  272</span>                <span class="keywordflow">goto</span> ReturnEnd;</div>
<div class="line"><span class="lineno">  273</span>            }</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  276</span>            <span class="comment">// Save the details</span></div>
<div class="line"><span class="lineno">  277</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  278</span>            SavingEntries[EnumerationCount - 1].<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a90c4000a499cf8b02e8856939ff6e466">Eprocess</a>  = ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a>;</div>
<div class="line"><span class="lineno">  279</span>            SavingEntries[EnumerationCount - 1].<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#aa762b2e998c44922ed7d8a23a9ad10ef">ProcessId</a> = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(ThreadCid.UniqueProcess);</div>
<div class="line"><span class="lineno">  280</span>            SavingEntries[EnumerationCount - 1].<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a7ab69b329c6f3a806c348a202b773528">ThreadId</a>  = <a class="code hl_define" href="_meta_macros_8h.html#ad790279846c85a5a453f2e7a4e02abad">HANDLE_TO_UINT32</a>(ThreadCid.UniqueThread);</div>
<div class="line"><span class="lineno">  281</span>            SavingEntries[EnumerationCount - 1].<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a4d5bcd5d2b9b714004bb64131aa60aff">Ethread</a>   = Thread;</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>            RtlCopyMemory(&amp;SavingEntries[EnumerationCount - 1].ImageFileName,</div>
<div class="line"><span class="lineno">  284</span>                          <a class="code hl_function" href="hyperhv_2code_2common_2_common_8c.html#a946bc64669622da91eb9b08bb85f4956">CommonGetProcessNameFromProcessControlBlock</a>((PEPROCESS)ThreadListSymbolInfo-&gt;<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">Process</a>),</div>
<div class="line"><span class="lineno">  285</span>                          15);</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  290</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  291</span>        }</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>        <a class="code hl_function" href="_memory_mapper_8c.html#ac3c23d5644111a6be18ca274f448e9ff">MemoryMapperReadMemorySafe</a>(Thread + ThreadListEntryOffset,</div>
<div class="line"><span class="lineno">  294</span>                                   &amp;ThreadLinks,</div>
<div class="line"><span class="lineno">  295</span>                                   <span class="keyword">sizeof</span>(ThreadLinks));</div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  298</span>        <span class="comment">// Find the next process from the list of this process</span></div>
<div class="line"><span class="lineno">  299</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  300</span>        Thread = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)ThreadLinks.Flink - ThreadListEntryOffset;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>    } <span class="keywordflow">while</span> ((<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)ThreadLinks.Flink != ThreadListHead);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>ReturnEnd:</div>
<div class="line"><span class="lineno">  305</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  306</span>    <span class="comment">// In case of query count of Threads, we&#39;ll set this parameter</span></div>
<div class="line"><span class="lineno">  307</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  308</span>    <span class="keywordflow">if</span> (QueryAction == <a class="code hl_enumvalue" href="_request_structures_8h.html#afac007ba1abb5a5ef542e8731170c9a5af19a725eb372008239214205fb97af53">DEBUGGER_QUERY_ACTIVE_PROCESSES_OR_THREADS_ACTION_QUERY_COUNT</a>)</div>
<div class="line"><span class="lineno">  309</span>    {</div>
<div class="line"><span class="lineno">  310</span>        *CountOfThreads = EnumerationCount;</div>
<div class="line"><span class="lineno">  311</span>    }</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  314</span>}</div>
<div class="ttc" id="a_address_check_8c_html_aec71cec56c29db61a23b2997ee8e2059"><div class="ttname"><a href="_address_check_8c.html#aec71cec56c29db61a23b2997ee8e2059">CheckAccessValidityAndSafety</a></div><div class="ttdeci">BOOLEAN CheckAccessValidityAndSafety(UINT64 TargetAddress, UINT32 Size)</div><div class="ttdoc">Check the safety to access the memory.</div><div class="ttdef"><b>Definition</b> AddressCheck.c:156</div></div>
<div class="ttc" id="a_basic_types_8h_html_a4ae1dab0fb4b072a66584546209e7d58"><div class="ttname"><a href="_basic_types_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a></div><div class="ttdeci">unsigned char BYTE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:24</div></div>
<div class="ttc" id="a_basic_types_8h_html_ae1e6edbbc26d6fbc71a90190d0266018"><div class="ttname"><a href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></div><div class="ttdeci">unsigned int UINT32</div><div class="ttdef"><b>Definition</b> BasicTypes.h:48</div></div>
<div class="ttc" id="a_hyper_dbg_hyper_log_intrinsics_8h_html_a0c38ca677b912fa03329447f5e235dc2"><div class="ttname"><a href="_hyper_dbg_hyper_log_intrinsics_8h.html#a0c38ca677b912fa03329447f5e235dc2">Log</a></div><div class="ttdeci">#define Log(format,...)</div><div class="ttdoc">Log without any prefix.</div><div class="ttdef"><b>Definition</b> HyperDbgHyperLogIntrinsics.h:129</div></div>
<div class="ttc" id="a_process_8c_html_aab39c37cefd5d15192160f8cb9e3d66a"><div class="ttname"><a href="_process_8c.html#aab39c37cefd5d15192160f8cb9e3d66a">ProcessCheckIfEprocessIsValid</a></div><div class="ttdeci">BOOLEAN ProcessCheckIfEprocessIsValid(UINT64 Eprocess, UINT64 ActiveProcessHead, ULONG ActiveProcessLinksOffset)</div><div class="ttdoc">checks whether the given nt!_EPROCESS is valid or not</div><div class="ttdef"><b>Definition</b> Process.c:264</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y_html"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html">_DEBUGGEE_THREAD_LIST_DETAILS_ENTRY</a></div><div class="ttdoc">The structure showing list of threads (details of each entry)</div><div class="ttdef"><b>Definition</b> RequestStructures.h:728</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y_html_a4d5bcd5d2b9b714004bb64131aa60aff"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a4d5bcd5d2b9b714004bb64131aa60aff">_DEBUGGEE_THREAD_LIST_DETAILS_ENTRY::Ethread</a></div><div class="ttdeci">UINT64 Ethread</div><div class="ttdef"><b>Definition</b> RequestStructures.h:730</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y_html_a7ab69b329c6f3a806c348a202b773528"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a7ab69b329c6f3a806c348a202b773528">_DEBUGGEE_THREAD_LIST_DETAILS_ENTRY::ThreadId</a></div><div class="ttdeci">UINT32 ThreadId</div><div class="ttdef"><b>Definition</b> RequestStructures.h:732</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y_html_a90c4000a499cf8b02e8856939ff6e466"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#a90c4000a499cf8b02e8856939ff6e466">_DEBUGGEE_THREAD_LIST_DETAILS_ENTRY::Eprocess</a></div><div class="ttdeci">UINT64 Eprocess</div><div class="ttdef"><b>Definition</b> RequestStructures.h:729</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y_html_aa762b2e998c44922ed7d8a23a9ad10ef"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___d_e_t_a_i_l_s___e_n_t_r_y.html#aa762b2e998c44922ed7d8a23a9ad10ef">_DEBUGGEE_THREAD_LIST_DETAILS_ENTRY::ProcessId</a></div><div class="ttdeci">UINT32 ProcessId</div><div class="ttdef"><b>Definition</b> RequestStructures.h:731</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_a34cd6c5fa97ee7f1ecf46a184cb7ea1e"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#a34cd6c5fa97ee7f1ecf46a184cb7ea1e">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::ThreadListHeadOffset</a></div><div class="ttdeci">UINT32 ThreadListHeadOffset</div><div class="ttdef"><b>Definition</b> RequestStructures.h:699</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_a92dc0b206b904cf3374c5a553afb6d7e"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#a92dc0b206b904cf3374c5a553afb6d7e">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::CidOffset</a></div><div class="ttdeci">UINT32 CidOffset</div><div class="ttdef"><b>Definition</b> RequestStructures.h:701</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_aa32e030eeb141ef3d04a707b514a400c"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#aa32e030eeb141ef3d04a707b514a400c">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::ThreadListEntryOffset</a></div><div class="ttdeci">UINT32 ThreadListEntryOffset</div><div class="ttdef"><b>Definition</b> RequestStructures.h:700</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_ac8ef9b6a9e179171da786233efc498c5"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#ac8ef9b6a9e179171da786233efc498c5">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::PsActiveProcessHead</a></div><div class="ttdeci">UINT64 PsActiveProcessHead</div><div class="ttdef"><b>Definition</b> RequestStructures.h:702</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_acab7b18af6515ecc19043c5458e6ef93"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#acab7b18af6515ecc19043c5458e6ef93">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::Process</a></div><div class="ttdeci">UINT64 Process</div><div class="ttdef"><b>Definition</b> RequestStructures.h:704</div></div>
<div class="ttc" id="astruct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s_html_ae83da808851403416b7f694caddb6c08"><div class="ttname"><a href="struct___d_e_b_u_g_g_e_e___t_h_r_e_a_d___l_i_s_t___n_e_e_d_e_d___d_e_t_a_i_l_s.html#ae83da808851403416b7f694caddb6c08">_DEBUGGEE_THREAD_LIST_NEEDED_DETAILS::ActiveProcessLinksOffset</a></div><div class="ttdeci">ULONG ActiveProcessLinksOffset</div><div class="ttdef"><b>Definition</b> RequestStructures.h:703</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff010811e49c6d5face89ba31da2e0b4" name="aff010811e49c6d5face89ba31da2e0b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff010811e49c6d5face89ba31da2e0b4">&#9670;&#160;</a></span>ThreadSwitch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> ThreadSwitch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperkd_2header_2debugger_2core_2_state_8h.html#aa35afece6adc9a29a7bf7a2e76476037">PROCESSOR_DEBUGGING_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>DbgState</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>ThreadId</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PETHREAD</td>          <td class="paramname"><span class="paramname"><em>EThread</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>CheckByClockInterrupt</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>make evnvironment ready to change the thread </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">DbgState</td><td>The state of the debugger on the current core </td></tr>
    <tr><td class="paramname">ThreadId</td><td></td></tr>
    <tr><td class="paramname">EThread</td><td></td></tr>
    <tr><td class="paramname">CheckByClockInterrupt</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   62</span>{</div>
<div class="line"><span class="lineno">   63</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   64</span>    <span class="comment">// Initialized with NULL</span></div>
<div class="line"><span class="lineno">   65</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   66</span>    <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#a8634fa6da6ae3bcf19fd9447e94c82b1">Thread</a>   = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno">   67</span>    <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#abbc1326ff13106f098eedd8126ce3857">ThreadId</a> = <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a>;</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   70</span>    <span class="comment">// Check to avoid invalid switch</span></div>
<div class="line"><span class="lineno">   71</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordflow">if</span> (ThreadId == <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a> &amp;&amp; EThread == <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>)</div>
<div class="line"><span class="lineno">   73</span>    {</div>
<div class="line"><span class="lineno">   74</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">   75</span>    }</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   78</span>    <span class="comment">// Set the target thread id, ethread to switch</span></div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordflow">if</span> (EThread != NULL)</div>
<div class="line"><span class="lineno">   81</span>    {</div>
<div class="line"><span class="lineno">   82</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="_address_check_8c.html#aec71cec56c29db61a23b2997ee8e2059">CheckAccessValidityAndSafety</a>((<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>)EThread, <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="_basic_types_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)))</div>
<div class="line"><span class="lineno">   83</span>        {</div>
<div class="line"><span class="lineno">   84</span>            <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#a8634fa6da6ae3bcf19fd9447e94c82b1">Thread</a> = EThread;</div>
<div class="line"><span class="lineno">   85</span>        }</div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   87</span>        {</div>
<div class="line"><span class="lineno">   88</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">   89</span>            <span class="comment">// An invalid address is specified by user</span></div>
<div class="line"><span class="lineno">   90</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">   91</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">   92</span>        }</div>
<div class="line"><span class="lineno">   93</span>    }</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ThreadId != <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a>)</div>
<div class="line"><span class="lineno">   95</span>    {</div>
<div class="line"><span class="lineno">   96</span>        <a class="code hl_variable" href="hyperkd_2header_2globals_2_global_8h.html#ac4bd01d0cf0973fbceb4306bde6172dd">g_ThreadSwitch</a>.<a class="code hl_variable" href="struct___d_e_b_u_g_g_e_e___r_e_q_u_e_s_t___t_o___c_h_a_n_g_e___t_h_r_e_a_d.html#abbc1326ff13106f098eedd8126ce3857">ThreadId</a> = ThreadId;</div>
<div class="line"><span class="lineno">   97</span>    }</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  100</span>    <span class="comment">// Send request for the target task to the halted cores (synchronized)</span></div>
<div class="line"><span class="lineno">  101</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  102</span>    <a class="code hl_function" href="_halted_core_8c.html#ac1941536fe5f56c09494b64a4920cd1f">HaltedCoreBroadcastTaskAllCores</a>(DbgState,</div>
<div class="line"><span class="lineno">  103</span>                                    <a class="code hl_define" href="_halted_core_8h.html#ac044f6ae950f0476439fb7388e82b476">DEBUGGER_HALTED_CORE_TASK_SET_THREAD_INTERCEPTION</a>,</div>
<div class="line"><span class="lineno">  104</span>                                    <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>,</div>
<div class="line"><span class="lineno">  105</span>                                    <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>,</div>
<div class="line"><span class="lineno">  106</span>                                    (PVOID)CheckByClockInterrupt);</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  109</span>}</div>
<div class="ttc" id="a_halted_core_8c_html_ac1941536fe5f56c09494b64a4920cd1f"><div class="ttname"><a href="_halted_core_8c.html#ac1941536fe5f56c09494b64a4920cd1f">HaltedCoreBroadcastTaskAllCores</a></div><div class="ttdeci">BOOLEAN HaltedCoreBroadcastTaskAllCores(PROCESSOR_DEBUGGING_STATE *DbgState, UINT64 TargetTask, BOOLEAN LockAgainAfterTask, BOOLEAN Synchronize, PVOID Context)</div><div class="ttdoc">Broadcast tasks to halted cores.</div><div class="ttdef"><b>Definition</b> HaltedCore.c:399</div></div>
<div class="ttc" id="a_halted_core_8h_html_ac044f6ae950f0476439fb7388e82b476"><div class="ttname"><a href="_halted_core_8h.html#ac044f6ae950f0476439fb7388e82b476">DEBUGGER_HALTED_CORE_TASK_SET_THREAD_INTERCEPTION</a></div><div class="ttdeci">#define DEBUGGER_HALTED_CORE_TASK_SET_THREAD_INTERCEPTION</div><div class="ttdoc">Halted core task for setting thread interception.</div><div class="ttdef"><b>Definition</b> HaltedCore.h:40</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_fd401680aa8c7ceffc479e97f6bdc4df.html">hyperkd</a></li><li class="navelem"><a class="el" href="dir_587853473f29459994cc5353647295ff.html">code</a></li><li class="navelem"><a class="el" href="dir_366222a910cb7e5dbd8918e7b8c2300f.html">debugger</a></li><li class="navelem"><a class="el" href="dir_24673626ed2c7053a7eb375534be9518.html">objects</a></li><li class="navelem"><a class="el" href="_thread_8c.html">Thread.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
