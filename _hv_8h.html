<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperDbg Debugger: hyperdbg/hyperhv/header/vmm/vmx/Hv.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HyperDbg Debugger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_hv_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Hv.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file contains the headers for Hypervisor Routines which have to be called by external codes.  
<a href="#details">More...</a></p>

<p><a href="_hv_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2f34aa654593d91e3051f8aa3b3e00cc" id="r_a2f34aa654593d91e3051f8aa3b3e00cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f34aa654593d91e3051f8aa3b3e00cc">HvSetGuestSelector</a> (PVOID GdtBase, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> SegmentRegister, <a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="el" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>)</td></tr>
<tr class="memdesc:a2f34aa654593d91e3051f8aa3b3e00cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Guest Selector Registers.  <br /></td></tr>
<tr class="separator:a2f34aa654593d91e3051f8aa3b3e00cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00e070c615f5719e5f74fa77d4cfe8fb" id="r_a00e070c615f5719e5f74fa77d4cfe8fb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a00e070c615f5719e5f74fa77d4cfe8fb">HvAdjustControls</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> Ctl, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> Msr)</td></tr>
<tr class="memdesc:a00e070c615f5719e5f74fa77d4cfe8fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the Cpu Based and Secondary Processor Based Controls and other controls based on hardware support.  <br /></td></tr>
<tr class="separator:a00e070c615f5719e5f74fa77d4cfe8fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e659558abb0c1a6977e68c59130dbc9" id="r_a8e659558abb0c1a6977e68c59130dbc9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e659558abb0c1a6977e68c59130dbc9">HvHandleCpuid</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a8e659558abb0c1a6977e68c59130dbc9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle Cpuid.  <br /></td></tr>
<tr class="separator:a8e659558abb0c1a6977e68c59130dbc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09f47717db1f81f25b5d3efb49b72a36" id="r_a09f47717db1f81f25b5d3efb49b72a36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a09f47717db1f81f25b5d3efb49b72a36">HvFillGuestSelectorData</a> (PVOID GdtBase, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> SegmentRegister, <a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> <a class="el" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>)</td></tr>
<tr class="memdesc:a09f47717db1f81f25b5d3efb49b72a36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill guest selector data.  <br /></td></tr>
<tr class="separator:a09f47717db1f81f25b5d3efb49b72a36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00cc8024816442f874bee6955dbad89c" id="r_a00cc8024816442f874bee6955dbad89c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a00cc8024816442f874bee6955dbad89c">HvHandleControlRegisterAccess</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, VMX_EXIT_QUALIFICATION_MOV_CR *CrExitQualification)</td></tr>
<tr class="memdesc:a00cc8024816442f874bee6955dbad89c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle Guest's Control Registers Access.  <br /></td></tr>
<tr class="separator:a00cc8024816442f874bee6955dbad89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a635a41a75799273745a2af474455c4aa" id="r_a635a41a75799273745a2af474455c4aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a635a41a75799273745a2af474455c4aa">HvResumeToNextInstruction</a> ()</td></tr>
<tr class="memdesc:a635a41a75799273745a2af474455c4aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resume GUEST_RIP to next instruction.  <br /></td></tr>
<tr class="separator:a635a41a75799273745a2af474455c4aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a384185281b4d93ce4a401d66848d9049" id="r_a384185281b4d93ce4a401d66848d9049"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a384185281b4d93ce4a401d66848d9049">HvSuppressRipIncrement</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a384185281b4d93ce4a401d66848d9049"><td class="mdescLeft">&#160;</td><td class="mdescRight">Suppress the incrementation of RIP.  <br /></td></tr>
<tr class="separator:a384185281b4d93ce4a401d66848d9049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a826a60c83941bba6d1012ec8cae27e6f" id="r_a826a60c83941bba6d1012ec8cae27e6f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a826a60c83941bba6d1012ec8cae27e6f">HvPerformRipIncrement</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a826a60c83941bba6d1012ec8cae27e6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform the incrementation of RIP.  <br /></td></tr>
<tr class="separator:a826a60c83941bba6d1012ec8cae27e6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae24c5aceac93fda6a1fcb4e15c85404c" id="r_ae24c5aceac93fda6a1fcb4e15c85404c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae24c5aceac93fda6a1fcb4e15c85404c">HvSetMonitorTrapFlag</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:ae24c5aceac93fda6a1fcb4e15c85404c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set or unset the monitor trap flags.  <br /></td></tr>
<tr class="separator:ae24c5aceac93fda6a1fcb4e15c85404c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1b5b358d07414ddfb27431c94c48e48" id="r_af1b5b358d07414ddfb27431c94c48e48"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af1b5b358d07414ddfb27431c94c48e48">HvSetRflagTrapFlag</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:af1b5b358d07414ddfb27431c94c48e48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the rflag's trap flag.  <br /></td></tr>
<tr class="separator:af1b5b358d07414ddfb27431c94c48e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9aefb71e380eac56389960ac66cddc1" id="r_ac9aefb71e380eac56389960ac66cddc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac9aefb71e380eac56389960ac66cddc1">HvSetLoadDebugControls</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:ac9aefb71e380eac56389960ac66cddc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set LOAD DEBUG CONTROLS on Vm-entry controls.  <br /></td></tr>
<tr class="separator:ac9aefb71e380eac56389960ac66cddc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a437b35822e82e1192228e3f8e767a4ab" id="r_a437b35822e82e1192228e3f8e767a4ab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a437b35822e82e1192228e3f8e767a4ab">HvSetSaveDebugControls</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a437b35822e82e1192228e3f8e767a4ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set SAVE DEBUG CONTROLS on Vm-exit controls.  <br /></td></tr>
<tr class="separator:a437b35822e82e1192228e3f8e767a4ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a011d070043f596f715b8a1deee31786c" id="r_a011d070043f596f715b8a1deee31786c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a011d070043f596f715b8a1deee31786c">HvRestoreRegisters</a> ()</td></tr>
<tr class="memdesc:a011d070043f596f715b8a1deee31786c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset GDTR/IDTR and other old when you do vmxoff as the patchguard will detect them left modified.  <br /></td></tr>
<tr class="separator:a011d070043f596f715b8a1deee31786c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d721b297a9930e02bfb88191a2e0b78" id="r_a0d721b297a9930e02bfb88191a2e0b78"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0d721b297a9930e02bfb88191a2e0b78">HvSetPmcVmexit</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a0d721b297a9930e02bfb88191a2e0b78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set vm-exit for rdpmc instructions.  <br /></td></tr>
<tr class="separator:a0d721b297a9930e02bfb88191a2e0b78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa9e7c2c5105db2e85d896167df615f7" id="r_aaa9e7c2c5105db2e85d896167df615f7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaa9e7c2c5105db2e85d896167df615f7">HvSetMovControlRegsExiting</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set, <a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> ControlRegister, <a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> MaskRegister)</td></tr>
<tr class="memdesc:aaa9e7c2c5105db2e85d896167df615f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set vm-exit for mov-to-cr0/4.  <br /></td></tr>
<tr class="separator:aaa9e7c2c5105db2e85d896167df615f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7fa8f843553c4aebe992e88c71bbb79" id="r_ac7fa8f843553c4aebe992e88c71bbb79"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac7fa8f843553c4aebe992e88c71bbb79">HvSetMovToCr3Vmexit</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:ac7fa8f843553c4aebe992e88c71bbb79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set vm-exit for mov-to-cr3.  <br /></td></tr>
<tr class="separator:ac7fa8f843553c4aebe992e88c71bbb79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a595e57580c35bb94687c29de95053e74" id="r_a595e57580c35bb94687c29de95053e74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a595e57580c35bb94687c29de95053e74">HvWriteExceptionBitmap</a> (<a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> BitmapMask)</td></tr>
<tr class="memdesc:a595e57580c35bb94687c29de95053e74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write to the exception bitmap.  <br /></td></tr>
<tr class="separator:a595e57580c35bb94687c29de95053e74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a356bf8e90c3548911031ccd655359517" id="r_a356bf8e90c3548911031ccd655359517"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a356bf8e90c3548911031ccd655359517">HvReadExceptionBitmap</a> ()</td></tr>
<tr class="memdesc:a356bf8e90c3548911031ccd655359517"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the exception bitmap.  <br /></td></tr>
<tr class="separator:a356bf8e90c3548911031ccd655359517"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e8c2928eefa854763176a7f18bb04ca" id="r_a4e8c2928eefa854763176a7f18bb04ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a4e8c2928eefa854763176a7f18bb04ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Interrupt-window exiting.  <br /></td></tr>
<tr class="separator:a4e8c2928eefa854763176a7f18bb04ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c4daa4d439a7dd29da59724793ea675" id="r_a7c4daa4d439a7dd29da59724793ea675"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7c4daa4d439a7dd29da59724793ea675">HvSetPmlEnableFlag</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a7c4daa4d439a7dd29da59724793ea675"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Page Modification Logging Enable bit.  <br /></td></tr>
<tr class="separator:a7c4daa4d439a7dd29da59724793ea675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5ed1560d0c5fa592a40b0b75d8e1022" id="r_ab5ed1560d0c5fa592a40b0b75d8e1022"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab5ed1560d0c5fa592a40b0b75d8e1022">HvSetModeBasedExecutionEnableFlag</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:ab5ed1560d0c5fa592a40b0b75d8e1022"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Mode-based Execution Control (MBEC) Enable bit.  <br /></td></tr>
<tr class="separator:ab5ed1560d0c5fa592a40b0b75d8e1022"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7a6581e797aaeb78d1d4dba7cb3b7be" id="r_ac7a6581e797aaeb78d1d4dba7cb3b7be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac7a6581e797aaeb78d1d4dba7cb3b7be">HvSetNmiWindowExiting</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:ac7a6581e797aaeb78d1d4dba7cb3b7be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set NMI-window exiting.  <br /></td></tr>
<tr class="separator:ac7a6581e797aaeb78d1d4dba7cb3b7be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17ca5235cf591dc0e8b36b4a850e4592" id="r_a17ca5235cf591dc0e8b36b4a850e4592"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a17ca5235cf591dc0e8b36b4a850e4592">HvHandleMovDebugRegister</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a17ca5235cf591dc0e8b36b4a850e4592"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle Mov to Debug Registers Exitings.  <br /></td></tr>
<tr class="separator:a17ca5235cf591dc0e8b36b4a850e4592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a372b26d4b4571db93597414725289f0c" id="r_a372b26d4b4571db93597414725289f0c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a372b26d4b4571db93597414725289f0c">HvSetMovDebugRegsExiting</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a372b26d4b4571db93597414725289f0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the Mov to Debug Registers Exiting.  <br /></td></tr>
<tr class="separator:a372b26d4b4571db93597414725289f0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19458423f77db01c301caf54c301b24c" id="r_a19458423f77db01c301caf54c301b24c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a19458423f77db01c301caf54c301b24c">HvSetNmiExiting</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a19458423f77db01c301caf54c301b24c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the NMI Exiting.  <br /></td></tr>
<tr class="separator:a19458423f77db01c301caf54c301b24c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82c2dbbfaabfafcb556e12f0bfb93d4a" id="r_a82c2dbbfaabfafcb556e12f0bfb93d4a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a82c2dbbfaabfafcb556e12f0bfb93d4a">HvSetVmxPreemptionTimerExiting</a> (<a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a82c2dbbfaabfafcb556e12f0bfb93d4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the VMX Preemptiom Timer.  <br /></td></tr>
<tr class="separator:a82c2dbbfaabfafcb556e12f0bfb93d4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9fc64fae8bbc000a6e8949e78547027" id="r_ad9fc64fae8bbc000a6e8949e78547027"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad9fc64fae8bbc000a6e8949e78547027">HvSetExceptionBitmap</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> IdtIndex)</td></tr>
<tr class="memdesc:ad9fc64fae8bbc000a6e8949e78547027"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set exception bitmap in VMCS.  <br /></td></tr>
<tr class="separator:ad9fc64fae8bbc000a6e8949e78547027"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a256ea8c6d02ec0645069b0df50683700" id="r_a256ea8c6d02ec0645069b0df50683700"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a256ea8c6d02ec0645069b0df50683700">HvUnsetExceptionBitmap</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> IdtIndex)</td></tr>
<tr class="memdesc:a256ea8c6d02ec0645069b0df50683700"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unset exception bitmap in VMCS.  <br /></td></tr>
<tr class="separator:a256ea8c6d02ec0645069b0df50683700"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a856a41c4038e4065c52eb90db0160ab2" id="r_a856a41c4038e4065c52eb90db0160ab2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:a856a41c4038e4065c52eb90db0160ab2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the External Interrupt Exiting.  <br /></td></tr>
<tr class="separator:a856a41c4038e4065c52eb90db0160ab2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65c1a7d04b374f7961c96211510049aa" id="r_a65c1a7d04b374f7961c96211510049aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a65c1a7d04b374f7961c96211510049aa">HvEnableAndCheckForPreviousExternalInterrupts</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a65c1a7d04b374f7961c96211510049aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks to enable and reinject previous interrupts.  <br /></td></tr>
<tr class="separator:a65c1a7d04b374f7961c96211510049aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaac0cbfd9d2c9a2d4c4263bf58051322" id="r_aaac0cbfd9d2c9a2d4c4263bf58051322"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaac0cbfd9d2c9a2d4c4263bf58051322">HvSetRdtscExiting</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu, <a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Set)</td></tr>
<tr class="memdesc:aaac0cbfd9d2c9a2d4c4263bf58051322"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the RDTSC/P Exiting.  <br /></td></tr>
<tr class="separator:aaac0cbfd9d2c9a2d4c4263bf58051322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe813f7cbb218284d75249997692e9eb" id="r_afe813f7cbb218284d75249997692e9eb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe813f7cbb218284d75249997692e9eb">HvGetCsSelector</a> ()</td></tr>
<tr class="memdesc:afe813f7cbb218284d75249997692e9eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read CS selector.  <br /></td></tr>
<tr class="separator:afe813f7cbb218284d75249997692e9eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35c8859ced5a3b6dc42673b614e58f7a" id="r_a35c8859ced5a3b6dc42673b614e58f7a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a35c8859ced5a3b6dc42673b614e58f7a">HvGetRflags</a> ()</td></tr>
<tr class="memdesc:a35c8859ced5a3b6dc42673b614e58f7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read guest's RFLAGS.  <br /></td></tr>
<tr class="separator:a35c8859ced5a3b6dc42673b614e58f7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add5b0119e284b00c07f2e4c1dd785785" id="r_add5b0119e284b00c07f2e4c1dd785785"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#add5b0119e284b00c07f2e4c1dd785785">HvSetRflags</a> (<a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Rflags)</td></tr>
<tr class="memdesc:add5b0119e284b00c07f2e4c1dd785785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set guest's RFLAGS.  <br /></td></tr>
<tr class="separator:add5b0119e284b00c07f2e4c1dd785785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd78b41e6a2a3e751d83c135d04fc33" id="r_a9bd78b41e6a2a3e751d83c135d04fc33"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9bd78b41e6a2a3e751d83c135d04fc33">HvGetRip</a> ()</td></tr>
<tr class="memdesc:a9bd78b41e6a2a3e751d83c135d04fc33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read guest's RIP.  <br /></td></tr>
<tr class="separator:a9bd78b41e6a2a3e751d83c135d04fc33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a062b204397ffe1208139f8498749f057" id="r_a062b204397ffe1208139f8498749f057"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a062b204397ffe1208139f8498749f057">HvSetRip</a> (<a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Rip)</td></tr>
<tr class="memdesc:a062b204397ffe1208139f8498749f057"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set guest's RIP.  <br /></td></tr>
<tr class="separator:a062b204397ffe1208139f8498749f057"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b457ae7067dfdb2f92fd41c5a58e9cd" id="r_a6b457ae7067dfdb2f92fd41c5a58e9cd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b457ae7067dfdb2f92fd41c5a58e9cd">HvGetInterruptibilityState</a> ()</td></tr>
<tr class="memdesc:a6b457ae7067dfdb2f92fd41c5a58e9cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read guest's interruptibility state.  <br /></td></tr>
<tr class="separator:a6b457ae7067dfdb2f92fd41c5a58e9cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a836c6222c1badb6f7cbd970dd9e7b601" id="r_a836c6222c1badb6f7cbd970dd9e7b601"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a836c6222c1badb6f7cbd970dd9e7b601">HvClearSteppingBits</a> (<a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Interruptibility)</td></tr>
<tr class="memdesc:a836c6222c1badb6f7cbd970dd9e7b601"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear STI and MOV SS bits.  <br /></td></tr>
<tr class="separator:a836c6222c1badb6f7cbd970dd9e7b601"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb5fbd9b96011f0e38bfaf4ec88be09f" id="r_acb5fbd9b96011f0e38bfaf4ec88be09f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb5fbd9b96011f0e38bfaf4ec88be09f">HvSetInterruptibilityState</a> (<a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> InterruptibilityState)</td></tr>
<tr class="memdesc:acb5fbd9b96011f0e38bfaf4ec88be09f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set guest's interruptibility state.  <br /></td></tr>
<tr class="separator:acb5fbd9b96011f0e38bfaf4ec88be09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad42815202d6371ffc05e7608bb181a54" id="r_ad42815202d6371ffc05e7608bb181a54"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad42815202d6371ffc05e7608bb181a54">HvInjectPendingExternalInterrupts</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:ad42815202d6371ffc05e7608bb181a54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inject pending external interrupts.  <br /></td></tr>
<tr class="separator:ad42815202d6371ffc05e7608bb181a54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4410be2a0b04e615d67ae43c62e01b43" id="r_a4410be2a0b04e615d67ae43c62e01b43"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4410be2a0b04e615d67ae43c62e01b43">HvCheckAndEnableExternalInterrupts</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a4410be2a0b04e615d67ae43c62e01b43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check and enable external interrupts.  <br /></td></tr>
<tr class="separator:a4410be2a0b04e615d67ae43c62e01b43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1350289526bff5bde44ded43c0d9bdb" id="r_aa1350289526bff5bde44ded43c0d9bdb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1350289526bff5bde44ded43c0d9bdb">HvDisableExternalInterruptsAndInterruptWindow</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:aa1350289526bff5bde44ded43c0d9bdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable external-interrupts and interrupt window.  <br /></td></tr>
<tr class="separator:aa1350289526bff5bde44ded43c0d9bdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab629b9ab3070ec39143d0da60907c2c1" id="r_ab629b9ab3070ec39143d0da60907c2c1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab629b9ab3070ec39143d0da60907c2c1">HvInitVmm</a> (<a class="el" href="_v_m_m_8h.html#a1e73fd13bcaf23e83681c29178159f80">VMM_CALLBACKS</a> *VmmCallbacks)</td></tr>
<tr class="memdesc:ab629b9ab3070ec39143d0da60907c2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the hypervisor.  <br /></td></tr>
<tr class="separator:ab629b9ab3070ec39143d0da60907c2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaefdbdae7f34da856dab7ea05bd7f7b4" id="r_aaefdbdae7f34da856dab7ea05bd7f7b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaefdbdae7f34da856dab7ea05bd7f7b4">HvEnableMtfAndChangeExternalInterruptState</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:aaefdbdae7f34da856dab7ea05bd7f7b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables MTF and adjust external interrupt state.  <br /></td></tr>
<tr class="separator:aaefdbdae7f34da856dab7ea05bd7f7b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77588821314d5b29ee748b79afbb5732" id="r_a77588821314d5b29ee748b79afbb5732"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a77588821314d5b29ee748b79afbb5732">HvPreventExternalInterrupts</a> (<a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *VCpu)</td></tr>
<tr class="memdesc:a77588821314d5b29ee748b79afbb5732"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust external interrupt state.  <br /></td></tr>
<tr class="separator:a77588821314d5b29ee748b79afbb5732"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the headers for Hypervisor Routines which have to be called by external codes. </p>
<dl class="section author"><dt>Author</dt><dd>Sina Karvandi (<a href="#" onclick="location.href='mai'+'lto:'+'sin'+'a@'+'hyp'+'er'+'dbg'+'.o'+'rg'; return false;">sina@<span class="obfuscator">.nosp@m.</span>hype<span class="obfuscator">.nosp@m.</span>rdbg.<span class="obfuscator">.nosp@m.</span>org</a>)</dd></dl>
<p>DO NOT DIRECTLY CALL VMX FUNCTIONS, instead use these routines</p>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2020-04-11</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This project is released under the GNU Public License v3. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a00e070c615f5719e5f74fa77d4cfe8fb" name="a00e070c615f5719e5f74fa77d4cfe8fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00e070c615f5719e5f74fa77d4cfe8fb">&#9670;&#160;</a></span>HvAdjustControls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> HvAdjustControls </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>Ctl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>Msr</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the Cpu Based and Secondary Processor Based Controls and other controls based on hardware support. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctl</td><td></td></tr>
    <tr><td class="paramname">Msr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UINT32</dd></dl>
<p>Returns the Cpu Based and Secondary Processor Based Controls and other controls based on hardware support.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctl</td><td></td></tr>
    <tr><td class="paramname">Msr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UINT32 Returns the Cpu Based and Secondary Processor Based Controls and other controls based on hardware support </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   24</span>{</div>
<div class="line"><span class="lineno">   25</span>    <a class="code hl_union" href="union___m_s_r.html">MSR</a> MsrValue = {0};</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>    MsrValue.<a class="code hl_variable" href="union___m_s_r.html#a3364b44a171ac6a25b7dec94310f2e4f">Flags</a> = __readmsr(Msr);</div>
<div class="line"><span class="lineno">   28</span>    Ctl &amp;= MsrValue.<a class="code hl_variable" href="union___m_s_r.html#a1c06a2043cc85c0e808776035b5a3330">Fields</a>.<a class="code hl_variable" href="union___m_s_r.html#ab6b0809156e9b66feae0ff03502a79d8">High</a>; <span class="comment">/* bit == 0 in high word ==&gt; must be zero */</span></div>
<div class="line"><span class="lineno">   29</span>    Ctl |= MsrValue.<a class="code hl_variable" href="union___m_s_r.html#a1c06a2043cc85c0e808776035b5a3330">Fields</a>.<a class="code hl_variable" href="union___m_s_r.html#a6fb09f6d07be060a585b8951fe951326">Low</a>;  <span class="comment">/* bit == 1 in low word  ==&gt; must be one  */</span></div>
<div class="line"><span class="lineno">   30</span>    <span class="keywordflow">return</span> Ctl;</div>
<div class="line"><span class="lineno">   31</span>}</div>
<div class="ttc" id="aunion___m_s_r_html"><div class="ttname"><a href="union___m_s_r.html">_MSR</a></div><div class="ttdoc">General MSR Structure.</div><div class="ttdef"><b>Definition</b> Msr.h:23</div></div>
<div class="ttc" id="aunion___m_s_r_html_a1c06a2043cc85c0e808776035b5a3330"><div class="ttname"><a href="union___m_s_r.html#a1c06a2043cc85c0e808776035b5a3330">_MSR::Fields</a></div><div class="ttdeci">struct _MSR::@1 Fields</div></div>
<div class="ttc" id="aunion___m_s_r_html_a3364b44a171ac6a25b7dec94310f2e4f"><div class="ttname"><a href="union___m_s_r.html#a3364b44a171ac6a25b7dec94310f2e4f">_MSR::Flags</a></div><div class="ttdeci">UINT64 Flags</div><div class="ttdef"><b>Definition</b> Msr.h:30</div></div>
<div class="ttc" id="aunion___m_s_r_html_a6fb09f6d07be060a585b8951fe951326"><div class="ttname"><a href="union___m_s_r.html#a6fb09f6d07be060a585b8951fe951326">_MSR::Low</a></div><div class="ttdeci">ULONG Low</div><div class="ttdef"><b>Definition</b> Msr.h:26</div></div>
<div class="ttc" id="aunion___m_s_r_html_ab6b0809156e9b66feae0ff03502a79d8"><div class="ttname"><a href="union___m_s_r.html#ab6b0809156e9b66feae0ff03502a79d8">_MSR::High</a></div><div class="ttdeci">ULONG High</div><div class="ttdef"><b>Definition</b> Msr.h:27</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4410be2a0b04e615d67ae43c62e01b43" name="a4410be2a0b04e615d67ae43c62e01b43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4410be2a0b04e615d67ae43c62e01b43">&#9670;&#160;</a></span>HvCheckAndEnableExternalInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvCheckAndEnableExternalInterrupts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check and enable external interrupts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1272</span>{</div>
<div class="line"><span class="lineno"> 1273</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1274</span>    <span class="comment">// Check if we should enable interrupts in this core or not</span></div>
<div class="line"><span class="lineno"> 1275</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1276</span>    <span class="keywordflow">if</span> (VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ae354e9ba7dbd2547a6fa39c3e8335131">EnableExternalInterruptsOnContinue</a>)</div>
<div class="line"><span class="lineno"> 1277</span>    {</div>
<div class="line"><span class="lineno"> 1278</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1279</span>        <span class="comment">// Enable normal interrupts</span></div>
<div class="line"><span class="lineno"> 1280</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1281</span>        <a class="code hl_function" href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a>(VCpu, <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno"> 1282</span> </div>
<div class="line"><span class="lineno"> 1283</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1284</span>        <span class="comment">// Check if there is at least an interrupt that needs to be delivered</span></div>
<div class="line"><span class="lineno"> 1285</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1286</span>        <a class="code hl_function" href="_hv_8c.html#ad42815202d6371ffc05e7608bb181a54">HvInjectPendingExternalInterrupts</a>(VCpu);</div>
<div class="line"><span class="lineno"> 1287</span> </div>
<div class="line"><span class="lineno"> 1288</span>        VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ae354e9ba7dbd2547a6fa39c3e8335131">EnableExternalInterruptsOnContinue</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1289</span>    }</div>
<div class="line"><span class="lineno"> 1290</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:54</div></div>
<div class="ttc" id="a_hv_8c_html_a856a41c4038e4065c52eb90db0160ab2"><div class="ttname"><a href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a></div><div class="ttdeci">VOID HvSetExternalInterruptExiting(VIRTUAL_MACHINE_STATE *VCpu, BOOLEAN Set)</div><div class="ttdoc">Set the External Interrupt Exiting.</div><div class="ttdef"><b>Definition</b> Hv.c:1055</div></div>
<div class="ttc" id="a_hv_8c_html_ad42815202d6371ffc05e7608bb181a54"><div class="ttname"><a href="_hv_8c.html#ad42815202d6371ffc05e7608bb181a54">HvInjectPendingExternalInterrupts</a></div><div class="ttdeci">VOID HvInjectPendingExternalInterrupts(VIRTUAL_MACHINE_STATE *VCpu)</div><div class="ttdoc">Inject pending external interrupts.</div><div class="ttdef"><b>Definition</b> Hv.c:1249</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_ae354e9ba7dbd2547a6fa39c3e8335131"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ae354e9ba7dbd2547a6fa39c3e8335131">_VIRTUAL_MACHINE_STATE::EnableExternalInterruptsOnContinue</a></div><div class="ttdeci">BOOLEAN EnableExternalInterruptsOnContinue</div><div class="ttdef"><b>Definition</b> State.h:296</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a836c6222c1badb6f7cbd970dd9e7b601" name="a836c6222c1badb6f7cbd970dd9e7b601"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a836c6222c1badb6f7cbd970dd9e7b601">&#9670;&#160;</a></span>HvClearSteppingBits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> HvClearSteppingBits </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>Interruptibility</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear STI and MOV SS bits. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT64 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1221</span>{</div>
<div class="line"><span class="lineno"> 1222</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> InterruptibilityState = Interruptibility;</div>
<div class="line"><span class="lineno"> 1223</span> </div>
<div class="line"><span class="lineno"> 1224</span>    InterruptibilityState &amp;= ~(<a class="code hl_define" href="_vmx_8h.html#a0326d909e0ef800c6b526d000263f2f1">GUEST_INTR_STATE_STI</a> | <a class="code hl_define" href="_vmx_8h.html#a1dd07b12db875056b98ac1b19ac2c44a">GUEST_INTR_STATE_MOV_SS</a>);</div>
<div class="line"><span class="lineno"> 1225</span> </div>
<div class="line"><span class="lineno"> 1226</span>    <span class="keywordflow">return</span> InterruptibilityState;</div>
<div class="line"><span class="lineno"> 1227</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_aae17ebb9ef7279d026817fb22f8aebe9"><div class="ttname"><a href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></div><div class="ttdeci">unsigned __int64 UINT64</div><div class="ttdef"><b>Definition</b> BasicTypes.h:21</div></div>
<div class="ttc" id="a_vmx_8h_html_a0326d909e0ef800c6b526d000263f2f1"><div class="ttname"><a href="_vmx_8h.html#a0326d909e0ef800c6b526d000263f2f1">GUEST_INTR_STATE_STI</a></div><div class="ttdeci">#define GUEST_INTR_STATE_STI</div><div class="ttdoc">GUEST_INTERRUPTIBILITY_INFO flags.</div><div class="ttdef"><b>Definition</b> Vmx.h:123</div></div>
<div class="ttc" id="a_vmx_8h_html_a1dd07b12db875056b98ac1b19ac2c44a"><div class="ttname"><a href="_vmx_8h.html#a1dd07b12db875056b98ac1b19ac2c44a">GUEST_INTR_STATE_MOV_SS</a></div><div class="ttdeci">#define GUEST_INTR_STATE_MOV_SS</div><div class="ttdef"><b>Definition</b> Vmx.h:124</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1350289526bff5bde44ded43c0d9bdb" name="aa1350289526bff5bde44ded43c0d9bdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1350289526bff5bde44ded43c0d9bdb">&#9670;&#160;</a></span>HvDisableExternalInterruptsAndInterruptWindow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvDisableExternalInterruptsAndInterruptWindow </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable external-interrupts and interrupt window. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1301</span>{</div>
<div class="line"><span class="lineno"> 1302</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1303</span>    <span class="comment">// Change guest interrupt-state</span></div>
<div class="line"><span class="lineno"> 1304</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1305</span>    <a class="code hl_function" href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a>(VCpu, <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1306</span> </div>
<div class="line"><span class="lineno"> 1307</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1308</span>    <span class="comment">// Do not vm-exit on interrupt windows</span></div>
<div class="line"><span class="lineno"> 1309</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1310</span>    <a class="code hl_function" href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno"> 1311</span> </div>
<div class="line"><span class="lineno"> 1312</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ae354e9ba7dbd2547a6fa39c3e8335131">EnableExternalInterruptsOnContinue</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1313</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition</b> BasicTypes.h:55</div></div>
<div class="ttc" id="a_hv_8c_html_a4e8c2928eefa854763176a7f18bb04ca"><div class="ttname"><a href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a></div><div class="ttdeci">VOID HvSetInterruptWindowExiting(BOOLEAN Set)</div><div class="ttdoc">Set Interrupt-window exiting.</div><div class="ttdef"><b>Definition</b> Hv.c:606</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a65c1a7d04b374f7961c96211510049aa" name="a65c1a7d04b374f7961c96211510049aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65c1a7d04b374f7961c96211510049aa">&#9670;&#160;</a></span>HvEnableAndCheckForPreviousExternalInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvEnableAndCheckForPreviousExternalInterrupts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks to enable and reinject previous interrupts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">Set</td><td>Set or unset the External Interrupt Exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1073</span>{</div>
<div class="line"><span class="lineno"> 1074</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1075</span>    <span class="comment">// Check if we should enable interrupts in this core or not,</span></div>
<div class="line"><span class="lineno"> 1076</span>    <span class="comment">// we have another same check in SWITCHING CORES too</span></div>
<div class="line"><span class="lineno"> 1077</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1078</span>    <span class="keywordflow">if</span> (VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a6532add9fa7c9358728a495d904a8b87">EnableExternalInterruptsOnContinueMtf</a>)</div>
<div class="line"><span class="lineno"> 1079</span>    {</div>
<div class="line"><span class="lineno"> 1080</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1081</span>        <span class="comment">// Enable normal interrupts</span></div>
<div class="line"><span class="lineno"> 1082</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1083</span>        <a class="code hl_function" href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a>(VCpu, <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno"> 1084</span> </div>
<div class="line"><span class="lineno"> 1085</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1086</span>        <span class="comment">// Check if there is at least an interrupt that needs to be delivered</span></div>
<div class="line"><span class="lineno"> 1087</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1088</span>        <span class="keywordflow">if</span> (VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a7123e9d39156e57b44e62065ebe2fc9d">PendingExternalInterrupts</a>[0] != <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a>)</div>
<div class="line"><span class="lineno"> 1089</span>        {</div>
<div class="line"><span class="lineno"> 1090</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1091</span>            <span class="comment">// Enable Interrupt-window exiting.</span></div>
<div class="line"><span class="lineno"> 1092</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1093</span>            <a class="code hl_function" href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1094</span>        }</div>
<div class="line"><span class="lineno"> 1095</span> </div>
<div class="line"><span class="lineno"> 1096</span>        VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a6532add9fa7c9358728a495d904a8b87">EnableExternalInterruptsOnContinueMtf</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1097</span>    }</div>
<div class="line"><span class="lineno"> 1098</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a32ab457827837bf5ac123dd0fd8326ae"><div class="ttname"><a href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a></div><div class="ttdeci">#define NULL_ZERO</div><div class="ttdef"><b>Definition</b> BasicTypes.h:51</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_a6532add9fa7c9358728a495d904a8b87"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a6532add9fa7c9358728a495d904a8b87">_VIRTUAL_MACHINE_STATE::EnableExternalInterruptsOnContinueMtf</a></div><div class="ttdeci">BOOLEAN EnableExternalInterruptsOnContinueMtf</div><div class="ttdef"><b>Definition</b> State.h:297</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_a7123e9d39156e57b44e62065ebe2fc9d"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a7123e9d39156e57b44e62065ebe2fc9d">_VIRTUAL_MACHINE_STATE::PendingExternalInterrupts</a></div><div class="ttdeci">UINT32 PendingExternalInterrupts[PENDING_INTERRUPTS_BUFFER_CAPACITY]</div><div class="ttdef"><b>Definition</b> State.h:322</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaefdbdae7f34da856dab7ea05bd7f7b4" name="aaefdbdae7f34da856dab7ea05bd7f7b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaefdbdae7f34da856dab7ea05bd7f7b4">&#9670;&#160;</a></span>HvEnableMtfAndChangeExternalInterruptState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvEnableMtfAndChangeExternalInterruptState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables MTF and adjust external interrupt state. </p>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1390</span>{</div>
<div class="line"><span class="lineno"> 1391</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1392</span>    <span class="comment">// We have to set Monitor trap flag and give it the HookedEntry to work with</span></div>
<div class="line"><span class="lineno"> 1393</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1394</span>    <a class="code hl_function" href="_hv_8c.html#ae24c5aceac93fda6a1fcb4e15c85404c">HvSetMonitorTrapFlag</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1395</span> </div>
<div class="line"><span class="lineno"> 1396</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1397</span>    <span class="comment">// The following codes are added because we realized if the execution takes long then</span></div>
<div class="line"><span class="lineno"> 1398</span>    <span class="comment">// the execution might be switched to another routines, thus, MTF might conclude on</span></div>
<div class="line"><span class="lineno"> 1399</span>    <span class="comment">// another routine and we might (and will) trigger the same instruction soon</span></div>
<div class="line"><span class="lineno"> 1400</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1401</span> </div>
<div class="line"><span class="lineno"> 1402</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1403</span>    <span class="comment">// Change guest interrupt-state</span></div>
<div class="line"><span class="lineno"> 1404</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1405</span>    <a class="code hl_function" href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a>(VCpu, <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1406</span> </div>
<div class="line"><span class="lineno"> 1407</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1408</span>    <span class="comment">// Do not vm-exit on interrupt windows</span></div>
<div class="line"><span class="lineno"> 1409</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1410</span>    <a class="code hl_function" href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno"> 1411</span> </div>
<div class="line"><span class="lineno"> 1412</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1413</span>    <span class="comment">// Indicate that we should enable external interrupts and configure external interrupt</span></div>
<div class="line"><span class="lineno"> 1414</span>    <span class="comment">// window exiting somewhere at MTF</span></div>
<div class="line"><span class="lineno"> 1415</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1416</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a6532add9fa7c9358728a495d904a8b87">EnableExternalInterruptsOnContinueMtf</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1417</span>}</div>
<div class="ttc" id="a_hv_8c_html_ae24c5aceac93fda6a1fcb4e15c85404c"><div class="ttname"><a href="_hv_8c.html#ae24c5aceac93fda6a1fcb4e15c85404c">HvSetMonitorTrapFlag</a></div><div class="ttdeci">VOID HvSetMonitorTrapFlag(BOOLEAN Set)</div><div class="ttdoc">Set the monitor trap flag.</div><div class="ttdef"><b>Definition</b> Hv.c:349</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09f47717db1f81f25b5d3efb49b72a36" name="a09f47717db1f81f25b5d3efb49b72a36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09f47717db1f81f25b5d3efb49b72a36">&#9670;&#160;</a></span>HvFillGuestSelectorData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvFillGuestSelectorData </td>
          <td>(</td>
          <td class="paramtype">PVOID</td>          <td class="paramname"><span class="paramname"><em>GdtBase</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>SegmentRegister</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a></td>          <td class="paramname"><span class="paramname"><em>Selector</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fill guest selector data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GdtBase</td><td></td></tr>
    <tr><td class="paramname">SegmentRegister</td><td></td></tr>
    <tr><td class="paramname">Selector</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Fill guest selector data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GdtBase</td><td></td></tr>
    <tr><td class="paramname">SegmentRegister</td><td></td></tr>
    <tr><td class="paramname">Selector</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  277</span>{</div>
<div class="line"><span class="lineno">  278</span>    <a class="code hl_struct" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html">VMX_SEGMENT_SELECTOR</a> <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a> = {0};</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>    <a class="code hl_function" href="_segmentation_8c.html#a2b0862e110c0218f941196fcab600043">SegmentGetDescriptor</a>(GdtBase, <a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>, &amp;<a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>);</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a> == 0x0)</div>
<div class="line"><span class="lineno">  283</span>    {</div>
<div class="line"><span class="lineno">  284</span>        <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#af86e8c35cdab1d3c5f302761596bcdae">Unusable</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  285</span>    }</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#acf43f39253245d2861db20e6d171a481">Reserved1</a> = 0;</div>
<div class="line"><span class="lineno">  288</span>    <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#af204891820027ab4e9c0d0f5adb818ec">Reserved2</a> = 0;</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_SELECTOR + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>);</div>
<div class="line"><span class="lineno">  291</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_LIMIT + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a0bd32da992b5c13d921807c82f3f932a">Limit</a>);</div>
<div class="line"><span class="lineno">  292</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_ACCESS_RIGHTS + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#a911f358641501ff3e2864fcfdc0262ff">AsUInt</a>);</div>
<div class="line"><span class="lineno">  293</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_BASE + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#af782f7b350ce9911745618fa9051428a">Base</a>);</div>
<div class="line"><span class="lineno">  294</span>}</div>
<div class="ttc" id="a_segmentation_8c_html_a2b0862e110c0218f941196fcab600043"><div class="ttname"><a href="_segmentation_8c.html#a2b0862e110c0218f941196fcab600043">SegmentGetDescriptor</a></div><div class="ttdeci">_Use_decl_annotations_ BOOLEAN SegmentGetDescriptor(PUCHAR GdtBase, UINT16 Selector, PVMX_SEGMENT_SELECTOR SegmentSelector)</div><div class="ttdoc">Get Segment Descriptor.</div><div class="ttdef"><b>Definition</b> Segmentation.c:24</div></div>
<div class="ttc" id="a_segmentation_8h_html_a4a0d94e93bbb0b7abc6f24679b7dfc06"><div class="ttname"><a href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a></div><div class="ttdeci">_In_ UINT16 Selector</div><div class="ttdef"><b>Definition</b> Segmentation.h:50</div></div>
<div class="ttc" id="a_segmentation_8h_html_a68870ccf6841ce76f7ca30ab1f3b1b4d"><div class="ttname"><a href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a></div><div class="ttdeci">_In_ UINT16 _Out_ PVMX_SEGMENT_SELECTOR SegmentSelector</div><div class="ttdef"><b>Definition</b> Segmentation.h:51</div></div>
<div class="ttc" id="a_vmx_8c_html_a14b2ff5571ba424d03e622b3802e8e5a"><div class="ttname"><a href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a></div><div class="ttdeci">UCHAR VmxVmwrite64(size_t Field, UINT64 FieldValue)</div><div class="ttdoc">VMX VMWRITE instruction (64-bit)</div><div class="ttdef"><b>Definition</b> Vmx.c:122</div></div>
<div class="ttc" id="astruct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r_html"><div class="ttname"><a href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html">_VMX_SEGMENT_SELECTOR</a></div><div class="ttdoc">Segment selector.</div><div class="ttdef"><b>Definition</b> DataTypes.h:436</div></div>
<div class="ttc" id="astruct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r_html_a0bd32da992b5c13d921807c82f3f932a"><div class="ttname"><a href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a0bd32da992b5c13d921807c82f3f932a">_VMX_SEGMENT_SELECTOR::Limit</a></div><div class="ttdeci">UINT32 Limit</div><div class="ttdef"><b>Definition</b> DataTypes.h:439</div></div>
<div class="ttc" id="astruct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r_html_a351ac6eabc90a04fff1b1c8c99875dd9"><div class="ttname"><a href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">_VMX_SEGMENT_SELECTOR::Attributes</a></div><div class="ttdeci">VMX_SEGMENT_ACCESS_RIGHTS_TYPE Attributes</div><div class="ttdef"><b>Definition</b> DataTypes.h:438</div></div>
<div class="ttc" id="astruct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r_html_af782f7b350ce9911745618fa9051428a"><div class="ttname"><a href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#af782f7b350ce9911745618fa9051428a">_VMX_SEGMENT_SELECTOR::Base</a></div><div class="ttdeci">UINT64 Base</div><div class="ttdef"><b>Definition</b> DataTypes.h:440</div></div>
<div class="ttc" id="aunion_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e_html_a911f358641501ff3e2864fcfdc0262ff"><div class="ttname"><a href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#a911f358641501ff3e2864fcfdc0262ff">VMX_SEGMENT_ACCESS_RIGHTS_TYPE::AsUInt</a></div><div class="ttdeci">UINT32 AsUInt</div><div class="ttdef"><b>Definition</b> DataTypes.h:428</div></div>
<div class="ttc" id="aunion_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e_html_acf43f39253245d2861db20e6d171a481"><div class="ttname"><a href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#acf43f39253245d2861db20e6d171a481">VMX_SEGMENT_ACCESS_RIGHTS_TYPE::Reserved1</a></div><div class="ttdeci">UINT32 Reserved1</div><div class="ttdef"><b>Definition</b> DataTypes.h:400</div></div>
<div class="ttc" id="aunion_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e_html_af204891820027ab4e9c0d0f5adb818ec"><div class="ttname"><a href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#af204891820027ab4e9c0d0f5adb818ec">VMX_SEGMENT_ACCESS_RIGHTS_TYPE::Reserved2</a></div><div class="ttdeci">UINT32 Reserved2</div><div class="ttdef"><b>Definition</b> DataTypes.h:425</div></div>
<div class="ttc" id="aunion_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e_html_af86e8c35cdab1d3c5f302761596bcdae"><div class="ttname"><a href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#af86e8c35cdab1d3c5f302761596bcdae">VMX_SEGMENT_ACCESS_RIGHTS_TYPE::Unusable</a></div><div class="ttdeci">UINT32 Unusable</div><div class="ttdef"><b>Definition</b> DataTypes.h:424</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afe813f7cbb218284d75249997692e9eb" name="afe813f7cbb218284d75249997692e9eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe813f7cbb218284d75249997692e9eb">&#9670;&#160;</a></span>HvGetCsSelector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a> HvGetCsSelector </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read CS selector. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT16 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1133</span>{</div>
<div class="line"><span class="lineno"> 1134</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1135</span>    <span class="comment">// Only 16 bit is needed however, vmwrite might write on other bits</span></div>
<div class="line"><span class="lineno"> 1136</span>    <span class="comment">// and corrupt other variables, that&#39;s why we get 64bit</span></div>
<div class="line"><span class="lineno"> 1137</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1138</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> CsSel = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno"> 1139</span> </div>
<div class="line"><span class="lineno"> 1140</span>    __vmx_vmread(VMCS_GUEST_CS_SELECTOR, &amp;CsSel);</div>
<div class="line"><span class="lineno"> 1141</span> </div>
<div class="line"><span class="lineno"> 1142</span>    <span class="keywordflow">return</span> CsSel &amp; 0xffff;</div>
<div class="line"><span class="lineno"> 1143</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a8a9df53f35cb95dddbe3c564259e01ad"><div class="ttname"><a href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a></div><div class="ttdeci">#define NULL64_ZERO</div><div class="ttdef"><b>Definition</b> BasicTypes.h:52</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b457ae7067dfdb2f92fd41c5a58e9cd" name="a6b457ae7067dfdb2f92fd41c5a58e9cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b457ae7067dfdb2f92fd41c5a58e9cd">&#9670;&#160;</a></span>HvGetInterruptibilityState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> HvGetInterruptibilityState </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read guest's interruptibility state. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT64 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1206</span>{</div>
<div class="line"><span class="lineno"> 1207</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> InterruptibilityState = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno"> 1208</span> </div>
<div class="line"><span class="lineno"> 1209</span>    __vmx_vmread(VMCS_GUEST_INTERRUPTIBILITY_STATE, &amp;InterruptibilityState);</div>
<div class="line"><span class="lineno"> 1210</span> </div>
<div class="line"><span class="lineno"> 1211</span>    <span class="keywordflow">return</span> InterruptibilityState;</div>
<div class="line"><span class="lineno"> 1212</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a35c8859ced5a3b6dc42673b614e58f7a" name="a35c8859ced5a3b6dc42673b614e58f7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35c8859ced5a3b6dc42673b614e58f7a">&#9670;&#160;</a></span>HvGetRflags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> HvGetRflags </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read guest's RFLAGS. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT64 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1152</span>{</div>
<div class="line"><span class="lineno"> 1153</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Rflags = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno"> 1154</span> </div>
<div class="line"><span class="lineno"> 1155</span>    __vmx_vmread(VMCS_GUEST_RFLAGS, &amp;Rflags);</div>
<div class="line"><span class="lineno"> 1156</span> </div>
<div class="line"><span class="lineno"> 1157</span>    <span class="keywordflow">return</span> Rflags;</div>
<div class="line"><span class="lineno"> 1158</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9bd78b41e6a2a3e751d83c135d04fc33" name="a9bd78b41e6a2a3e751d83c135d04fc33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bd78b41e6a2a3e751d83c135d04fc33">&#9670;&#160;</a></span>HvGetRip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> HvGetRip </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read guest's RIP. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT64 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1179</span>{</div>
<div class="line"><span class="lineno"> 1180</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> Rip = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno"> 1181</span> </div>
<div class="line"><span class="lineno"> 1182</span>    __vmx_vmread(VMCS_GUEST_RIP, &amp;Rip);</div>
<div class="line"><span class="lineno"> 1183</span> </div>
<div class="line"><span class="lineno"> 1184</span>    <span class="keywordflow">return</span> Rip;</div>
<div class="line"><span class="lineno"> 1185</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a00cc8024816442f874bee6955dbad89c" name="a00cc8024816442f874bee6955dbad89c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00cc8024816442f874bee6955dbad89c">&#9670;&#160;</a></span>HvHandleControlRegisterAccess()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvHandleControlRegisterAccess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">VMX_EXIT_QUALIFICATION_MOV_CR *</td>          <td class="paramname"><span class="paramname"><em>CrExitQualification</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle Guest's Control Registers Access. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Handle Guest's Control Registers Access.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  138</span>{</div>
<div class="line"><span class="lineno">  139</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> * RegPtr;</div>
<div class="line"><span class="lineno">  140</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a>   NewCr3;</div>
<div class="line"><span class="lineno">  141</span>    <a class="code hl_struct" href="struct___c_r3___t_y_p_e.html">CR3_TYPE</a> NewCr3Reg;</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>    RegPtr = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> *)&amp;VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">Regs</a>-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a> + CrExitQualification-&gt;GeneralPurposeRegister;</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  146</span>    <span class="comment">// Because its RSP and as we didn&#39;t save RSP correctly (because of pushes)</span></div>
<div class="line"><span class="lineno">  147</span>    <span class="comment">// so we have make it points to the GUEST_RSP</span></div>
<div class="line"><span class="lineno">  148</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  151</span>    <span class="comment">// We handled it in vm-exit handler, commented</span></div>
<div class="line"><span class="lineno">  152</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  155</span><span class="comment">    if (CrExitQualification-&gt;Fields.Register == 4)</span></div>
<div class="line"><span class="lineno">  156</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno">  157</span><span class="comment">        __vmx_vmread(VMCS_GUEST_RSP, &amp;GuestRsp);</span></div>
<div class="line"><span class="lineno">  158</span><span class="comment">        *RegPtr = GuestRsp;</span></div>
<div class="line"><span class="lineno">  159</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  160</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>    <span class="keywordflow">switch</span> (CrExitQualification-&gt;AccessType)</div>
<div class="line"><span class="lineno">  163</span>    {</div>
<div class="line"><span class="lineno">  164</span>    <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_ACCESS_MOV_TO_CR:</div>
<div class="line"><span class="lineno">  165</span>    {</div>
<div class="line"><span class="lineno">  166</span>        <span class="keywordflow">switch</span> (CrExitQualification-&gt;ControlRegister)</div>
<div class="line"><span class="lineno">  167</span>        {</div>
<div class="line"><span class="lineno">  168</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR0:</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>            <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_CR0, *RegPtr);</div>
<div class="line"><span class="lineno">  171</span>            <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_CR0_READ_SHADOW, *RegPtr);</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR3:</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>            NewCr3          = (*RegPtr &amp; ~(1ULL &lt;&lt; 63));</div>
<div class="line"><span class="lineno">  178</span>            NewCr3Reg.Flags = NewCr3;</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  181</span>            <span class="comment">// Apply the new cr3</span></div>
<div class="line"><span class="lineno">  182</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  183</span>            <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_CR3, NewCr3Reg.Flags);</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  186</span>            <span class="comment">// Invalidate as we used VPID tags so the vm-exit won&#39;t</span></div>
<div class="line"><span class="lineno">  187</span>            <span class="comment">// normally (automatically) flush the TLB, we have to do</span></div>
<div class="line"><span class="lineno">  188</span>            <span class="comment">// it manually</span></div>
<div class="line"><span class="lineno">  189</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  190</span>            <a class="code hl_function" href="_vpid_8c.html#a306dbebaf7bd06e8fbec1c2c7692db0e">VpidInvvpidSingleContext</a>(<a class="code hl_define" href="_vpid_8h.html#ac29c244ea6b9522b000f1633c4d65bc8">VPID_TAG</a>);</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  193</span>            <span class="comment">// Call kernel debugger handler for mov to cr3 in kernel debugger</span></div>
<div class="line"><span class="lineno">  194</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  195</span>            <a class="code hl_function" href="_callback_8c.html#afebd5a76ce72e0546d387c82224ed241">InterceptionCallbackTriggerCr3ProcessChange</a>(VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ad166851f334095bff309813f73ea394e">CoreId</a>);</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  198</span>            <span class="comment">// Call user debugger handler of thread intercepting mechanism</span></div>
<div class="line"><span class="lineno">  199</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  200</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="_global_variables_8h.html#a2945717b38be3209d407eb31dc9d5f4b">g_CheckPageFaultsAndMov2Cr3VmexitsWithUserDebugger</a>)</div>
<div class="line"><span class="lineno">  201</span>            {</div>
<div class="line"><span class="lineno">  202</span>                <a class="code hl_function" href="_callback_8c.html#a95e23295264cbff001092948f328b17a">InterceptionCallbackCr3VmexitsForThreadInterception</a>(VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ad166851f334095bff309813f73ea394e">CoreId</a>, NewCr3Reg);</div>
<div class="line"><span class="lineno">  203</span>            }</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  206</span>            <span class="comment">// Call handler of the reversing machine</span></div>
<div class="line"><span class="lineno">  207</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  208</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="_global_variables_8h.html#afa6581e952ff0d7e78a6ff312ed942bd">g_ExecTrapInitialized</a>)</div>
<div class="line"><span class="lineno">  209</span>            {</div>
<div class="line"><span class="lineno">  210</span>                <a class="code hl_function" href="_exec_trap_8c.html#a2995044b89b1a737eba0fc2621f4b697">ExecTrapHandleCr3Vmexit</a>(VCpu);</div>
<div class="line"><span class="lineno">  211</span>            }</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR4:</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>            <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_CR4, *RegPtr);</div>
<div class="line"><span class="lineno">  218</span>            <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_CR4_READ_SHADOW, *RegPtr);</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  223</span>            <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a>(<span class="stringliteral">&quot;Unsupported register 0x%x in handling control registers access&quot;</span>,</div>
<div class="line"><span class="lineno">  224</span>                       CrExitQualification-&gt;ControlRegister);</div>
<div class="line"><span class="lineno">  225</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  226</span>        }</div>
<div class="line"><span class="lineno">  227</span>    }</div>
<div class="line"><span class="lineno">  228</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>    <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_ACCESS_MOV_FROM_CR:</div>
<div class="line"><span class="lineno">  231</span>    {</div>
<div class="line"><span class="lineno">  232</span>        <span class="keywordflow">switch</span> (CrExitQualification-&gt;ControlRegister)</div>
<div class="line"><span class="lineno">  233</span>        {</div>
<div class="line"><span class="lineno">  234</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR0:</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>            __vmx_vmread(VMCS_GUEST_CR0, RegPtr);</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR3:</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>            __vmx_vmread(VMCS_GUEST_CR3, RegPtr);</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_CR4:</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>            __vmx_vmread(VMCS_GUEST_CR4, RegPtr);</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  253</span>            <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a>(<span class="stringliteral">&quot;Unsupported register 0x%x in handling control registers access&quot;</span>,</div>
<div class="line"><span class="lineno">  254</span>                       CrExitQualification-&gt;ControlRegister);</div>
<div class="line"><span class="lineno">  255</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  256</span>        }</div>
<div class="line"><span class="lineno">  257</span>    }</div>
<div class="line"><span class="lineno">  258</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  261</span>        <a class="code hl_define" href="_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a>(<span class="stringliteral">&quot;Unsupported operation 0x%x in handling control registers access&quot;</span>,</div>
<div class="line"><span class="lineno">  262</span>                   CrExitQualification-&gt;AccessType);</div>
<div class="line"><span class="lineno">  263</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  264</span>    }</div>
<div class="line"><span class="lineno">  265</span>}</div>
<div class="ttc" id="a_callback_8c_html_a95e23295264cbff001092948f328b17a"><div class="ttname"><a href="_callback_8c.html#a95e23295264cbff001092948f328b17a">InterceptionCallbackCr3VmexitsForThreadInterception</a></div><div class="ttdeci">VOID InterceptionCallbackCr3VmexitsForThreadInterception(UINT32 CoreId, CR3_TYPE NewCr3)</div><div class="ttdoc">routine callback to handle cr3 process change</div><div class="ttdef"><b>Definition</b> Callback.c:428</div></div>
<div class="ttc" id="a_callback_8c_html_afebd5a76ce72e0546d387c82224ed241"><div class="ttname"><a href="_callback_8c.html#afebd5a76ce72e0546d387c82224ed241">InterceptionCallbackTriggerCr3ProcessChange</a></div><div class="ttdeci">VOID InterceptionCallbackTriggerCr3ProcessChange(UINT32 CoreId)</div><div class="ttdoc">routine callback to handle cr3 process change</div><div class="ttdef"><b>Definition</b> Callback.c:406</div></div>
<div class="ttc" id="a_exec_trap_8c_html_a2995044b89b1a737eba0fc2621f4b697"><div class="ttname"><a href="_exec_trap_8c.html#a2995044b89b1a737eba0fc2621f4b697">ExecTrapHandleCr3Vmexit</a></div><div class="ttdeci">VOID ExecTrapHandleCr3Vmexit(VIRTUAL_MACHINE_STATE *VCpu)</div><div class="ttdoc">Handle MOV to CR3 vm-exits for hooking mode execution.</div><div class="ttdef"><b>Definition</b> ExecTrap.c:847</div></div>
<div class="ttc" id="a_global_variables_8h_html_a2945717b38be3209d407eb31dc9d5f4b"><div class="ttname"><a href="_global_variables_8h.html#a2945717b38be3209d407eb31dc9d5f4b">g_CheckPageFaultsAndMov2Cr3VmexitsWithUserDebugger</a></div><div class="ttdeci">BOOLEAN g_CheckPageFaultsAndMov2Cr3VmexitsWithUserDebugger</div><div class="ttdoc">Whether the page-fault and cr3 vm-exits in vmx-root should check the #PFs or the PML4....</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:114</div></div>
<div class="ttc" id="a_global_variables_8h_html_afa6581e952ff0d7e78a6ff312ed942bd"><div class="ttname"><a href="_global_variables_8h.html#afa6581e952ff0d7e78a6ff312ed942bd">g_ExecTrapInitialized</a></div><div class="ttdeci">BOOLEAN g_ExecTrapInitialized</div><div class="ttdoc">Showes whether the execution trap handler is allowed to trigger an event or not.</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:149</div></div>
<div class="ttc" id="a_hyper_dbg_hyper_log_intrinsics_8h_html_abf506c814a6f717a87b5d808b828ef56"><div class="ttname"><a href="_hyper_dbg_hyper_log_intrinsics_8h.html#abf506c814a6f717a87b5d808b828ef56">LogWarning</a></div><div class="ttdeci">#define LogWarning(format,...)</div><div class="ttdoc">Log in the case of warning.</div><div class="ttdef"><b>Definition</b> HyperDbgHyperLogIntrinsics.h:99</div></div>
<div class="ttc" id="a_vpid_8c_html_a306dbebaf7bd06e8fbec1c2c7692db0e"><div class="ttname"><a href="_vpid_8c.html#a306dbebaf7bd06e8fbec1c2c7692db0e">VpidInvvpidSingleContext</a></div><div class="ttdeci">VOID VpidInvvpidSingleContext(UINT16 Vpid)</div><div class="ttdoc">INVVPID Single Context.</div><div class="ttdef"><b>Definition</b> Vpid.c:62</div></div>
<div class="ttc" id="a_vpid_8h_html_ac29c244ea6b9522b000f1633c4d65bc8"><div class="ttname"><a href="_vpid_8h.html#ac29c244ea6b9522b000f1633c4d65bc8">VPID_TAG</a></div><div class="ttdeci">#define VPID_TAG</div><div class="ttdoc">VPID Tag.</div><div class="ttdef"><b>Definition</b> Vpid.h:30</div></div>
<div class="ttc" id="astruct___c_r3___t_y_p_e_html"><div class="ttname"><a href="struct___c_r3___t_y_p_e.html">_CR3_TYPE</a></div><div class="ttdoc">CR3 Structure.</div><div class="ttdef"><b>Definition</b> BasicTypes.h:130</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_aae00ab92fdce5f90e65edb3bd10ae696"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">_VIRTUAL_MACHINE_STATE::Regs</a></div><div class="ttdeci">GUEST_REGS * Regs</div><div class="ttdef"><b>Definition</b> State.h:305</div></div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_ad166851f334095bff309813f73ea394e"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ad166851f334095bff309813f73ea394e">_VIRTUAL_MACHINE_STATE::CoreId</a></div><div class="ttdeci">UINT32 CoreId</div><div class="ttdef"><b>Definition</b> State.h:306</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html_a346ed6ae20503154a9a8031491706b3e"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">GUEST_REGS::rax</a></div><div class="ttdeci">UINT64 rax</div><div class="ttdef"><b>Definition</b> BasicTypes.h:75</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e659558abb0c1a6977e68c59130dbc9" name="a8e659558abb0c1a6977e68c59130dbc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e659558abb0c1a6977e68c59130dbc9">&#9670;&#160;</a></span>HvHandleCpuid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvHandleCpuid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle Cpuid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Handle Cpuid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   68</span>{</div>
<div class="line"><span class="lineno">   69</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a>       CpuInfo[4];</div>
<div class="line"><span class="lineno">   70</span>    <a class="code hl_struct" href="struct_g_u_e_s_t___r_e_g_s.html">PGUEST_REGS</a> Regs = VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">Regs</a>;</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   73</span>    <span class="comment">// Otherwise, issue the CPUID to the logical processor based on the indexes</span></div>
<div class="line"><span class="lineno">   74</span>    <span class="comment">// on the VP&#39;s GPRs.</span></div>
<div class="line"><span class="lineno">   75</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   76</span>    __cpuidex(CpuInfo, (<a class="code hl_typedef" href="_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a>)Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a>, (<a class="code hl_typedef" href="_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a>)Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a9a9133a328f13d405c31df928307e9fd">rcx</a>);</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">// check whether we are in transparent mode or not</span></div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// if we are in transparent mode then ignore the</span></div>
<div class="line"><span class="lineno">   81</span>    <span class="comment">// cpuid modifications e.g. hyperviosr name or bit</span></div>
<div class="line"><span class="lineno">   82</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="_global_variables_8h.html#ac816bbc1a82e6e556bfddcb9e55d5e05">g_TransparentMode</a>)</div>
<div class="line"><span class="lineno">   84</span>    {</div>
<div class="line"><span class="lineno">   85</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   86</span>        <span class="comment">// Check if this was CPUID 1h, which is the features request</span></div>
<div class="line"><span class="lineno">   87</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">   88</span>        <span class="keywordflow">if</span> (Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a> == <a class="code hl_define" href="hyperhv_2header_2common_2_common_8h.html#a03cfc7025f4062e90f20a847320ef189">CPUID_PROCESSOR_AND_PROCESSOR_FEATURE_IDENTIFIERS</a>)</div>
<div class="line"><span class="lineno">   89</span>        {</div>
<div class="line"><span class="lineno">   90</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">   91</span>            <span class="comment">// Set the Hypervisor Present-bit in RCX, which Intel and AMD have both</span></div>
<div class="line"><span class="lineno">   92</span>            <span class="comment">// reserved for this indication</span></div>
<div class="line"><span class="lineno">   93</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">   94</span>            CpuInfo[2] |= <a class="code hl_define" href="_hyperv_tlfs_8h.html#aaf955b30321d11973faeeec0cde3a34b">HYPERV_HYPERVISOR_PRESENT_BIT</a>;</div>
<div class="line"><span class="lineno">   95</span>        }</div>
<div class="line"><span class="lineno">   96</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a> == <a class="code hl_define" href="hyperhv_2header_2common_2_common_8h.html#aa16a8e159c357ee9b33185e1ab41ce4d">CPUID_HV_VENDOR_AND_MAX_FUNCTIONS</a>)</div>
<div class="line"><span class="lineno">   97</span>        {</div>
<div class="line"><span class="lineno">   98</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">   99</span>            <span class="comment">// Return a maximum supported hypervisor CPUID leaf range and a vendor</span></div>
<div class="line"><span class="lineno">  100</span>            <span class="comment">// ID signature as required by the spec</span></div>
<div class="line"><span class="lineno">  101</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>            CpuInfo[0] = <a class="code hl_define" href="_hyperv_tlfs_8h.html#aa085d0743946eb61ab8c5f5e4a700400">HYPERV_CPUID_INTERFACE</a>;</div>
<div class="line"><span class="lineno">  104</span>            CpuInfo[1] = <span class="stringliteral">&#39;epyH&#39;</span>; <span class="comment">// [HyperDbg]</span></div>
<div class="line"><span class="lineno">  105</span>            CpuInfo[2] = <span class="stringliteral">&#39;gbDr&#39;</span>;</div>
<div class="line"><span class="lineno">  106</span>            CpuInfo[3] = 0;</div>
<div class="line"><span class="lineno">  107</span>        }</div>
<div class="line"><span class="lineno">  108</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a> == <a class="code hl_define" href="_hyperv_tlfs_8h.html#aa085d0743946eb61ab8c5f5e4a700400">HYPERV_CPUID_INTERFACE</a>)</div>
<div class="line"><span class="lineno">  109</span>        {</div>
<div class="line"><span class="lineno">  110</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  111</span>            <span class="comment">// Return non Hv#1 value. This indicate that our hypervisor does NOT</span></div>
<div class="line"><span class="lineno">  112</span>            <span class="comment">// conform to the Microsoft hypervisor interface.</span></div>
<div class="line"><span class="lineno">  113</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>            CpuInfo[0] = <span class="stringliteral">&#39;0#vH&#39;</span>; <span class="comment">// Hv#0</span></div>
<div class="line"><span class="lineno">  116</span>            CpuInfo[1] = CpuInfo[2] = CpuInfo[3] = 0;</div>
<div class="line"><span class="lineno">  117</span>        }</div>
<div class="line"><span class="lineno">  118</span>    }</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  121</span>    <span class="comment">// Copy the values from the logical processor registers into the VP GPRs</span></div>
<div class="line"><span class="lineno">  122</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  123</span>    Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a346ed6ae20503154a9a8031491706b3e">rax</a> = CpuInfo[0];</div>
<div class="line"><span class="lineno">  124</span>    Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a8a95c365842376e2fbd23434a11a51d1">rbx</a> = CpuInfo[1];</div>
<div class="line"><span class="lineno">  125</span>    Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#a9a9133a328f13d405c31df928307e9fd">rcx</a> = CpuInfo[2];</div>
<div class="line"><span class="lineno">  126</span>    Regs-&gt;<a class="code hl_variable" href="struct_g_u_e_s_t___r_e_g_s.html#aec9eaf1f15df1582b6f00119516a8e08">rdx</a> = CpuInfo[3];</div>
<div class="line"><span class="lineno">  127</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a1137216524060afd426c34677fed058b"><div class="ttname"><a href="_basic_types_8h.html#a1137216524060afd426c34677fed058b">INT32</a></div><div class="ttdeci">signed int INT32</div><div class="ttdef"><b>Definition</b> BasicTypes.h:44</div></div>
<div class="ttc" id="a_global_variables_8h_html_ac816bbc1a82e6e556bfddcb9e55d5e05"><div class="ttname"><a href="_global_variables_8h.html#ac816bbc1a82e6e556bfddcb9e55d5e05">g_TransparentMode</a></div><div class="ttdeci">BOOLEAN g_TransparentMode</div><div class="ttdoc">Shows whether the debugger transparent mode is enabled (true) or not (false)</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:75</div></div>
<div class="ttc" id="a_hyperv_tlfs_8h_html_aa085d0743946eb61ab8c5f5e4a700400"><div class="ttname"><a href="_hyperv_tlfs_8h.html#aa085d0743946eb61ab8c5f5e4a700400">HYPERV_CPUID_INTERFACE</a></div><div class="ttdeci">#define HYPERV_CPUID_INTERFACE</div><div class="ttdef"><b>Definition</b> HypervTlfs.h:15</div></div>
<div class="ttc" id="a_hyperv_tlfs_8h_html_aaf955b30321d11973faeeec0cde3a34b"><div class="ttname"><a href="_hyperv_tlfs_8h.html#aaf955b30321d11973faeeec0cde3a34b">HYPERV_HYPERVISOR_PRESENT_BIT</a></div><div class="ttdeci">#define HYPERV_HYPERVISOR_PRESENT_BIT</div><div class="ttdef"><b>Definition</b> HypervTlfs.h:31</div></div>
<div class="ttc" id="ahyperhv_2header_2common_2_common_8h_html_a03cfc7025f4062e90f20a847320ef189"><div class="ttname"><a href="hyperhv_2header_2common_2_common_8h.html#a03cfc7025f4062e90f20a847320ef189">CPUID_PROCESSOR_AND_PROCESSOR_FEATURE_IDENTIFIERS</a></div><div class="ttdeci">#define CPUID_PROCESSOR_AND_PROCESSOR_FEATURE_IDENTIFIERS</div><div class="ttdoc">CPUID Features.</div><div class="ttdef"><b>Definition</b> Common.h:157</div></div>
<div class="ttc" id="ahyperhv_2header_2common_2_common_8h_html_aa16a8e159c357ee9b33185e1ab41ce4d"><div class="ttname"><a href="hyperhv_2header_2common_2_common_8h.html#aa16a8e159c357ee9b33185e1ab41ce4d">CPUID_HV_VENDOR_AND_MAX_FUNCTIONS</a></div><div class="ttdeci">#define CPUID_HV_VENDOR_AND_MAX_FUNCTIONS</div><div class="ttdoc">The Microsoft Hypervisor interface defined constants.</div><div class="ttdef"><b>Definition</b> Common.h:144</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html">GUEST_REGS</a></div><div class="ttdef"><b>Definition</b> BasicTypes.h:70</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html_a8a95c365842376e2fbd23434a11a51d1"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html#a8a95c365842376e2fbd23434a11a51d1">GUEST_REGS::rbx</a></div><div class="ttdeci">UINT64 rbx</div><div class="ttdef"><b>Definition</b> BasicTypes.h:78</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html_a9a9133a328f13d405c31df928307e9fd"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html#a9a9133a328f13d405c31df928307e9fd">GUEST_REGS::rcx</a></div><div class="ttdeci">UINT64 rcx</div><div class="ttdef"><b>Definition</b> BasicTypes.h:76</div></div>
<div class="ttc" id="astruct_g_u_e_s_t___r_e_g_s_html_aec9eaf1f15df1582b6f00119516a8e08"><div class="ttname"><a href="struct_g_u_e_s_t___r_e_g_s.html#aec9eaf1f15df1582b6f00119516a8e08">GUEST_REGS::rdx</a></div><div class="ttdeci">UINT64 rdx</div><div class="ttdef"><b>Definition</b> BasicTypes.h:77</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17ca5235cf591dc0e8b36b4a850e4592" name="a17ca5235cf591dc0e8b36b4a850e4592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17ca5235cf591dc0e8b36b4a850e4592">&#9670;&#160;</a></span>HvHandleMovDebugRegister()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvHandleMovDebugRegister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle Mov to Debug Registers Exitings. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  749</span>{</div>
<div class="line"><span class="lineno">  750</span>    VMX_EXIT_QUALIFICATION_MOV_DR ExitQualification;</div>
<div class="line"><span class="lineno">  751</span>    CR4                           Cr4;</div>
<div class="line"><span class="lineno">  752</span>    DR7                           Dr7;</div>
<div class="line"><span class="lineno">  753</span>    <a class="code hl_struct" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html">VMX_SEGMENT_SELECTOR</a>          Cs;</div>
<div class="line"><span class="lineno">  754</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> *                      GpRegs = (<a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> *)VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#aae00ab92fdce5f90e65edb3bd10ae696">Regs</a>;</div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  757</span>    <span class="comment">// The implementation is derived from Hvpp</span></div>
<div class="line"><span class="lineno">  758</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  759</span>    <a class="code hl_function" href="_vmx_8c.html#a030c9345db1d1e6cdf76c3289f5090d9">VmxVmread64P</a>(VMCS_EXIT_QUALIFICATION, &amp;ExitQualification.AsUInt);</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> GpRegister = GpRegs[ExitQualification.GeneralPurposeRegister];</div>
<div class="line"><span class="lineno">  762</span> </div>
<div class="line"><span class="lineno">  763</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  764</span>    <span class="comment">// The MOV DR instruction causes a VM exit if the &quot;MOV-DR exiting&quot;</span></div>
<div class="line"><span class="lineno">  765</span>    <span class="comment">// VM-execution control is 1.  Such VM exits represent an exception</span></div>
<div class="line"><span class="lineno">  766</span>    <span class="comment">// to the principles identified in Section 25.1.1 (Relative Priority</span></div>
<div class="line"><span class="lineno">  767</span>    <span class="comment">// of Faults and VM Exits) in that they take priority over the</span></div>
<div class="line"><span class="lineno">  768</span>    <span class="comment">// following: general-protection exceptions based on privilege level;</span></div>
<div class="line"><span class="lineno">  769</span>    <span class="comment">// and invalid-opcode exceptions that occur because CR4.DE = 1 and the</span></div>
<div class="line"><span class="lineno">  770</span>    <span class="comment">// instruction specified access to DR4 or DR5.</span></div>
<div class="line"><span class="lineno">  771</span>    <span class="comment">// (ref: Vol3C[25.1.3(Instructions That Cause VM Exits Conditionally)])</span></div>
<div class="line"><span class="lineno">  772</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  773</span>    <span class="comment">// TL;DR:</span></div>
<div class="line"><span class="lineno">  774</span>    <span class="comment">//   CPU usually prioritizes exceptions.  For example RDMSR executed</span></div>
<div class="line"><span class="lineno">  775</span>    <span class="comment">//   at CPL = 3 won&#39;t cause VM-exit - it causes #GP instead.  MOV DR</span></div>
<div class="line"><span class="lineno">  776</span>    <span class="comment">//   is exception to this rule, as it ALWAYS cause VM-exit.</span></div>
<div class="line"><span class="lineno">  777</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  778</span>    <span class="comment">//   Normally, CPU allows you to write to DR registers only at CPL=0,</span></div>
<div class="line"><span class="lineno">  779</span>    <span class="comment">//   otherwise it causes #GP.  Therefore we&#39;ll simulate the exact same</span></div>
<div class="line"><span class="lineno">  780</span>    <span class="comment">//   behavior here.</span></div>
<div class="line"><span class="lineno">  781</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  782</span> </div>
<div class="line"><span class="lineno">  783</span>    Cs = <a class="code hl_function" href="_manage_regs_8c.html#a3161f147c15ccc9d8322af1324548583">GetGuestCs</a>();</div>
<div class="line"><span class="lineno">  784</span> </div>
<div class="line"><span class="lineno">  785</span>    <span class="keywordflow">if</span> (Cs.Attributes.DescriptorPrivilegeLevel != 0)</div>
<div class="line"><span class="lineno">  786</span>    {</div>
<div class="line"><span class="lineno">  787</span>        <a class="code hl_function" href="_events_8c.html#ad328e1959f217955ece7ea133777ed21">EventInjectGeneralProtection</a>();</div>
<div class="line"><span class="lineno">  788</span> </div>
<div class="line"><span class="lineno">  789</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  790</span>        <span class="comment">// Redo the instruction</span></div>
<div class="line"><span class="lineno">  791</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  792</span>        <a class="code hl_function" href="_hv_8c.html#a384185281b4d93ce4a401d66848d9049">HvSuppressRipIncrement</a>(VCpu);</div>
<div class="line"><span class="lineno">  793</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  794</span>    }</div>
<div class="line"><span class="lineno">  795</span> </div>
<div class="line"><span class="lineno">  796</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  797</span>    <span class="comment">// Debug registers DR4 and DR5 are reserved when debug extensions</span></div>
<div class="line"><span class="lineno">  798</span>    <span class="comment">// are enabled (when the DE flag in control register CR4 is set)</span></div>
<div class="line"><span class="lineno">  799</span>    <span class="comment">// and attempts to reference the DR4 and DR5 registers cause</span></div>
<div class="line"><span class="lineno">  800</span>    <span class="comment">// invalid-opcode exceptions (#UD).</span></div>
<div class="line"><span class="lineno">  801</span>    <span class="comment">// When debug extensions are not enabled (when the DE flag is clear),</span></div>
<div class="line"><span class="lineno">  802</span>    <span class="comment">// these registers are aliased to debug registers DR6 and DR7.</span></div>
<div class="line"><span class="lineno">  803</span>    <span class="comment">// (ref: Vol3B[17.2.2(Debug Registers DR4 and DR5)])</span></div>
<div class="line"><span class="lineno">  804</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  807</span>    <span class="comment">// Read guest cr4</span></div>
<div class="line"><span class="lineno">  808</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  809</span>    <a class="code hl_function" href="_vmx_8c.html#a030c9345db1d1e6cdf76c3289f5090d9">VmxVmread64P</a>(VMCS_GUEST_CR4, &amp;Cr4.AsUInt);</div>
<div class="line"><span class="lineno">  810</span> </div>
<div class="line"><span class="lineno">  811</span>    <span class="keywordflow">if</span> (ExitQualification.DebugRegister == 4 || ExitQualification.DebugRegister == 5)</div>
<div class="line"><span class="lineno">  812</span>    {</div>
<div class="line"><span class="lineno">  813</span>        <span class="keywordflow">if</span> (Cr4.DebuggingExtensions)</div>
<div class="line"><span class="lineno">  814</span>        {</div>
<div class="line"><span class="lineno">  815</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  816</span>            <span class="comment">// re-inject #UD</span></div>
<div class="line"><span class="lineno">  817</span>            <span class="comment">//</span></div>
<div class="line"><span class="lineno">  818</span>            <a class="code hl_function" href="_events_8c.html#a286a8e064b7ca03d3f27750a8613683c">EventInjectUndefinedOpcode</a>(VCpu);</div>
<div class="line"><span class="lineno">  819</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  820</span>        }</div>
<div class="line"><span class="lineno">  821</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  822</span>        {</div>
<div class="line"><span class="lineno">  823</span>            ExitQualification.DebugRegister += 2;</div>
<div class="line"><span class="lineno">  824</span>        }</div>
<div class="line"><span class="lineno">  825</span>    }</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  828</span>    <span class="comment">// Enables (when set) debug-register protection, which causes a</span></div>
<div class="line"><span class="lineno">  829</span>    <span class="comment">// debug exception to be generated prior to any MOV instruction</span></div>
<div class="line"><span class="lineno">  830</span>    <span class="comment">// that accesses a debug register.  When such a condition is</span></div>
<div class="line"><span class="lineno">  831</span>    <span class="comment">// detected, the BD flag in debug status register DR6 is set prior</span></div>
<div class="line"><span class="lineno">  832</span>    <span class="comment">// to generating the exception.  This condition is provided to</span></div>
<div class="line"><span class="lineno">  833</span>    <span class="comment">// support in-circuit emulators.</span></div>
<div class="line"><span class="lineno">  834</span>    <span class="comment">// When the emulator needs to access the debug registers, emulator</span></div>
<div class="line"><span class="lineno">  835</span>    <span class="comment">// software can set the GD flag to prevent interference from the</span></div>
<div class="line"><span class="lineno">  836</span>    <span class="comment">// program currently executing on the processor.</span></div>
<div class="line"><span class="lineno">  837</span>    <span class="comment">// The processor clears the GD flag upon entering to the debug</span></div>
<div class="line"><span class="lineno">  838</span>    <span class="comment">// exception handler, to allow the handler access to the debug</span></div>
<div class="line"><span class="lineno">  839</span>    <span class="comment">// registers.</span></div>
<div class="line"><span class="lineno">  840</span>    <span class="comment">// (ref: Vol3B[17.2.4(Debug Control Register (DR7)])</span></div>
<div class="line"><span class="lineno">  841</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  842</span> </div>
<div class="line"><span class="lineno">  843</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  844</span>    <span class="comment">// Read the DR7</span></div>
<div class="line"><span class="lineno">  845</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  846</span>    <a class="code hl_function" href="_vmx_8c.html#a030c9345db1d1e6cdf76c3289f5090d9">VmxVmread64P</a>(VMCS_GUEST_DR7, &amp;Dr7.AsUInt);</div>
<div class="line"><span class="lineno">  847</span> </div>
<div class="line"><span class="lineno">  848</span>    <span class="keywordflow">if</span> (Dr7.GeneralDetect)</div>
<div class="line"><span class="lineno">  849</span>    {</div>
<div class="line"><span class="lineno">  850</span>        DR6 Dr6 = {</div>
<div class="line"><span class="lineno">  851</span>            .AsUInt                      = __readdr(6),</div>
<div class="line"><span class="lineno">  852</span>            .BreakpointCondition         = 0,</div>
<div class="line"><span class="lineno">  853</span>            .DebugRegisterAccessDetected = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>};</div>
<div class="line"><span class="lineno">  854</span> </div>
<div class="line"><span class="lineno">  855</span>        __writedr(6, Dr6.AsUInt);</div>
<div class="line"><span class="lineno">  856</span> </div>
<div class="line"><span class="lineno">  857</span>        Dr7.GeneralDetect = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>        <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_DR7, Dr7.AsUInt);</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>        <a class="code hl_function" href="_events_8c.html#ab27691a80df8d30baf8e9cf666a1855e">EventInjectDebugBreakpoint</a>();</div>
<div class="line"><span class="lineno">  862</span> </div>
<div class="line"><span class="lineno">  863</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  864</span>        <span class="comment">// Redo the instruction</span></div>
<div class="line"><span class="lineno">  865</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  866</span>        <a class="code hl_function" href="_hv_8c.html#a384185281b4d93ce4a401d66848d9049">HvSuppressRipIncrement</a>(VCpu);</div>
<div class="line"><span class="lineno">  867</span> </div>
<div class="line"><span class="lineno">  868</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  869</span>    }</div>
<div class="line"><span class="lineno">  870</span> </div>
<div class="line"><span class="lineno">  871</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  872</span>    <span class="comment">// In 64-bit mode, the upper 32 bits of DR6 and DR7 are reserved</span></div>
<div class="line"><span class="lineno">  873</span>    <span class="comment">// and must be written with zeros.  Writing 1 to any of the upper</span></div>
<div class="line"><span class="lineno">  874</span>    <span class="comment">// 32 bits results in a #GP(0) exception.</span></div>
<div class="line"><span class="lineno">  875</span>    <span class="comment">// (ref: Vol3B[17.2.6(Debug Registers and Intel 64 Processors)])</span></div>
<div class="line"><span class="lineno">  876</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  877</span>    <span class="keywordflow">if</span> (ExitQualification.DirectionOfAccess == VMX_EXIT_QUALIFICATION_DIRECTION_MOV_TO_DR &amp;&amp; (ExitQualification.DebugRegister == VMX_EXIT_QUALIFICATION_REGISTER_DR6 || ExitQualification.DebugRegister == VMX_EXIT_QUALIFICATION_REGISTER_DR7) &amp;&amp; (GpRegister &gt;&gt; 32) != 0)</div>
<div class="line"><span class="lineno">  878</span>    {</div>
<div class="line"><span class="lineno">  879</span>        <a class="code hl_function" href="_events_8c.html#ad328e1959f217955ece7ea133777ed21">EventInjectGeneralProtection</a>();</div>
<div class="line"><span class="lineno">  880</span> </div>
<div class="line"><span class="lineno">  881</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  882</span>        <span class="comment">// Redo the instruction</span></div>
<div class="line"><span class="lineno">  883</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno">  884</span>        <a class="code hl_function" href="_hv_8c.html#a384185281b4d93ce4a401d66848d9049">HvSuppressRipIncrement</a>(VCpu);</div>
<div class="line"><span class="lineno">  885</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  886</span>    }</div>
<div class="line"><span class="lineno">  887</span> </div>
<div class="line"><span class="lineno">  888</span>    <span class="keywordflow">switch</span> (ExitQualification.DirectionOfAccess)</div>
<div class="line"><span class="lineno">  889</span>    {</div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_DIRECTION_MOV_TO_DR:</div>
<div class="line"><span class="lineno">  891</span>        <span class="keywordflow">switch</span> (ExitQualification.DebugRegister)</div>
<div class="line"><span class="lineno">  892</span>        {</div>
<div class="line"><span class="lineno">  893</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR0:</div>
<div class="line"><span class="lineno">  894</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR0, GpRegister);</div>
<div class="line"><span class="lineno">  895</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  896</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR1:</div>
<div class="line"><span class="lineno">  897</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR1, GpRegister);</div>
<div class="line"><span class="lineno">  898</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  899</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR2:</div>
<div class="line"><span class="lineno">  900</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR2, GpRegister);</div>
<div class="line"><span class="lineno">  901</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  902</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR3:</div>
<div class="line"><span class="lineno">  903</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR3, GpRegister);</div>
<div class="line"><span class="lineno">  904</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  905</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR6:</div>
<div class="line"><span class="lineno">  906</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR6, GpRegister);</div>
<div class="line"><span class="lineno">  907</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  908</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR7:</div>
<div class="line"><span class="lineno">  909</span>            __writedr(VMX_EXIT_QUALIFICATION_REGISTER_DR7, GpRegister);</div>
<div class="line"><span class="lineno">  910</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  911</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  912</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  913</span>        }</div>
<div class="line"><span class="lineno">  914</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  915</span> </div>
<div class="line"><span class="lineno">  916</span>    <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_DIRECTION_MOV_FROM_DR:</div>
<div class="line"><span class="lineno">  917</span>        <span class="keywordflow">switch</span> (ExitQualification.DebugRegister)</div>
<div class="line"><span class="lineno">  918</span>        {</div>
<div class="line"><span class="lineno">  919</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR0:</div>
<div class="line"><span class="lineno">  920</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR0);</div>
<div class="line"><span class="lineno">  921</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  922</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR1:</div>
<div class="line"><span class="lineno">  923</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR1);</div>
<div class="line"><span class="lineno">  924</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  925</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR2:</div>
<div class="line"><span class="lineno">  926</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR2);</div>
<div class="line"><span class="lineno">  927</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  928</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR3:</div>
<div class="line"><span class="lineno">  929</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR3);</div>
<div class="line"><span class="lineno">  930</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  931</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR6:</div>
<div class="line"><span class="lineno">  932</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR6);</div>
<div class="line"><span class="lineno">  933</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  934</span>        <span class="keywordflow">case</span> VMX_EXIT_QUALIFICATION_REGISTER_DR7:</div>
<div class="line"><span class="lineno">  935</span>            GpRegister = __readdr(VMX_EXIT_QUALIFICATION_REGISTER_DR7);</div>
<div class="line"><span class="lineno">  936</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  937</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  938</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  939</span>        }</div>
<div class="line"><span class="lineno">  940</span> </div>
<div class="line"><span class="lineno">  941</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  942</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  943</span>    }</div>
<div class="line"><span class="lineno">  944</span>}</div>
<div class="ttc" id="a_events_8c_html_a286a8e064b7ca03d3f27750a8613683c"><div class="ttname"><a href="_events_8c.html#a286a8e064b7ca03d3f27750a8613683c">EventInjectUndefinedOpcode</a></div><div class="ttdeci">VOID EventInjectUndefinedOpcode(VIRTUAL_MACHINE_STATE *VCpu)</div><div class="ttdoc">Inject #UD to the guest (Invalid Opcode - Undefined Opcode)</div><div class="ttdef"><b>Definition</b> Events.c:79</div></div>
<div class="ttc" id="a_events_8c_html_ab27691a80df8d30baf8e9cf666a1855e"><div class="ttname"><a href="_events_8c.html#ab27691a80df8d30baf8e9cf666a1855e">EventInjectDebugBreakpoint</a></div><div class="ttdeci">VOID EventInjectDebugBreakpoint()</div><div class="ttdoc">Inject Debug Breakpoint Exception.</div><div class="ttdef"><b>Definition</b> Events.c:112</div></div>
<div class="ttc" id="a_events_8c_html_ad328e1959f217955ece7ea133777ed21"><div class="ttname"><a href="_events_8c.html#ad328e1959f217955ece7ea133777ed21">EventInjectGeneralProtection</a></div><div class="ttdeci">VOID EventInjectGeneralProtection()</div><div class="ttdoc">Inject #GP to the guest (Event Injection)</div><div class="ttdef"><b>Definition</b> Events.c:62</div></div>
<div class="ttc" id="a_hv_8c_html_a384185281b4d93ce4a401d66848d9049"><div class="ttname"><a href="_hv_8c.html#a384185281b4d93ce4a401d66848d9049">HvSuppressRipIncrement</a></div><div class="ttdeci">VOID HvSuppressRipIncrement(VIRTUAL_MACHINE_STATE *VCpu)</div><div class="ttdoc">Suppress the incrementation of RIP.</div><div class="ttdef"><b>Definition</b> Hv.c:324</div></div>
<div class="ttc" id="a_manage_regs_8c_html_a3161f147c15ccc9d8322af1324548583"><div class="ttname"><a href="_manage_regs_8c.html#a3161f147c15ccc9d8322af1324548583">GetGuestCs</a></div><div class="ttdeci">VMX_SEGMENT_SELECTOR GetGuestCs()</div><div class="ttdoc">Get the Guest Cs Selector.</div><div class="ttdef"><b>Definition</b> ManageRegs.c:49</div></div>
<div class="ttc" id="a_vmx_8c_html_a030c9345db1d1e6cdf76c3289f5090d9"><div class="ttname"><a href="_vmx_8c.html#a030c9345db1d1e6cdf76c3289f5090d9">VmxVmread64P</a></div><div class="ttdeci">UCHAR VmxVmread64P(size_t Field, UINT64 *FieldValue)</div><div class="ttdoc">VMX VMREAD instruction (64-bit)</div><div class="ttdef"><b>Definition</b> Vmx.c:72</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab629b9ab3070ec39143d0da60907c2c1" name="ab629b9ab3070ec39143d0da60907c2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab629b9ab3070ec39143d0da60907c2c1">&#9670;&#160;</a></span>HvInitVmm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> HvInitVmm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_v_m_m_8h.html#a1e73fd13bcaf23e83681c29178159f80">VMM_CALLBACKS</a> *</td>          <td class="paramname"><span class="paramname"><em>VmmCallbacks</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the hypervisor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VmmCallbacks</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1323</span>{</div>
<div class="line"><span class="lineno"> 1324</span>    <a class="code hl_typedef" href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a>   ProcessorsCount;</div>
<div class="line"><span class="lineno"> 1325</span>    <a class="code hl_typedef" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> Result = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1326</span> </div>
<div class="line"><span class="lineno"> 1327</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1328</span>    <span class="comment">// Save the callbacks</span></div>
<div class="line"><span class="lineno"> 1329</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1330</span>    RtlCopyMemory(&amp;<a class="code hl_variable" href="_global_variables_8h.html#aa97473c862a98f925b05ef0272432090">g_Callbacks</a>, VmmCallbacks, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct___v_m_m___c_a_l_l_b_a_c_k_s.html">VMM_CALLBACKS</a>));</div>
<div class="line"><span class="lineno"> 1331</span> </div>
<div class="line"><span class="lineno"> 1332</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1333</span>    <span class="comment">// Check and define compatibility checks and processor constraints</span></div>
<div class="line"><span class="lineno"> 1334</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1335</span>    <a class="code hl_function" href="_compatibility_checks_8c.html#a2a92ea0e79bfe3e5c494f49e5a614c4c">CompatibilityCheckPerformChecks</a>();</div>
<div class="line"><span class="lineno"> 1336</span> </div>
<div class="line"><span class="lineno"> 1337</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1338</span>    <span class="comment">// we allocate virtual machine here because</span></div>
<div class="line"><span class="lineno"> 1339</span>    <span class="comment">// we want to use its state (vmx-root or vmx non-root) in logs</span></div>
<div class="line"><span class="lineno"> 1340</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1341</span>    Result = <a class="code hl_function" href="_global_variable_management_8c.html#a64779ea5ab6cb491e0dd360a85923c39">GlobalGuestStateAllocateZeroedMemory</a>();</div>
<div class="line"><span class="lineno"> 1342</span> </div>
<div class="line"><span class="lineno"> 1343</span>    <span class="keywordflow">if</span> (!Result)</div>
<div class="line"><span class="lineno"> 1344</span>    {</div>
<div class="line"><span class="lineno"> 1345</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1346</span>    }</div>
<div class="line"><span class="lineno"> 1347</span> </div>
<div class="line"><span class="lineno"> 1348</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1349</span>    <span class="comment">// We have a zeroed guest state</span></div>
<div class="line"><span class="lineno"> 1350</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1351</span>    ProcessorsCount = KeQueryActiveProcessorCount(0);</div>
<div class="line"><span class="lineno"> 1352</span> </div>
<div class="line"><span class="lineno"> 1353</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1354</span>    <span class="comment">// Set the core&#39;s id and initialize memory mapper</span></div>
<div class="line"><span class="lineno"> 1355</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1356</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> i = 0; i &lt; ProcessorsCount; i++)</div>
<div class="line"><span class="lineno"> 1357</span>    {</div>
<div class="line"><span class="lineno"> 1358</span>        <a class="code hl_variable" href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a>[i].<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#ad166851f334095bff309813f73ea394e">CoreId</a> = i;</div>
<div class="line"><span class="lineno"> 1359</span>    }</div>
<div class="line"><span class="lineno"> 1360</span> </div>
<div class="line"><span class="lineno"> 1361</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1362</span>    <span class="comment">// Initialize memory mapper</span></div>
<div class="line"><span class="lineno"> 1363</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1364</span>    <a class="code hl_function" href="_memory_mapper_8c.html#a87027c3656905dd5301985602a608505">MemoryMapperInitialize</a>();</div>
<div class="line"><span class="lineno"> 1365</span> </div>
<div class="line"><span class="lineno"> 1366</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1367</span>    <span class="comment">// Make sure that transparent-mode is disabled</span></div>
<div class="line"><span class="lineno"> 1368</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1369</span>    <a class="code hl_variable" href="_global_variables_8h.html#ac816bbc1a82e6e556bfddcb9e55d5e05">g_TransparentMode</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1370</span> </div>
<div class="line"><span class="lineno"> 1371</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1372</span>    <span class="comment">// Not waiting for the interrupt-window to inject page-faults</span></div>
<div class="line"><span class="lineno"> 1373</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1374</span>    <a class="code hl_variable" href="_global_variables_8h.html#a4bc23ee3a2e55c59b15ef6db1e5388c0">g_WaitingForInterruptWindowToInjectPageFault</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno"> 1375</span> </div>
<div class="line"><span class="lineno"> 1376</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1377</span>    <span class="comment">// Initializes VMX</span></div>
<div class="line"><span class="lineno"> 1378</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1379</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="_vmx_8c.html#ae8edcdeb74c24f1408eca2daf1ce986a">VmxInitialize</a>();</div>
<div class="line"><span class="lineno"> 1380</span>}</div>
<div class="ttc" id="a_basic_types_8h_html_a1cb18096b299d23458d3c7b85fd86555"><div class="ttname"><a href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></div><div class="ttdeci">UCHAR BOOLEAN</div><div class="ttdef"><b>Definition</b> BasicTypes.h:39</div></div>
<div class="ttc" id="a_basic_types_8h_html_ae1e6edbbc26d6fbc71a90190d0266018"><div class="ttname"><a href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></div><div class="ttdeci">unsigned int UINT32</div><div class="ttdef"><b>Definition</b> BasicTypes.h:48</div></div>
<div class="ttc" id="a_basic_types_8h_html_af632da489ebc3708ec3ab6791ee53fa4"><div class="ttname"><a href="_basic_types_8h.html#af632da489ebc3708ec3ab6791ee53fa4">ULONG</a></div><div class="ttdeci">unsigned long ULONG</div><div class="ttdef"><b>Definition</b> BasicTypes.h:37</div></div>
<div class="ttc" id="a_compatibility_checks_8c_html_a2a92ea0e79bfe3e5c494f49e5a614c4c"><div class="ttname"><a href="_compatibility_checks_8c.html#a2a92ea0e79bfe3e5c494f49e5a614c4c">CompatibilityCheckPerformChecks</a></div><div class="ttdeci">VOID CompatibilityCheckPerformChecks()</div><div class="ttdoc">Checks for the compatibility features based on current processor @detail NOTE: NOT ALL OF THE CHECKS ...</div><div class="ttdef"><b>Definition</b> CompatibilityChecks.c:153</div></div>
<div class="ttc" id="a_global_variable_management_8c_html_a64779ea5ab6cb491e0dd360a85923c39"><div class="ttname"><a href="_global_variable_management_8c.html#a64779ea5ab6cb491e0dd360a85923c39">GlobalGuestStateAllocateZeroedMemory</a></div><div class="ttdeci">BOOLEAN GlobalGuestStateAllocateZeroedMemory(VOID)</div><div class="ttdoc">Allocate guest state memory.</div><div class="ttdef"><b>Definition</b> GlobalVariableManagement.c:20</div></div>
<div class="ttc" id="a_global_variables_8h_html_a04bac1f4beef0dcf1ce1a4d9ce72ea76"><div class="ttname"><a href="_global_variables_8h.html#a04bac1f4beef0dcf1ce1a4d9ce72ea76">g_GuestState</a></div><div class="ttdeci">VIRTUAL_MACHINE_STATE * g_GuestState</div><div class="ttdoc">Save the state and variables related to virtualization on each to logical core.</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:38</div></div>
<div class="ttc" id="a_global_variables_8h_html_a4bc23ee3a2e55c59b15ef6db1e5388c0"><div class="ttname"><a href="_global_variables_8h.html#a4bc23ee3a2e55c59b15ef6db1e5388c0">g_WaitingForInterruptWindowToInjectPageFault</a></div><div class="ttdeci">BOOLEAN g_WaitingForInterruptWindowToInjectPageFault</div><div class="ttdoc">Shows whether the the VMM is waiting to inject a page-fault or not.</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:179</div></div>
<div class="ttc" id="a_global_variables_8h_html_aa97473c862a98f925b05ef0272432090"><div class="ttname"><a href="_global_variables_8h.html#aa97473c862a98f925b05ef0272432090">g_Callbacks</a></div><div class="ttdeci">VMM_CALLBACKS g_Callbacks</div><div class="ttdoc">List of callbacks.</div><div class="ttdef"><b>Definition</b> GlobalVariables.h:32</div></div>
<div class="ttc" id="a_memory_mapper_8c_html_a87027c3656905dd5301985602a608505"><div class="ttname"><a href="_memory_mapper_8c.html#a87027c3656905dd5301985602a608505">MemoryMapperInitialize</a></div><div class="ttdeci">VOID MemoryMapperInitialize()</div><div class="ttdoc">Initialize the Memory Mapper.</div><div class="ttdef"><b>Definition</b> MemoryMapper.c:661</div></div>
<div class="ttc" id="a_vmx_8c_html_ae8edcdeb74c24f1408eca2daf1ce986a"><div class="ttname"><a href="_vmx_8c.html#ae8edcdeb74c24f1408eca2daf1ce986a">VmxInitialize</a></div><div class="ttdeci">BOOLEAN VmxInitialize()</div><div class="ttdoc">Initialize the VMX operation.</div><div class="ttdef"><b>Definition</b> Vmx.c:260</div></div>
<div class="ttc" id="astruct___v_m_m___c_a_l_l_b_a_c_k_s_html"><div class="ttname"><a href="struct___v_m_m___c_a_l_l_b_a_c_k_s.html">_VMM_CALLBACKS</a></div><div class="ttdoc">Prototype of each function needed by VMM module.</div><div class="ttdef"><b>Definition</b> VMM.h:181</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad42815202d6371ffc05e7608bb181a54" name="ad42815202d6371ffc05e7608bb181a54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad42815202d6371ffc05e7608bb181a54">&#9670;&#160;</a></span>HvInjectPendingExternalInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvInjectPendingExternalInterrupts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inject pending external interrupts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1250</span>{</div>
<div class="line"><span class="lineno"> 1251</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1252</span>    <span class="comment">// Check if there is at least an interrupt that needs to be delivered</span></div>
<div class="line"><span class="lineno"> 1253</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1254</span>    <span class="keywordflow">if</span> (VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a7123e9d39156e57b44e62065ebe2fc9d">PendingExternalInterrupts</a>[0] != <a class="code hl_define" href="_basic_types_8h.html#a32ab457827837bf5ac123dd0fd8326ae">NULL_ZERO</a>)</div>
<div class="line"><span class="lineno"> 1255</span>    {</div>
<div class="line"><span class="lineno"> 1256</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1257</span>        <span class="comment">// Enable Interrupt-window exiting.</span></div>
<div class="line"><span class="lineno"> 1258</span>        <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1259</span>        <a class="code hl_function" href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a>(<a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1260</span>    }</div>
<div class="line"><span class="lineno"> 1261</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a826a60c83941bba6d1012ec8cae27e6f" name="a826a60c83941bba6d1012ec8cae27e6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a826a60c83941bba6d1012ec8cae27e6f">&#9670;&#160;</a></span>HvPerformRipIncrement()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvPerformRipIncrement </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Perform the incrementation of RIP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  338</span>{</div>
<div class="line"><span class="lineno">  339</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a95be62d62b8c4a2e9bd6bf75a0ba4cd1">IncrementRip</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">  340</span>}</div>
<div class="ttc" id="astruct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e_html_a95be62d62b8c4a2e9bd6bf75a0ba4cd1"><div class="ttname"><a href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a95be62d62b8c4a2e9bd6bf75a0ba4cd1">_VIRTUAL_MACHINE_STATE::IncrementRip</a></div><div class="ttdeci">BOOLEAN IncrementRip</div><div class="ttdef"><b>Definition</b> State.h:292</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77588821314d5b29ee748b79afbb5732" name="a77588821314d5b29ee748b79afbb5732"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77588821314d5b29ee748b79afbb5732">&#9670;&#160;</a></span>HvPreventExternalInterrupts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvPreventExternalInterrupts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjust external interrupt state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1427</span>{</div>
<div class="line"><span class="lineno"> 1428</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1429</span>    <span class="comment">// Change guest interrupt-state</span></div>
<div class="line"><span class="lineno"> 1430</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1431</span>    <a class="code hl_function" href="_hv_8c.html#a856a41c4038e4065c52eb90db0160ab2">HvSetExternalInterruptExiting</a>(VCpu, <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1434</span>    <span class="comment">// Do not vm-exit on interrupt windows</span></div>
<div class="line"><span class="lineno"> 1435</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1436</span>    <a class="code hl_function" href="_hv_8c.html#a4e8c2928eefa854763176a7f18bb04ca">HvSetInterruptWindowExiting</a>(<a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
<div class="line"><span class="lineno"> 1437</span> </div>
<div class="line"><span class="lineno"> 1438</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1439</span>    <span class="comment">// Indicate that we should enable external interrupts and configure external interrupt</span></div>
<div class="line"><span class="lineno"> 1440</span>    <span class="comment">// window exiting somewhere at MTF</span></div>
<div class="line"><span class="lineno"> 1441</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1442</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a6532add9fa7c9358728a495d904a8b87">EnableExternalInterruptsOnContinueMtf</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno"> 1443</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a356bf8e90c3548911031ccd655359517" name="a356bf8e90c3548911031ccd655359517"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a356bf8e90c3548911031ccd655359517">&#9670;&#160;</a></span>HvReadExceptionBitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> HvReadExceptionBitmap </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the exception bitmap. </p>
<dl class="section return"><dt>Returns</dt><dd>UINT32</dd></dl>
<p>Read the exception bitmap.</p>
<p>Should be called in vmx-root</p>
<dl class="section return"><dt>Returns</dt><dd>UINT32 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  588</span>{</div>
<div class="line"><span class="lineno">  589</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> ExceptionBitmap = 0;</div>
<div class="line"><span class="lineno">  590</span> </div>
<div class="line"><span class="lineno">  591</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  592</span>    <span class="comment">// Read the current bitmap</span></div>
<div class="line"><span class="lineno">  593</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  594</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_EXCEPTION_BITMAP, &amp;ExceptionBitmap);</div>
<div class="line"><span class="lineno">  595</span> </div>
<div class="line"><span class="lineno">  596</span>    <span class="keywordflow">return</span> ExceptionBitmap;</div>
<div class="line"><span class="lineno">  597</span>}</div>
<div class="ttc" id="a_vmx_8c_html_af411da3719b3f7f9198be1b8bc6c6874"><div class="ttname"><a href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a></div><div class="ttdeci">UCHAR VmxVmread32P(size_t Field, UINT32 *FieldValue)</div><div class="ttdoc">VMX VMREAD instruction (32-bit)</div><div class="ttdef"><b>Definition</b> Vmx.c:86</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a011d070043f596f715b8a1deee31786c" name="a011d070043f596f715b8a1deee31786c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a011d070043f596f715b8a1deee31786c">&#9670;&#160;</a></span>HvRestoreRegisters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvRestoreRegisters </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset GDTR/IDTR and other old when you do vmxoff as the patchguard will detect them left modified. </p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  464</span>{</div>
<div class="line"><span class="lineno">  465</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> FsBase;</div>
<div class="line"><span class="lineno">  466</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> GsBase;</div>
<div class="line"><span class="lineno">  467</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> GdtrBase;</div>
<div class="line"><span class="lineno">  468</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> GdtrLimit;</div>
<div class="line"><span class="lineno">  469</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> IdtrBase;</div>
<div class="line"><span class="lineno">  470</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> IdtrLimit;</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  473</span>    <span class="comment">// Restore FS Base</span></div>
<div class="line"><span class="lineno">  474</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  475</span>    __vmx_vmread(VMCS_GUEST_FS_BASE, &amp;FsBase);</div>
<div class="line"><span class="lineno">  476</span>    __writemsr(IA32_FS_BASE, FsBase);</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  479</span>    <span class="comment">// Restore Gs Base</span></div>
<div class="line"><span class="lineno">  480</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  481</span>    __vmx_vmread(VMCS_GUEST_GS_BASE, &amp;GsBase);</div>
<div class="line"><span class="lineno">  482</span>    __writemsr(IA32_GS_BASE, GsBase);</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  485</span>    <span class="comment">// Restore GDTR</span></div>
<div class="line"><span class="lineno">  486</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  487</span>    __vmx_vmread(VMCS_GUEST_GDTR_BASE, &amp;GdtrBase);</div>
<div class="line"><span class="lineno">  488</span>    __vmx_vmread(VMCS_GUEST_GDTR_LIMIT, &amp;GdtrLimit);</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>    <a class="code hl_function" href="_inline_asm_8h.html#ace9f194d7b9f227bf86406452701f0ae">AsmReloadGdtr</a>((<span class="keywordtype">void</span> *)GdtrBase, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)GdtrLimit);</div>
<div class="line"><span class="lineno">  491</span> </div>
<div class="line"><span class="lineno">  492</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  493</span>    <span class="comment">// Restore IDTR</span></div>
<div class="line"><span class="lineno">  494</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  495</span>    __vmx_vmread(VMCS_GUEST_IDTR_BASE, &amp;IdtrBase);</div>
<div class="line"><span class="lineno">  496</span>    __vmx_vmread(VMCS_GUEST_IDTR_LIMIT, &amp;IdtrLimit);</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>    <a class="code hl_function" href="_inline_asm_8h.html#a028a83454f610785aa8e64d6d6d9e659">AsmReloadIdtr</a>((<span class="keywordtype">void</span> *)IdtrBase, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)IdtrLimit);</div>
<div class="line"><span class="lineno">  499</span>}</div>
<div class="ttc" id="a_inline_asm_8h_html_a028a83454f610785aa8e64d6d6d9e659"><div class="ttname"><a href="_inline_asm_8h.html#a028a83454f610785aa8e64d6d6d9e659">AsmReloadIdtr</a></div><div class="ttdeci">void AsmReloadIdtr(void *GdtBase, unsigned long GdtLimit)</div><div class="ttdoc">Reload new IDTR.</div></div>
<div class="ttc" id="a_inline_asm_8h_html_ace9f194d7b9f227bf86406452701f0ae"><div class="ttname"><a href="_inline_asm_8h.html#ace9f194d7b9f227bf86406452701f0ae">AsmReloadGdtr</a></div><div class="ttdeci">void AsmReloadGdtr(void *GdtBase, unsigned long GdtLimit)</div><div class="ttdoc">Reload new GDTR.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a635a41a75799273745a2af474455c4aa" name="a635a41a75799273745a2af474455c4aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a635a41a75799273745a2af474455c4aa">&#9670;&#160;</a></span>HvResumeToNextInstruction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvResumeToNextInstruction </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resume GUEST_RIP to next instruction. </p>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Resume GUEST_RIP to next instruction.</p>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  303</span>{</div>
<div class="line"><span class="lineno">  304</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> ResumeRIP             = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno">  305</span>    <a class="code hl_typedef" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a> CurrentRIP            = <a class="code hl_define" href="_basic_types_8h.html#a8a9df53f35cb95dddbe3c564259e01ad">NULL64_ZERO</a>;</div>
<div class="line"><span class="lineno">  306</span>    <span class="keywordtype">size_t</span> ExitInstructionLength = 0;</div>
<div class="line"><span class="lineno">  307</span> </div>
<div class="line"><span class="lineno">  308</span>    __vmx_vmread(VMCS_GUEST_RIP, &amp;CurrentRIP);</div>
<div class="line"><span class="lineno">  309</span>    __vmx_vmread(VMCS_VMEXIT_INSTRUCTION_LENGTH, &amp;ExitInstructionLength);</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>    ResumeRIP = CurrentRIP + ExitInstructionLength;</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_RIP, ResumeRIP);</div>
<div class="line"><span class="lineno">  314</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad9fc64fae8bbc000a6e8949e78547027" name="ad9fc64fae8bbc000a6e8949e78547027"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9fc64fae8bbc000a6e8949e78547027">&#9670;&#160;</a></span>HvSetExceptionBitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetExceptionBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>IdtIndex</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set exception bitmap in VMCS. </p>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IdtIndex</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">IdtIndex</td><td>Interrupt Descriptor Table index of exception </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1023</span>{</div>
<div class="line"><span class="lineno"> 1024</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1025</span>    <span class="comment">// This is a wrapper to perform extra checks</span></div>
<div class="line"><span class="lineno"> 1026</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1027</span>    <a class="code hl_function" href="_protected_hv_8c.html#aff1f6cdf6001d461503367b910b73d32">ProtectedHvSetExceptionBitmap</a>(VCpu, IdtIndex);</div>
<div class="line"><span class="lineno"> 1028</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_aff1f6cdf6001d461503367b910b73d32"><div class="ttname"><a href="_protected_hv_8c.html#aff1f6cdf6001d461503367b910b73d32">ProtectedHvSetExceptionBitmap</a></div><div class="ttdeci">VOID ProtectedHvSetExceptionBitmap(VIRTUAL_MACHINE_STATE *VCpu, UINT32 IdtIndex)</div><div class="ttdoc">Set exception bitmap in VMCS.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:75</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a856a41c4038e4065c52eb90db0160ab2" name="a856a41c4038e4065c52eb90db0160ab2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a856a41c4038e4065c52eb90db0160ab2">&#9670;&#160;</a></span>HvSetExternalInterruptExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetExternalInterruptExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the External Interrupt Exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">Set</td><td>Set or unset the External Interrupt Exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1056</span>{</div>
<div class="line"><span class="lineno"> 1057</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1058</span>    <span class="comment">// This is a wrapper to perform extra checks</span></div>
<div class="line"><span class="lineno"> 1059</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1060</span>    <a class="code hl_function" href="_protected_hv_8c.html#ae9ceabc2b266865dd9974e5361505525">ProtectedHvSetExternalInterruptExiting</a>(VCpu, Set);</div>
<div class="line"><span class="lineno"> 1061</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_ae9ceabc2b266865dd9974e5361505525"><div class="ttname"><a href="_protected_hv_8c.html#ae9ceabc2b266865dd9974e5361505525">ProtectedHvSetExternalInterruptExiting</a></div><div class="ttdeci">VOID ProtectedHvSetExternalInterruptExiting(VIRTUAL_MACHINE_STATE *VCpu, BOOLEAN Set)</div><div class="ttdoc">Set the External Interrupt Exiting.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:258</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f34aa654593d91e3051f8aa3b3e00cc" name="a2f34aa654593d91e3051f8aa3b3e00cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f34aa654593d91e3051f8aa3b3e00cc">&#9670;&#160;</a></span>HvSetGuestSelector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a> HvSetGuestSelector </td>
          <td>(</td>
          <td class="paramtype">PVOID</td>          <td class="paramname"><span class="paramname"><em>GdtBase</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>SegmentRegister</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a></td>          <td class="paramname"><span class="paramname"><em>Selector</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Guest Selector Registers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GdtBase</td><td></td></tr>
    <tr><td class="paramname">SegmentRegister</td><td></td></tr>
    <tr><td class="paramname">Selector</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN</dd></dl>
<p>Set Guest Selector Registers.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GdtBase</td><td></td></tr>
    <tr><td class="paramname">SegmentRegister</td><td></td></tr>
    <tr><td class="paramname">Selector</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>BOOLEAN </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   43</span>{</div>
<div class="line"><span class="lineno">   44</span>    <a class="code hl_struct" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html">VMX_SEGMENT_SELECTOR</a> <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a> = {0};</div>
<div class="line"><span class="lineno">   45</span>    <a class="code hl_function" href="_segmentation_8c.html#a2b0862e110c0218f941196fcab600043">SegmentGetDescriptor</a>(GdtBase, <a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>, &amp;<a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>);</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a> == 0x0)</div>
<div class="line"><span class="lineno">   48</span>    {</div>
<div class="line"><span class="lineno">   49</span>        <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#af86e8c35cdab1d3c5f302761596bcdae">Unusable</a> = <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">   50</span>    }</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_SELECTOR + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a4a0d94e93bbb0b7abc6f24679b7dfc06">Selector</a>);</div>
<div class="line"><span class="lineno">   53</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_LIMIT + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a0bd32da992b5c13d921807c82f3f932a">Limit</a>);</div>
<div class="line"><span class="lineno">   54</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_ACCESS_RIGHTS + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#a351ac6eabc90a04fff1b1c8c99875dd9">Attributes</a>.<a class="code hl_variable" href="union_v_m_x___s_e_g_m_e_n_t___a_c_c_e_s_s___r_i_g_h_t_s___t_y_p_e.html#a911f358641501ff3e2864fcfdc0262ff">AsUInt</a>);</div>
<div class="line"><span class="lineno">   55</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_ES_BASE + SegmentRegister * 2, <a class="code hl_variable" href="_segmentation_8h.html#a68870ccf6841ce76f7ca30ab1f3b1b4d">SegmentSelector</a>.<a class="code hl_variable" href="struct___v_m_x___s_e_g_m_e_n_t___s_e_l_e_c_t_o_r.html#af782f7b350ce9911745618fa9051428a">Base</a>);</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="_basic_types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><span class="lineno">   58</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acb5fbd9b96011f0e38bfaf4ec88be09f" name="acb5fbd9b96011f0e38bfaf4ec88be09f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb5fbd9b96011f0e38bfaf4ec88be09f">&#9670;&#160;</a></span>HvSetInterruptibilityState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetInterruptibilityState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>InterruptibilityState</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set guest's interruptibility state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">InterruptibilityState</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1237</span>{</div>
<div class="line"><span class="lineno"> 1238</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_INTERRUPTIBILITY_STATE, InterruptibilityState);</div>
<div class="line"><span class="lineno"> 1239</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e8c2928eefa854763176a7f18bb04ca" name="a4e8c2928eefa854763176a7f18bb04ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e8c2928eefa854763176a7f18bb04ca">&#9670;&#160;</a></span>HvSetInterruptWindowExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetInterruptWindowExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Interrupt-window exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the Interrupt-window exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  607</span>{</div>
<div class="line"><span class="lineno">  608</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CpuBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  609</span> </div>
<div class="line"><span class="lineno">  610</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  611</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  612</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  613</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  616</span>    <span class="comment">// interrupt-window exiting</span></div>
<div class="line"><span class="lineno">  617</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  618</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  619</span>    {</div>
<div class="line"><span class="lineno">  620</span>        CpuBasedVmExecControls |= <a class="code hl_define" href="_vmx_8h.html#a1dd1436c26499ab3fb454feae9958218">CPU_BASED_VIRTUAL_INTR_PENDING</a>;</div>
<div class="line"><span class="lineno">  621</span>    }</div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  623</span>    {</div>
<div class="line"><span class="lineno">  624</span>        CpuBasedVmExecControls &amp;= ~CPU_BASED_VIRTUAL_INTR_PENDING;</div>
<div class="line"><span class="lineno">  625</span>    }</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  628</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  629</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  630</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  631</span>}</div>
<div class="ttc" id="a_vmx_8h_html_a1dd1436c26499ab3fb454feae9958218"><div class="ttname"><a href="_vmx_8h.html#a1dd1436c26499ab3fb454feae9958218">CPU_BASED_VIRTUAL_INTR_PENDING</a></div><div class="ttdeci">#define CPU_BASED_VIRTUAL_INTR_PENDING</div><div class="ttdoc">CPU-Based Controls.</div><div class="ttdef"><b>Definition</b> Vmx.h:44</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9aefb71e380eac56389960ac66cddc1" name="ac9aefb71e380eac56389960ac66cddc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9aefb71e380eac56389960ac66cddc1">&#9670;&#160;</a></span>HvSetLoadDebugControls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetLoadDebugControls </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set LOAD DEBUG CONTROLS on Vm-entry controls. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  403</span>{</div>
<div class="line"><span class="lineno">  404</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> VmentryControls = 0;</div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  407</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  408</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  409</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_VMENTRY_CONTROLS, &amp;VmentryControls);</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  412</span>    {</div>
<div class="line"><span class="lineno">  413</span>        VmentryControls |= <a class="code hl_define" href="_vmx_8h.html#a57df7bf8afcf8788ba0a8fd3d4c43889">VM_ENTRY_LOAD_DEBUG_CONTROLS</a>;</div>
<div class="line"><span class="lineno">  414</span>    }</div>
<div class="line"><span class="lineno">  415</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  416</span>    {</div>
<div class="line"><span class="lineno">  417</span>        VmentryControls &amp;= ~VM_ENTRY_LOAD_DEBUG_CONTROLS;</div>
<div class="line"><span class="lineno">  418</span>    }</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  421</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  422</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  423</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_VMENTRY_CONTROLS, VmentryControls);</div>
<div class="line"><span class="lineno">  424</span>}</div>
<div class="ttc" id="a_vmx_8h_html_a57df7bf8afcf8788ba0a8fd3d4c43889"><div class="ttname"><a href="_vmx_8h.html#a57df7bf8afcf8788ba0a8fd3d4c43889">VM_ENTRY_LOAD_DEBUG_CONTROLS</a></div><div class="ttdeci">#define VM_ENTRY_LOAD_DEBUG_CONTROLS</div><div class="ttdoc">VM-entry Control Bits.</div><div class="ttdef"><b>Definition</b> Vmx.h:97</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5ed1560d0c5fa592a40b0b75d8e1022" name="ab5ed1560d0c5fa592a40b0b75d8e1022"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5ed1560d0c5fa592a40b0b75d8e1022">&#9670;&#160;</a></span>HvSetModeBasedExecutionEnableFlag()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetModeBasedExecutionEnableFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Mode-based Execution Control (MBEC) Enable bit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the MBEC </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  678</span>{</div>
<div class="line"><span class="lineno">  679</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> AdjSecCtrl;</div>
<div class="line"><span class="lineno">  680</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> SecondaryProcBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  683</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  684</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  685</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_SECONDARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;SecondaryProcBasedVmExecControls);</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  688</span>    <span class="comment">// PML enable flag</span></div>
<div class="line"><span class="lineno">  689</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  690</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  691</span>    {</div>
<div class="line"><span class="lineno">  692</span>        SecondaryProcBasedVmExecControls |= IA32_VMX_PROCBASED_CTLS2_MODE_BASED_EXECUTE_CONTROL_FOR_EPT_FLAG;</div>
<div class="line"><span class="lineno">  693</span>    }</div>
<div class="line"><span class="lineno">  694</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  695</span>    {</div>
<div class="line"><span class="lineno">  696</span>        SecondaryProcBasedVmExecControls &amp;= ~IA32_VMX_PROCBASED_CTLS2_MODE_BASED_EXECUTE_CONTROL_FOR_EPT_FLAG;</div>
<div class="line"><span class="lineno">  697</span>    }</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>    AdjSecCtrl = <a class="code hl_function" href="_hv_8c.html#a00e070c615f5719e5f74fa77d4cfe8fb">HvAdjustControls</a>(SecondaryProcBasedVmExecControls, IA32_VMX_PROCBASED_CTLS2);</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  702</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  703</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  704</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_SECONDARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, AdjSecCtrl);</div>
<div class="line"><span class="lineno">  705</span>}</div>
<div class="ttc" id="a_hv_8c_html_a00e070c615f5719e5f74fa77d4cfe8fb"><div class="ttname"><a href="_hv_8c.html#a00e070c615f5719e5f74fa77d4cfe8fb">HvAdjustControls</a></div><div class="ttdeci">UINT32 HvAdjustControls(UINT32 Ctl, UINT32 Msr)</div><div class="ttdoc">Adjust controls for VMCS based on processor capability.</div><div class="ttdef"><b>Definition</b> Hv.c:23</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae24c5aceac93fda6a1fcb4e15c85404c" name="ae24c5aceac93fda6a1fcb4e15c85404c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae24c5aceac93fda6a1fcb4e15c85404c">&#9670;&#160;</a></span>HvSetMonitorTrapFlag()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetMonitorTrapFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set or unset the monitor trap flags. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Set or unset the monitor trap flags.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the MTFs </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  350</span>{</div>
<div class="line"><span class="lineno">  351</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CpuBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  355</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  356</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  357</span> </div>
<div class="line"><span class="lineno">  358</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  359</span>    {</div>
<div class="line"><span class="lineno">  360</span>        CpuBasedVmExecControls |= <a class="code hl_define" href="_vmx_8h.html#a7a72b08c32dd84d5f43f140ecf0a4c5e">CPU_BASED_MONITOR_TRAP_FLAG</a>;</div>
<div class="line"><span class="lineno">  361</span>    }</div>
<div class="line"><span class="lineno">  362</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  363</span>    {</div>
<div class="line"><span class="lineno">  364</span>        CpuBasedVmExecControls &amp;= ~CPU_BASED_MONITOR_TRAP_FLAG;</div>
<div class="line"><span class="lineno">  365</span>    }</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  368</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  369</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  370</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  371</span>}</div>
<div class="ttc" id="a_vmx_8h_html_a7a72b08c32dd84d5f43f140ecf0a4c5e"><div class="ttname"><a href="_vmx_8h.html#a7a72b08c32dd84d5f43f140ecf0a4c5e">CPU_BASED_MONITOR_TRAP_FLAG</a></div><div class="ttdeci">#define CPU_BASED_MONITOR_TRAP_FLAG</div><div class="ttdef"><b>Definition</b> Vmx.h:60</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaa9e7c2c5105db2e85d896167df615f7" name="aaa9e7c2c5105db2e85d896167df615f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa9e7c2c5105db2e85d896167df615f7">&#9670;&#160;</a></span>HvSetMovControlRegsExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetMovControlRegsExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>ControlRegister</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>MaskRegister</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set vm-exit for mov-to-cr0/4. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
    <tr><td class="paramname">ControlRegister</td><td></td></tr>
    <tr><td class="paramname">MaskRegister</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>or unset the vm-exits </td></tr>
    <tr><td class="paramname">Control</td><td>Register </td></tr>
    <tr><td class="paramname">Mask</td><td>Register </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  544</span>{</div>
<div class="line"><span class="lineno">  545</span>    <a class="code hl_function" href="_protected_hv_8c.html#a8a99b9719df4cd9e1aa7f8801e72bb6e">ProtectedHvSetMov2CrExiting</a>(Set, ControlRegister, MaskRegister);</div>
<div class="line"><span class="lineno">  546</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_a8a99b9719df4cd9e1aa7f8801e72bb6e"><div class="ttname"><a href="_protected_hv_8c.html#a8a99b9719df4cd9e1aa7f8801e72bb6e">ProtectedHvSetMov2CrExiting</a></div><div class="ttdeci">VOID ProtectedHvSetMov2CrExiting(BOOLEAN Set, UINT64 ControlRegister, UINT64 MaskRegister)</div><div class="ttdoc">Set MOV to CR0/4 Exiting.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:636</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a372b26d4b4571db93597414725289f0c" name="a372b26d4b4571db93597414725289f0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a372b26d4b4571db93597414725289f0c">&#9670;&#160;</a></span>HvSetMovDebugRegsExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetMovDebugRegsExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the Mov to Debug Registers Exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Set the Mov to Debug Registers Exiting.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">Set</td><td>Set or unset the Mov to Debug Registers Exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1122</span>{</div>
<div class="line"><span class="lineno"> 1123</span>    <a class="code hl_function" href="_protected_hv_8c.html#a75477e3e206cdc1861892836da045b49">ProtectedHvSetMovDebugRegsExiting</a>(VCpu, Set);</div>
<div class="line"><span class="lineno"> 1124</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_a75477e3e206cdc1861892836da045b49"><div class="ttname"><a href="_protected_hv_8c.html#a75477e3e206cdc1861892836da045b49">ProtectedHvSetMovDebugRegsExiting</a></div><div class="ttdeci">VOID ProtectedHvSetMovDebugRegsExiting(VIRTUAL_MACHINE_STATE *VCpu, BOOLEAN Set)</div><div class="ttdoc">Set MOV to HW Debug Regs Exiting.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:583</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac7fa8f843553c4aebe992e88c71bbb79" name="ac7fa8f843553c4aebe992e88c71bbb79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7fa8f843553c4aebe992e88c71bbb79">&#9670;&#160;</a></span>HvSetMovToCr3Vmexit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetMovToCr3Vmexit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set vm-exit for mov-to-cr3. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">Set</td><td>Set or unset the vm-exits</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  559</span>{</div>
<div class="line"><span class="lineno">  560</span>    <a class="code hl_function" href="_protected_hv_8c.html#a6566e978ad2b38d97936014d544a7f60">ProtectedHvSetMov2Cr3Exiting</a>(VCpu, Set);</div>
<div class="line"><span class="lineno">  561</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_a6566e978ad2b38d97936014d544a7f60"><div class="ttname"><a href="_protected_hv_8c.html#a6566e978ad2b38d97936014d544a7f60">ProtectedHvSetMov2Cr3Exiting</a></div><div class="ttdeci">VOID ProtectedHvSetMov2Cr3Exiting(VIRTUAL_MACHINE_STATE *VCpu, BOOLEAN Set)</div><div class="ttdoc">Set MOV to CR3 Exiting.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:622</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a19458423f77db01c301caf54c301b24c" name="a19458423f77db01c301caf54c301b24c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19458423f77db01c301caf54c301b24c">&#9670;&#160;</a></span>HvSetNmiExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetNmiExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the NMI Exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the NMI Exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  954</span>{</div>
<div class="line"><span class="lineno">  955</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> PinBasedControls = 0;</div>
<div class="line"><span class="lineno">  956</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> VmExitControls   = 0;</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  959</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  960</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  961</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PIN_BASED_VM_EXECUTION_CONTROLS, &amp;PinBasedControls);</div>
<div class="line"><span class="lineno">  962</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, &amp;VmExitControls);</div>
<div class="line"><span class="lineno">  963</span> </div>
<div class="line"><span class="lineno">  964</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  965</span>    {</div>
<div class="line"><span class="lineno">  966</span>        PinBasedControls |= <a class="code hl_define" href="_vmx_8h.html#abc2451b4f7835bf9e829b91c5a43a4e8">PIN_BASED_VM_EXECUTION_CONTROLS_NMI_EXITING</a>;</div>
<div class="line"><span class="lineno">  967</span>        VmExitControls |= <a class="code hl_define" href="_vmx_8h.html#ae6148ea349dbcbbe50eeae1429664332">VM_EXIT_ACK_INTR_ON_EXIT</a>;</div>
<div class="line"><span class="lineno">  968</span>    }</div>
<div class="line"><span class="lineno">  969</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  970</span>    {</div>
<div class="line"><span class="lineno">  971</span>        PinBasedControls &amp;= ~PIN_BASED_VM_EXECUTION_CONTROLS_NMI_EXITING;</div>
<div class="line"><span class="lineno">  972</span>        VmExitControls &amp;= ~VM_EXIT_ACK_INTR_ON_EXIT;</div>
<div class="line"><span class="lineno">  973</span>    }</div>
<div class="line"><span class="lineno">  974</span> </div>
<div class="line"><span class="lineno">  975</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  976</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  977</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  978</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PIN_BASED_VM_EXECUTION_CONTROLS, PinBasedControls);</div>
<div class="line"><span class="lineno">  979</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, VmExitControls);</div>
<div class="line"><span class="lineno">  980</span>}</div>
<div class="ttc" id="a_vmx_8h_html_abc2451b4f7835bf9e829b91c5a43a4e8"><div class="ttname"><a href="_vmx_8h.html#abc2451b4f7835bf9e829b91c5a43a4e8">PIN_BASED_VM_EXECUTION_CONTROLS_NMI_EXITING</a></div><div class="ttdeci">#define PIN_BASED_VM_EXECUTION_CONTROLS_NMI_EXITING</div><div class="ttdef"><b>Definition</b> Vmx.h:35</div></div>
<div class="ttc" id="a_vmx_8h_html_ae6148ea349dbcbbe50eeae1429664332"><div class="ttname"><a href="_vmx_8h.html#ae6148ea349dbcbbe50eeae1429664332">VM_EXIT_ACK_INTR_ON_EXIT</a></div><div class="ttdeci">#define VM_EXIT_ACK_INTR_ON_EXIT</div><div class="ttdef"><b>Definition</b> Vmx.h:86</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac7a6581e797aaeb78d1d4dba7cb3b7be" name="ac7a6581e797aaeb78d1d4dba7cb3b7be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7a6581e797aaeb78d1d4dba7cb3b7be">&#9670;&#160;</a></span>HvSetNmiWindowExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetNmiWindowExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set NMI-window exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the NMI-window exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  715</span>{</div>
<div class="line"><span class="lineno">  716</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CpuBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  719</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  720</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  721</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  722</span> </div>
<div class="line"><span class="lineno">  723</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  724</span>    <span class="comment">// interrupt-window exiting</span></div>
<div class="line"><span class="lineno">  725</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  726</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  727</span>    {</div>
<div class="line"><span class="lineno">  728</span>        CpuBasedVmExecControls |= <a class="code hl_define" href="_vmx_8h.html#ae7beca6fe5a747c0dd7cc08755295678">CPU_BASED_VIRTUAL_NMI_PENDING</a>;</div>
<div class="line"><span class="lineno">  729</span>    }</div>
<div class="line"><span class="lineno">  730</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  731</span>    {</div>
<div class="line"><span class="lineno">  732</span>        CpuBasedVmExecControls &amp;= ~CPU_BASED_VIRTUAL_NMI_PENDING;</div>
<div class="line"><span class="lineno">  733</span>    }</div>
<div class="line"><span class="lineno">  734</span> </div>
<div class="line"><span class="lineno">  735</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  736</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  737</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  738</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  739</span>}</div>
<div class="ttc" id="a_vmx_8h_html_ae7beca6fe5a747c0dd7cc08755295678"><div class="ttname"><a href="_vmx_8h.html#ae7beca6fe5a747c0dd7cc08755295678">CPU_BASED_VIRTUAL_NMI_PENDING</a></div><div class="ttdeci">#define CPU_BASED_VIRTUAL_NMI_PENDING</div><div class="ttdef"><b>Definition</b> Vmx.h:56</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d721b297a9930e02bfb88191a2e0b78" name="a0d721b297a9930e02bfb88191a2e0b78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d721b297a9930e02bfb88191a2e0b78">&#9670;&#160;</a></span>HvSetPmcVmexit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetPmcVmexit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set vm-exit for rdpmc instructions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the vm-exits </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  510</span>{</div>
<div class="line"><span class="lineno">  511</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> CpuBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  514</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  515</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  516</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  519</span>    {</div>
<div class="line"><span class="lineno">  520</span>        CpuBasedVmExecControls |= <a class="code hl_define" href="_vmx_8h.html#a6893e67fb881da687e2ba4ebd61fb133">CPU_BASED_RDPMC_EXITING</a>;</div>
<div class="line"><span class="lineno">  521</span>    }</div>
<div class="line"><span class="lineno">  522</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  523</span>    {</div>
<div class="line"><span class="lineno">  524</span>        CpuBasedVmExecControls &amp;= ~CPU_BASED_RDPMC_EXITING;</div>
<div class="line"><span class="lineno">  525</span>    }</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  528</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  529</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  530</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, CpuBasedVmExecControls);</div>
<div class="line"><span class="lineno">  531</span>}</div>
<div class="ttc" id="a_vmx_8h_html_a6893e67fb881da687e2ba4ebd61fb133"><div class="ttname"><a href="_vmx_8h.html#a6893e67fb881da687e2ba4ebd61fb133">CPU_BASED_RDPMC_EXITING</a></div><div class="ttdeci">#define CPU_BASED_RDPMC_EXITING</div><div class="ttdef"><b>Definition</b> Vmx.h:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c4daa4d439a7dd29da59724793ea675" name="a7c4daa4d439a7dd29da59724793ea675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c4daa4d439a7dd29da59724793ea675">&#9670;&#160;</a></span>HvSetPmlEnableFlag()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetPmlEnableFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Page Modification Logging Enable bit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the PML </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  641</span>{</div>
<div class="line"><span class="lineno">  642</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> AdjSecCtrl;</div>
<div class="line"><span class="lineno">  643</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> SecondaryProcBasedVmExecControls = 0;</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  646</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  647</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  648</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_SECONDARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, &amp;SecondaryProcBasedVmExecControls);</div>
<div class="line"><span class="lineno">  649</span> </div>
<div class="line"><span class="lineno">  650</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  651</span>    <span class="comment">// PML enable flag</span></div>
<div class="line"><span class="lineno">  652</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  653</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  654</span>    {</div>
<div class="line"><span class="lineno">  655</span>        SecondaryProcBasedVmExecControls |= IA32_VMX_PROCBASED_CTLS2_ENABLE_PML_FLAG;</div>
<div class="line"><span class="lineno">  656</span>    }</div>
<div class="line"><span class="lineno">  657</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  658</span>    {</div>
<div class="line"><span class="lineno">  659</span>        SecondaryProcBasedVmExecControls &amp;= ~IA32_VMX_PROCBASED_CTLS2_ENABLE_PML_FLAG;</div>
<div class="line"><span class="lineno">  660</span>    }</div>
<div class="line"><span class="lineno">  661</span> </div>
<div class="line"><span class="lineno">  662</span>    AdjSecCtrl = <a class="code hl_function" href="_hv_8c.html#a00e070c615f5719e5f74fa77d4cfe8fb">HvAdjustControls</a>(SecondaryProcBasedVmExecControls, IA32_VMX_PROCBASED_CTLS2);</div>
<div class="line"><span class="lineno">  663</span> </div>
<div class="line"><span class="lineno">  664</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  665</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  666</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  667</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_SECONDARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS, AdjSecCtrl);</div>
<div class="line"><span class="lineno">  668</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aaac0cbfd9d2c9a2d4c4263bf58051322" name="aaac0cbfd9d2c9a2d4c4263bf58051322"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaac0cbfd9d2c9a2d4c4263bf58051322">&#9670;&#160;</a></span>HvSetRdtscExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetRdtscExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the RDTSC/P Exiting. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">Set</td><td>Set or unset the RDTSC/P Exiting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1109</span>{</div>
<div class="line"><span class="lineno"> 1110</span>    <a class="code hl_function" href="_protected_hv_8c.html#a0bb0a90dc6da72167ab2a1f48b2edc73">ProtectedHvSetRdtscExiting</a>(VCpu, Set);</div>
<div class="line"><span class="lineno"> 1111</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_a0bb0a90dc6da72167ab2a1f48b2edc73"><div class="ttname"><a href="_protected_hv_8c.html#a0bb0a90dc6da72167ab2a1f48b2edc73">ProtectedHvSetRdtscExiting</a></div><div class="ttdeci">VOID ProtectedHvSetRdtscExiting(VIRTUAL_MACHINE_STATE *VCpu, BOOLEAN Set)</div><div class="ttdoc">Set the RDTSC/P Exiting.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:558</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="add5b0119e284b00c07f2e4c1dd785785" name="add5b0119e284b00c07f2e4c1dd785785"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add5b0119e284b00c07f2e4c1dd785785">&#9670;&#160;</a></span>HvSetRflags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetRflags </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>Rflags</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set guest's RFLAGS. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Rflags</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1168</span>{</div>
<div class="line"><span class="lineno"> 1169</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_RFLAGS, Rflags);</div>
<div class="line"><span class="lineno"> 1170</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af1b5b358d07414ddfb27431c94c48e48" name="af1b5b358d07414ddfb27431c94c48e48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1b5b358d07414ddfb27431c94c48e48">&#9670;&#160;</a></span>HvSetRflagTrapFlag()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetRflagTrapFlag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the rflag's trap flag. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the TF</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  382</span>{</div>
<div class="line"><span class="lineno">  383</span>    RFLAGS Rflags = {0};</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  386</span>    <span class="comment">// Unset the trap-flag, as we set it before we have to mask it now</span></div>
<div class="line"><span class="lineno">  387</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  388</span>    Rflags.AsUInt = <a class="code hl_function" href="_hv_8c.html#a35c8859ced5a3b6dc42673b614e58f7a">HvGetRflags</a>();</div>
<div class="line"><span class="lineno">  389</span> </div>
<div class="line"><span class="lineno">  390</span>    Rflags.TrapFlag = Set;</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>    <a class="code hl_function" href="_hv_8c.html#add5b0119e284b00c07f2e4c1dd785785">HvSetRflags</a>(Rflags.AsUInt);</div>
<div class="line"><span class="lineno">  393</span>}</div>
<div class="ttc" id="a_hv_8c_html_a35c8859ced5a3b6dc42673b614e58f7a"><div class="ttname"><a href="_hv_8c.html#a35c8859ced5a3b6dc42673b614e58f7a">HvGetRflags</a></div><div class="ttdeci">UINT64 HvGetRflags()</div><div class="ttdoc">Read guest's RFLAGS.</div><div class="ttdef"><b>Definition</b> Hv.c:1151</div></div>
<div class="ttc" id="a_hv_8c_html_add5b0119e284b00c07f2e4c1dd785785"><div class="ttname"><a href="_hv_8c.html#add5b0119e284b00c07f2e4c1dd785785">HvSetRflags</a></div><div class="ttdeci">VOID HvSetRflags(UINT64 Rflags)</div><div class="ttdoc">Set guest's RFLAGS.</div><div class="ttdef"><b>Definition</b> Hv.c:1167</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a062b204397ffe1208139f8498749f057" name="a062b204397ffe1208139f8498749f057"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a062b204397ffe1208139f8498749f057">&#9670;&#160;</a></span>HvSetRip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetRip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#aae17ebb9ef7279d026817fb22f8aebe9">UINT64</a></td>          <td class="paramname"><span class="paramname"><em>Rip</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set guest's RIP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Rip</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1195</span>{</div>
<div class="line"><span class="lineno"> 1196</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_GUEST_RIP, Rip);</div>
<div class="line"><span class="lineno"> 1197</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a437b35822e82e1192228e3f8e767a4ab" name="a437b35822e82e1192228e3f8e767a4ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a437b35822e82e1192228e3f8e767a4ab">&#9670;&#160;</a></span>HvSetSaveDebugControls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetSaveDebugControls </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set SAVE DEBUG CONTROLS on Vm-exit controls. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  434</span>{</div>
<div class="line"><span class="lineno">  435</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> VmexitControls = 0;</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  438</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  439</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  440</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, &amp;VmexitControls);</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  443</span>    {</div>
<div class="line"><span class="lineno">  444</span>        VmexitControls |= <a class="code hl_define" href="_vmx_8h.html#ac42210f2cb26e1127e8ef20b5b8cf115">VM_EXIT_SAVE_DEBUG_CONTROLS</a>;</div>
<div class="line"><span class="lineno">  445</span>    }</div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  447</span>    {</div>
<div class="line"><span class="lineno">  448</span>        VmexitControls &amp;= ~VM_EXIT_SAVE_DEBUG_CONTROLS;</div>
<div class="line"><span class="lineno">  449</span>    }</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  452</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  453</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  454</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PRIMARY_VMEXIT_CONTROLS, VmexitControls);</div>
<div class="line"><span class="lineno">  455</span>}</div>
<div class="ttc" id="a_vmx_8h_html_ac42210f2cb26e1127e8ef20b5b8cf115"><div class="ttname"><a href="_vmx_8h.html#ac42210f2cb26e1127e8ef20b5b8cf115">VM_EXIT_SAVE_DEBUG_CONTROLS</a></div><div class="ttdeci">#define VM_EXIT_SAVE_DEBUG_CONTROLS</div><div class="ttdoc">VM-exit Control Bits.</div><div class="ttdef"><b>Definition</b> Vmx.h:83</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82c2dbbfaabfafcb556e12f0bfb93d4a" name="a82c2dbbfaabfafcb556e12f0bfb93d4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82c2dbbfaabfafcb556e12f0bfb93d4a">&#9670;&#160;</a></span>HvSetVmxPreemptionTimerExiting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSetVmxPreemptionTimerExiting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#a1cb18096b299d23458d3c7b85fd86555">BOOLEAN</a></td>          <td class="paramname"><span class="paramname"><em>Set</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the VMX Preemptiom Timer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Set the VMX Preemptiom Timer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Set</td><td>Set or unset the VMX preemption timer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  990</span>{</div>
<div class="line"><span class="lineno">  991</span>    <a class="code hl_typedef" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a> PinBasedControls = 0;</div>
<div class="line"><span class="lineno">  992</span> </div>
<div class="line"><span class="lineno">  993</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  994</span>    <span class="comment">// Read the previous flags</span></div>
<div class="line"><span class="lineno">  995</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  996</span>    <a class="code hl_function" href="_vmx_8c.html#af411da3719b3f7f9198be1b8bc6c6874">VmxVmread32P</a>(VMCS_CTRL_PIN_BASED_VM_EXECUTION_CONTROLS, &amp;PinBasedControls);</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span>    <span class="keywordflow">if</span> (Set)</div>
<div class="line"><span class="lineno">  999</span>    {</div>
<div class="line"><span class="lineno"> 1000</span>        PinBasedControls |= <a class="code hl_define" href="_vmx_8h.html#aede75c15664ad00acc9066a873396490">PIN_BASED_VM_EXECUTION_CONTROLS_ACTIVE_VMX_TIMER</a>;</div>
<div class="line"><span class="lineno"> 1001</span>    }</div>
<div class="line"><span class="lineno"> 1002</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1003</span>    {</div>
<div class="line"><span class="lineno"> 1004</span>        PinBasedControls &amp;= ~PIN_BASED_VM_EXECUTION_CONTROLS_ACTIVE_VMX_TIMER;</div>
<div class="line"><span class="lineno"> 1005</span>    }</div>
<div class="line"><span class="lineno"> 1006</span> </div>
<div class="line"><span class="lineno"> 1007</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1008</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno"> 1009</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1010</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_PIN_BASED_VM_EXECUTION_CONTROLS, PinBasedControls);</div>
<div class="line"><span class="lineno"> 1011</span>}</div>
<div class="ttc" id="a_vmx_8h_html_aede75c15664ad00acc9066a873396490"><div class="ttname"><a href="_vmx_8h.html#aede75c15664ad00acc9066a873396490">PIN_BASED_VM_EXECUTION_CONTROLS_ACTIVE_VMX_TIMER</a></div><div class="ttdeci">#define PIN_BASED_VM_EXECUTION_CONTROLS_ACTIVE_VMX_TIMER</div><div class="ttdef"><b>Definition</b> Vmx.h:37</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a384185281b4d93ce4a401d66848d9049" name="a384185281b4d93ce4a401d66848d9049"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a384185281b4d93ce4a401d66848d9049">&#9670;&#160;</a></span>HvSuppressRipIncrement()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvSuppressRipIncrement </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Suppress the incrementation of RIP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  325</span>{</div>
<div class="line"><span class="lineno">  326</span>    VCpu-&gt;<a class="code hl_variable" href="struct___v_i_r_t_u_a_l___m_a_c_h_i_n_e___s_t_a_t_e.html#a95be62d62b8c4a2e9bd6bf75a0ba4cd1">IncrementRip</a> = <a class="code hl_define" href="_basic_types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><span class="lineno">  327</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a256ea8c6d02ec0645069b0df50683700" name="a256ea8c6d02ec0645069b0df50683700"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a256ea8c6d02ec0645069b0df50683700">&#9670;&#160;</a></span>HvUnsetExceptionBitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvUnsetExceptionBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hyperhv_2header_2common_2_state_8h.html#ac81d4d9bd1e8dd24918e667b56b67b7e">VIRTUAL_MACHINE_STATE</a> *</td>          <td class="paramname"><span class="paramname"><em>VCpu</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>IdtIndex</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unset exception bitmap in VMCS. </p>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IdtIndex</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">VCpu</td><td>The virtual processor's state </td></tr>
    <tr><td class="paramname">IdtIndex</td><td>Interrupt Descriptor Table index of exception </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno"> 1040</span>{</div>
<div class="line"><span class="lineno"> 1041</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1042</span>    <span class="comment">// This is a wrapper to perform extra checks</span></div>
<div class="line"><span class="lineno"> 1043</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1044</span>    <a class="code hl_function" href="_protected_hv_8c.html#ab8f9209e9448adb6130c643e9c92c6b4">ProtectedHvUnsetExceptionBitmap</a>(VCpu, IdtIndex);</div>
<div class="line"><span class="lineno"> 1045</span>}</div>
<div class="ttc" id="a_protected_hv_8c_html_ab8f9209e9448adb6130c643e9c92c6b4"><div class="ttname"><a href="_protected_hv_8c.html#ab8f9209e9448adb6130c643e9c92c6b4">ProtectedHvUnsetExceptionBitmap</a></div><div class="ttdeci">VOID ProtectedHvUnsetExceptionBitmap(VIRTUAL_MACHINE_STATE *VCpu, UINT32 IdtIndex)</div><div class="ttdoc">Unset exception bitmap in VMCS.</div><div class="ttdef"><b>Definition</b> ProtectedHv.c:108</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a595e57580c35bb94687c29de95053e74" name="a595e57580c35bb94687c29de95053e74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a595e57580c35bb94687c29de95053e74">&#9670;&#160;</a></span>HvWriteExceptionBitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_basic_types_8h.html#a7f319bfc2492a2136964194204e7a8cf">VOID</a> HvWriteExceptionBitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_basic_types_8h.html#ae1e6edbbc26d6fbc71a90190d0266018">UINT32</a></td>          <td class="paramname"><span class="paramname"><em>BitmapMask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write to the exception bitmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">BitmapMask</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID</dd></dl>
<p>Write to the exception bitmap.</p>
<p>Should be called in vmx-root</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">BitmapMask</td><td>The content to write on exception bitmap </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>VOID </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  573</span>{</div>
<div class="line"><span class="lineno">  574</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">// Set the new value</span></div>
<div class="line"><span class="lineno">  576</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  577</span>    <a class="code hl_function" href="_vmx_8c.html#a14b2ff5571ba424d03e622b3802e8e5a">VmxVmwrite64</a>(VMCS_CTRL_EXCEPTION_BITMAP, BitmapMask);</div>
<div class="line"><span class="lineno">  578</span>}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_53a6cdbae347618e9ee76d4be5c6ea96.html">hyperdbg</a></li><li class="navelem"><a class="el" href="dir_e536aab728f7b0abbbf7dc8fdcfcc81b.html">hyperhv</a></li><li class="navelem"><a class="el" href="dir_c1e9402aa68d313bf3c169dd8660abb3.html">header</a></li><li class="navelem"><a class="el" href="dir_ece7518ea148b2aa6f397c230ea62e67.html">vmm</a></li><li class="navelem"><a class="el" href="dir_ebb8705cd9fef630d769095c42f148fb.html">vmx</a></li><li class="navelem"><a class="el" href="_hv_8h.html">Hv.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
